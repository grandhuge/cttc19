<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPF NAV Analysis Tool</title>
    
    <!-- 1. Tailwind CSS (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ Framework JS) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Chart.js (Library ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- 3. PapaParse (Library ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå CSV) -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>

    <style>
        /* ‡πÉ‡∏ä‡πâ‡∏ü‡∏≠‡∏ô‡∏ï‡πå Inter ‡∏ó‡∏µ‡πà‡∏î‡∏π‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; /* cool-gray-300 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; /* cool-gray-400 */
        }
        /* ‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á Input ‡∏ï‡∏≤‡∏° Radio button */
        .input-toggle:not(:checked) + div {
            display: none;
        }
        /* ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÅ‡∏ó‡πá‡∏ö */
        .tab-btn.active {
            border-color: #3b82f6; /* blue-600 */
            color: #3b82f6;
            font-weight: 600;
        }
    </style>
    <!-- ‡πÇ‡∏´‡∏•‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå Inter ‡∏à‡∏≤‡∏Å Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Sarabun:wght@400;500;600&display=swap" rel="stylesheet">

</head>
<body class="bg-gray-100 text-gray-800 flex" style="font-family: 'Sarabun', 'Inter', sans-serif;">

    <!-- ==== 1. SIDEBAR (‡πÅ‡∏ñ‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°) ==== -->
    <aside class="fixed top-0 left-0 w-80 h-full bg-white shadow-lg p-6 overflow-y-auto">
        <h1 class="text-2xl font-bold text-blue-600 mb-6">GPF Analysis Tool üìà</h1>

        <!-- 1.1 ‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
        <section class="mb-6">
            <h2 class="text-lg font-semibold mb-3 text-gray-700">1. ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• NAV</h2>
            
            <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ Import -->
            <div class="flex space-x-4 mb-3">
                <label class="flex items-center">
                    <input type="radio" name="importType" class="input-toggle" value="file" checked>
                    <span class="ml-2 text-sm">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå</span>
                </label>
                <label class="flex items-center">
                    <input type="radio" name="importType" class="input-toggle" value="gsheet">
                    <span class="ml-2 text-sm">Google Sheet</span>
                </label>
            </div>

            <!-- Input ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå CSV -->
            <div id="file-input-group">
                <input type="file" id="csv-file-input" class="w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 cursor-pointer" accept=".csv">
                <p class="text-xs text-gray-500 mt-1">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå .csv ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</p>
            </div>

            <!-- Input ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Google Sheet -->
            <div id="gsheet-input-group" class="hidden">
                <input type="text" id="gsheet-url-input" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå Google Sheet" class="w-full p-2 border border-gray-300 rounded-lg text-sm">
                <p class="text-xs text-gray-500 mt-1">‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà "‡πÅ‡∏ä‡∏£‡πå" ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ</p>
            </div>
            
            <button id="load-data-btn" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-blue-700 transition duration-200 mt-4">
                ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            </button>

            <!-- (New) Import Format Hint -->
            <div class="mt-4 p-3 bg-gray-50 border border-gray-200 rounded-lg text-xs text-gray-600">
                <h4 class="font-semibold mb-1">‡∏Ç‡πâ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤:</h4>
                <ul class="list-disc list-inside space-y-1">
                    <li>‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å‡∏Ñ‡∏∑‡∏≠ "Header" (Date, ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô, ...)</li>
                    <li>‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÅ‡∏£‡∏Å‡∏Ñ‡∏∑‡∏≠ "Date" (‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö dd/mm/yyyy)</li>
                    <li>‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏Ñ‡∏∑‡∏≠ NAV ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô</li>
                </ul>
            </div>
        </section>

        <!-- 1.2 ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå -->
        <section class="mb-6">
            <h2 class="text-lg font-semibold mb-3 text-gray-700">2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå</h2>
            <div class="space-y-3">
                <div>
                    <label for="short-ma" class="block text-sm font-medium text-gray-600">MA ‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô (‡∏ß‡∏±‡∏ô)</label>
                    <input type="number" id="short-ma" value="50" class="w-full p-2 border border-gray-300 rounded-lg mt-1 text-sm">
                </div>
                <div>
                    <label for="long-ma" class="block text-sm font-medium text-gray-600">MA ‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß (‡∏ß‡∏±‡∏ô)</label>
                    <input type="number" id="long-ma" value="200" class="w-full p-2 border border-gray-300 rounded-lg mt-1 text-sm">
                </div>
                <div>
                    <label for="rsi-period" class="block text-sm font-medium text-gray-600">RSI Period (‡∏ß‡∏±‡∏ô)</label>
                    <input type="number" id="rsi-period" value="14" class="w-full p-2 border border-gray-300 rounded-lg mt-1 text-sm">
                </div>
                <div>
                    <label for="switch-limit" class="block text-sm font-medium text-gray-600">‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏±‡∏ö (‡∏Ñ‡∏£‡∏±‡πâ‡∏á/‡∏õ‡∏µ)</label>
                    <input type="number" id="switch-limit" value="12" class="w-full p-2 border border-gray-300 rounded-lg mt-1 text-sm" readonly>
                </div>
            </div>
        </section>

        <!-- 1.3 ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô -->
        <section>
            <h2 class="text-lg font-semibold mb-3 text-gray-700">3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö)</h2>
            <div id="fund-selector" class="space-y-2 max-h-40 overflow-y-auto bg-gray-50 p-3 rounded-lg border">
                <p class="text-sm text-gray-500">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô...</p>
            </div>
        </section>

        <!-- 1.4 (‡πÉ‡∏´‡∏°‡πà) ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô -->
        <section class="mt-6">
            <h2 class="text-lg font-semibold mb-3 text-gray-700">4. ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h2>
            <div class="space-y-3 bg-blue-50 p-4 rounded-lg border border-blue-200">
                <div>
                    <label for="current-fund-select" class="block text-sm font-medium text-gray-600">‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà</label>
                    <select id="current-fund-select" class="w-full p-2 border border-gray-300 rounded-lg mt-1 text-sm">
                        <option value="">-- ‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
                        <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡πÇ‡∏î‡∏¢ JavaScript -->
                    </select>
                </div>
                <div>
                    <label for="entry-date-input" class="block text-sm font-medium text-gray-600">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏•‡∏á‡∏ó‡∏∏‡∏ô (‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)</label>
                    <input type="date" id="entry-date-input" class="w-full p-2 border border-gray-300 rounded-lg mt-1 text-sm">
                </div>
            </div>
        </section>
        
        <!-- (‡∏¢‡πâ‡∏≤‡∏¢‡∏°‡∏≤) ‡∏õ‡∏∏‡πà‡∏°‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏´‡∏•‡∏±‡∏Å -->
        <button id="run-analysis-btn" class="w-full bg-green-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-green-700 transition duration-200 mt-6">
            ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
        </button>

        <!-- 1.5 Status Message -->
        <div id="status-message" class="mt-4 text-sm"></div>
    </aside>

    <!-- ==== 2. MAIN CONTENT (‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•) ==== -->
    <main class="ml-80 w-[calc(100%-320px)] p-8">
        <!-- 2.1 ‡πÅ‡∏ó‡πá‡∏ö‡∏ô‡∏≥‡∏ó‡∏≤‡∏á -->
        <div class="border-b border-gray-300 mb-6">
            <nav class="flex space-x-6">
                <button class="tab-btn py-3 px-1 border-b-2 border-transparent text-gray-600 hover:text-blue-600 active" data-tab="dashboard">
                    ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                </button>
                <button class="tab-btn py-3 px-1 border-b-2 border-transparent text-gray-600 hover:text-blue-600" data-tab="chart">
                    ‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
                </button>
                <button class="tab-btn py-3 px-1 border-b-2 border-transparent text-gray-600 hover:text-blue-600" data-tab="backtest">
                    ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì
                </button>
                <!-- (‡πÉ‡∏´‡∏°‡πà) ‡πÅ‡∏ó‡πá‡∏ö‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ -->
                <button class="tab-btn py-3 px-1 border-b-2 border-transparent text-gray-600 hover:text-blue-600" data-tab="suggestion">
                    ‚≠ê ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
                </button>
            </nav>
        </div>

        <!-- 2.2 ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ó‡πá‡∏ö -->
        <div id="tab-content">
            <!-- 2.2.1 ‡πÅ‡∏ó‡πá‡∏ö "‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞" -->
            <div id="dashboard-content" class="tab-panel">
                <h2 class="text-2xl font-semibold mb-4">‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô</h2>
                <div id="dashboard-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢ JavaScript -->
                    <p class="text-gray-500">‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏î "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå"</p>
                </div>
            </div>

            <!-- 2.2.2 ‡πÅ‡∏ó‡πá‡∏ö "‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå" (Restore) -->
            <div id="chart-content" class="tab-panel hidden">
                <h2 class="text-2xl font-semibold mb-4">‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå NAV</h2>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <canvas id="nav-chart"></canvas>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md mt-6">
                    <canvas id="rsi-chart"></canvas>
                </div>
            </div>

            <!-- 2.2.3 ‡πÅ‡∏ó‡πá‡∏ö "‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì" (Backtest) (Restore) -->
            <div id="backtest-content" class="tab-panel hidden">
                <h2 class="text-2xl font-semibold mb-4">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì (‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô)</h2>
                <p class="text-sm text-gray-600 mb-4">
                    ‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏™‡∏•‡∏±‡∏ö (Golden/Death Cross) ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤ 12 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á/‡∏õ‡∏µ ‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                </p>
                <div id="backtest-results" class="bg-white p-6 rounded-lg shadow-md space-y-4">
                    <!-- ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢ JavaScript -->
                    <p class="text-gray-500">‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏î "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå"</p>
                </div>
            </div>

            <!-- (‡πÉ‡∏´‡∏°‡πà) 2.2.4 ‡πÅ‡∏ó‡πá‡∏ö "‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥" -->
            <div id="suggestion-content" class="tab-panel hidden">
                <h2 class="text-2xl font-semibold mb-4">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
                <div id="suggestion-results" class="bg-white p-6 rounded-lg shadow-md space-y-4">
                    <p class="text-gray-500">‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà" ‡πÅ‡∏•‡∏∞ "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏•‡∏á‡∏ó‡∏∏‡∏ô" ‡πÉ‡∏ô Sidebar (‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4) ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå"</p>
                    <!-- ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢ JavaScript -->
                </div>
            </div>

        </div>

        <!-- (New) Footer -->
        <footer class="text-center text-xs text-gray-500 mt-12">
            ¬© developed by Tle Narongphisit | CTTC19 CPD
        </footer>

    </main>

    <!-- ==== 3. JAVASCRIPT (‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô) ==== -->
    <script>
        // === 3.1 ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Global ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ===
        let allData = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å CSV
        let fundsData = {}; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏ö‡πà‡∏á‡∏ï‡∏≤‡∏°‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡πÅ‡∏•‡πâ‡∏ß
        let navChartInstance = null; // ‡πÄ‡∏Å‡πá‡∏ö instance ‡∏Ç‡∏≠‡∏á Chart.js (‡∏Å‡∏£‡∏≤‡∏ü NAV)
        let rsiChartInstance = null; // ‡πÄ‡∏Å‡πá‡∏ö instance ‡∏Ç‡∏≠‡∏á Chart.js (‡∏Å‡∏£‡∏≤‡∏ü RSI)

        // === 3.2 DOM Elements (‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á HTML) ===
        const loadDataBtn = document.getElementById('load-data-btn');
        const runAnalysisBtn = document.getElementById('run-analysis-btn');
        const fileInput = document.getElementById('csv-file-input');
        const gsheetInput = document.getElementById('gsheet-url-input');
        const fileInputGroup = document.getElementById('file-input-group');
        const gsheetInputGroup = document.getElementById('gsheet-input-group');
        const importTypeRadios = document.querySelectorAll('input[name="importType"]');
        const fundSelectorDiv = document.getElementById('fund-selector');
        const statusMessage = document.getElementById('status-message');
        
        const shortMAInput = document.getElementById('short-ma');
        const longMAInput = document.getElementById('long-ma');
        const rsiPeriodInput = document.getElementById('rsi-period');
        
        const tabs = document.querySelectorAll('.tab-btn');
        const tabPanels = document.querySelectorAll('.tab-panel');
        const dashboardCardsDiv = document.getElementById('dashboard-cards');
        const backtestResultsDiv = document.getElementById('backtest-results');

        // (‡πÉ‡∏´‡∏°‡πà) Element ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4
        const suggestionResultsDiv = document.getElementById('suggestion-results');
        const currentFundSelect = document.getElementById('current-fund-select');
        const entryDateInput = document.getElementById('entry-date-input');

        // === 3.3 Event Listeners (‡∏ï‡∏±‡∏ß‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå) ===

        // ‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ Input ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á File/GSheet
        importTypeRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                if (e.target.value === 'file') {
                    fileInputGroup.style.display = 'block';
                    gsheetInputGroup.style.display = 'none';
                } else {
                    fileInputGroup.style.display = 'none';
                    gsheetInputGroup.style.display = 'block';
                }
            });
        });

        // ‡∏õ‡∏∏‡πà‡∏° "‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"
        loadDataBtn.addEventListener('click', handleLoadData);

        // ‡∏õ‡∏∏‡πà‡∏° "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå"
        runAnalysisBtn.addEventListener('click', handleRunAnalysis);

        // ‡∏õ‡∏∏‡πà‡∏° "‡πÅ‡∏ó‡πá‡∏ö"
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Active-inactive state
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // ‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á Panel
                const targetTab = tab.getAttribute('data-tab');
                tabPanels.forEach(panel => {
                    if (panel.id === `${targetTab}-content`) {
                        panel.style.display = 'block';
                    } else {
                        panel.style.display = 'none';
                    }
                });
            });
        });

        // === 3.4 ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å: ‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ===

        function handleLoadData() {
            const importType = document.querySelector('input[name="importType"]:checked').value;
            setStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'blue');

            if (importType === 'file') {
                const file = fileInput.files[0];
                if (!file) {
                    setStatus('‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV ‡∏Å‡πà‡∏≠‡∏ô', 'red');
                    return;
                }
                parseCSV(file);
            } else {
                const url = gsheetInput.value.trim();
                if (!url) {
                    setStatus('‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Google Sheet', 'red');
                    return;
                }
                loadFromGSheet(url);
            }
        }

        // ‡πÅ‡∏õ‡∏•‡∏á URL Google Sheet ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô CSV export link
        function getGSheetCsvUrl(url) {
            const match = url.match(/\/d\/([a-zA-Z0-9-_]+)/);
            if (match && match[1]) {
                const sheetId = match[1];
                // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏ô‡∏µ‡πà‡∏à‡∏∞‡∏î‡∏∂‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡∏µ‡∏ï‡πÅ‡∏£‡∏Å (gid=0)
                // ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏µ‡∏ï‡∏≠‡∏∑‡πà‡∏ô ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤ gid ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
                return `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv&gid=0`;
            }
            setStatus('URL Google Sheet ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'red');
            return null;
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheet
        function loadFromGSheet(url) {
            const csvUrl = getGSheetCsvUrl(url);
            if (!csvUrl) return;

            Papa.parse(csvUrl, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: (results) => {
                    processData(results.data);
                },
                error: (err) => {
                    setStatus(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î GSheet: ${err.message}. (‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏õ‡πá‡∏ô '‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå')`, 'red');
                }
            });
        }

        // === 3.4 ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å: ‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ===
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á Checkbox ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô ‡πÅ‡∏•‡∏∞ (‡πÉ‡∏´‡∏°‡πà) Dropdown ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà
        function populateFundSelector() {
            fundSelectorDiv.innerHTML = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤
            currentFundSelect.innerHTML = '<option value="">-- ‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>'; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå Dropdown

            const fundNames = Object.keys(fundsData).sort();

            if (fundNames.length === 0) {
                fundSelectorDiv.innerHTML = '<p class="text-sm text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô</p>';
                return;
            }

            fundNames.forEach((fundName, index) => {
                // 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á Checkbox
                const div = document.createElement('div');
                div.className = 'flex items-center';
                div.innerHTML = `
                    <input type_checkbox="checkbox" id="fund-${index}" value="${fundName}" class="fund-checkbox h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" checked>
                    <label for="fund-${index}" class="ml-2 block text-sm text-gray-700">${fundName}</label>
                `;
                // ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô type_checkbox ‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô type="checkbox"
                div.querySelector('input').type = "checkbox";
                fundSelectorDiv.appendChild(div);

                // 2. (‡πÉ‡∏´‡∏°‡πà) ‡∏™‡∏£‡πâ‡∏≤‡∏á Option
                const option = document.createElement('option');
                option.value = fundName;
                option.textContent = fundName;
                currentFundSelect.appendChild(option);
            });
        }

        // === 3.6 ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å: ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå ===

        function handleRunAnalysis() {
            const selectedFunds = Array.from(document.querySelectorAll('.fund-checkbox:checked')).map(cb => cb.value);
            
            if (selectedFunds.length === 0) {
                setStatus('‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô', 'red');
                return;
            }
            
            setStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...', 'blue');

            // 1. ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå Dashboard (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡πâ return ‡∏Ñ‡πà‡∏≤)
            const allFundStatuses = runDashboardAnalysis(selectedFunds);
            
            // 2. ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏£‡∏≤‡∏ü
            runChartAnalysis(selectedFunds);

            // 3. ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå Backtest
            runBacktestAnalysis(selectedFunds);

            // 4. (‡πÉ‡∏´‡∏°‡πà) ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
            runSuggestionAnalysis(allFundStatuses);

            setStatus('‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'green');
        }

        // --- 3.6.1 Dashboard ---
        // (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) ‡πÉ‡∏´‡πâ return ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        function runDashboardAnalysis(selectedFunds) {
            dashboardCardsDiv.innerHTML = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Å‡πà‡∏≤
            const analysisResults = []; // (‡πÉ‡∏´‡∏°‡πà) ‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå

            selectedFunds.forEach(fundName => {
                const data = fundsData[fundName];
                if (data.length < 2) return; // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏û‡∏≠

                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Indicators
                const shortPeriod = parseInt(shortMAInput.value);
                const longPeriod = parseInt(longMAInput.value);
                const rsiPeriod = parseInt(rsiPeriodInput.value);

                const prices = data.map(d => d.nav);
                const smaShort = calculateMA(prices, shortPeriod);
                const smaLong = calculateMA(prices, longPeriod);
                const rsi = calculateRSI(prices, rsiPeriod);

                // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                const latest = data[data.length - 1];
                const latestShort = smaShort[smaShort.length - 1];
                const latestLong = smaLong[smaLong.length - 1];
                const latestRSI = rsi[rsi.length - 1];
                
                // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
                const prevShort = smaShort[smaShort.length - 2];
                const prevLong = smaLong[smaLong.length - 2];

                // ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                let status = '‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô (Sideways)';
                let signal = '‡∏£‡∏≠‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì';
                let statusColor = 'gray';

                if (latestShort > latestLong && prevShort <= prevLong) {
                    status = 'Golden Cross!';
                    signal = '‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ã‡∏∑‡πâ‡∏≠ (‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Ç‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô)';
                    statusColor = 'green';
                } else if (latestShort < latestLong && prevShort >= prevLong) {
                    status = 'Death Cross!';
                    signal = '‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏Ç‡∏≤‡∏¢ (‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Ç‡∏≤‡∏•‡∏á)';
                    statusColor = 'red';
                } else if (latestShort > latestLong) {
                    status = '‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Ç‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô';
                    signal = '‡∏ñ‡∏∑‡∏≠ (Above Long MA)';
                    statusColor = 'green';
                } else if (latestShort < latestLong) {
                    status = '‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Ç‡∏≤‡∏•‡∏á';
                    signal = '‡∏£‡∏≠ (Below Long MA)';
                    statusColor = 'red';
                }

                // (‡πÉ‡∏´‡∏°‡πà) ‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
                analysisResults.push({
                    name: fundName,
                    status: status,
                    signal: signal,
                    color: statusColor,
                    latestRSI: latestRSI,
                    isBuySignal: (status === 'Golden Cross!' || status === '‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Ç‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô'),
                    isSellSignal: (status === 'Death Cross!' || status === '‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Ç‡∏≤‡∏•‡∏á')
                });

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î
                const card = document.createElement('div');
                card.className = `bg-white p-6 rounded-lg shadow-md border-l-4 border-${statusColor}-500`;
                card.innerHTML = `
                    <h3 class="text-xl font-bold text-${statusColor}-600">${fundName}</h3>
                    <p class="text-2xl font-semibold my-2">${status}</p>
                    <p class="text-gray-600 mb-3">${signal}</p>
                    <div class="text-sm space-y-1 text-gray-700">
                        <p><strong>NAV ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:</strong> ${latest.nav.toFixed(4)}</p>
                        <p><strong>RSI (${rsiPeriod}):</strong> ${latestRSI.toFixed(2)} ${latestRSI > 70 ? '(Overbought)' : latestRSI < 30 ? '(Oversold)' : ''}</p>
                        <p><strong>MA ${shortPeriod}:</strong> ${latestShort.toFixed(4)}</p>
                        <p><strong>MA ${longPeriod}:</strong> ${latestLong.toFixed(4)}</p>
                    </div>
                `;
                dashboardCardsDiv.appendChild(card);
            });

            return analysisResults; // (‡πÉ‡∏´‡∏°‡πà) ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ö
        }

        // --- 3.6.2 Chart ---
        function runChartAnalysis(selectedFunds) {
            const shortPeriod = parseInt(shortMAInput.value);
            const longPeriod = parseInt(longMAInput.value);
            const rsiPeriod = parseInt(rsiPeriodInput.value);

            // ‡πÉ‡∏ä‡πâ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏ê‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≤‡∏ü RSI
            const rsiBaseFund = selectedFunds[0];
            const rsiBaseData = fundsData[rsiBaseFund].map(d => d.nav);
            const rsiValues = calculateRSI(rsiBaseData, rsiPeriod);
            const labels = fundsData[rsiBaseFund].map(d => d.date.toLocaleDateString('th-TH'));
            
            // --- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü NAV ---
            const navCtx = document.getElementById('nav-chart').getContext('2d');
            const datasets = [];
            const colors = ['#3b82f6', '#ef4444', '#10b981', '#f97316', '#8b5cf6', '#d946ef'];

            selectedFunds.forEach((fundName, index) => {
                const data = fundsData[fundName];
                const prices = data.map(d => d.nav);
                const smaShort = calculateMA(prices, shortPeriod);
                const smaLong = calculateMA(prices, longPeriod);
                const color = colors[index % colors.length];

                // 1. ‡∏Å‡∏£‡∏≤‡∏ü NAV
                datasets.push({
                    label: fundName,
                    data: prices,
                    borderColor: color,
                    backgroundColor: color + '33', // ‡∏™‡∏µ‡∏à‡∏≤‡∏á‡πÜ
                    borderWidth: 2,
                    tension: 0.1,
                    pointRadius: 0,
                });

                // 2. ‡∏Å‡∏£‡∏≤‡∏ü MA ‡∏™‡∏±‡πâ‡∏ô
                datasets.push({
                    label: `${fundName} MA ${shortPeriod}`,
                    data: smaShort,
                    borderColor: color,
                    borderWidth: 1.5,
                    borderDash: [5, 5], // ‡πÄ‡∏™‡πâ‡∏ô‡∏õ‡∏£‡∏∞
                    tension: 0.1,
                    pointRadius: 0,
                });

                // 3. ‡∏Å‡∏£‡∏≤‡∏ü MA ‡∏¢‡∏≤‡∏ß
                datasets.push({
                    label: `${fundName} MA ${longPeriod}`,
                    data: smaLong,
                    borderColor: color,
                    borderWidth: 2,
                    borderDash: [10, 10], // ‡πÄ‡∏™‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡∏¢‡∏≤‡∏ß
                    tension: 0.1,
                    pointRadius: 0,
                });
            });

            if (navChartInstance) {
                navChartInstance.destroy(); // ‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏Å‡πà‡∏≤
            }
            navChartInstance = new Chart(navCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    plugins: { legend: { position: 'top' }, title: { display: true, text: 'NAV and Moving Averages' } },
                    scales: { y: { beginAtZero: false } }
                }
            });

            // --- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü RSI ---
            const rsiCtx = document.getElementById('rsi-chart').getContext('2d');
            if (rsiChartInstance) {
                rsiChartInstance.destroy();
            }
            rsiChartInstance = new Chart(rsiCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: `RSI (${rsiPeriod}) - ${rsiBaseFund}`,
                            data: rsiValues,
                            borderColor: '#8b5cf6', // ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á
                            borderWidth: 2,
                            pointRadius: 0,
                            tension: 0.1,
                        },
                        // ‡πÄ‡∏™‡πâ‡∏ô Overbought
                        {
                            label: 'Overbought (70)',
                            data: Array(labels.length).fill(70),
                            borderColor: '#ef4444', // ‡∏™‡∏µ‡πÅ‡∏î‡∏á
                            borderWidth: 1.5,
                            borderDash: [5, 5],
                            pointRadius: 0,
                        },
                        // ‡πÄ‡∏™‡πâ‡∏ô Oversold
                        {
                            label: 'Oversold (30)',
                            data: Array(labels.length).fill(30),
                            borderColor: '#10b981', // ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
                            borderWidth: 1.5,
                            borderDash: [5, 5],
                            pointRadius: 0,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { position: 'top' }, title: { display: true, text: 'Relative Strength Index (RSI)' } },
                    scales: { y: { min: 0, max: 100 } }
                }
            });
        }

        // --- 3.6.3 Backtest ---
        function runBacktestAnalysis(selectedFunds) {
            backtestResultsDiv.innerHTML = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ú‡∏•‡πÄ‡∏Å‡πà‡∏≤
            const switchLimit = parseInt(document.getElementById('switch-limit').value);
            
            selectedFunds.forEach(fundName => {
                const data = fundsData[fundName];
                if (data.length < 2) return;

                const shortPeriod = parseInt(shortMAInput.value);
                const longPeriod = parseInt(longMAInput.value);
                const prices = data.map(d => d.nav);
                const smaShort = calculateMA(prices, shortPeriod);
                const smaLong = calculateMA(prices, longPeriod);

                let signals = {}; // { 2024: 2, 2025: 1 }

                for (let i = longPeriod; i < data.length; i++) {
                    const date = data[i].date;
                    const year = date.getFullYear();
                    
                    if (!signals[year]) {
                        signals[year] = 0;
                    }

                    const prevShort = smaShort[i-1];
                    const prevLong = smaLong[i-1];
                    const currShort = smaShort[i];
                    const currLong = smaLong[i];

                    // Check for Crossover
                    if ((prevShort <= prevLong && currShort > currLong) || // Golden Cross
                        (prevShort >= prevLong && currShort < currLong)) {  // Death Cross
                        
                        signals[year]++;
                    }
                }

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
                const div = document.createElement('div');
                div.className = 'p-4 bg-gray-50 rounded-lg border';
                let html = `<h4 class="font-semibold text-lg text-blue-700">${fundName}</h4><div class="mt-2 space-y-1 text-sm">`;
                
                const years = Object.keys(signals).sort((a,b) => b - a); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏õ‡∏µ (‡πÉ‡∏´‡∏°‡πà -> ‡πÄ‡∏Å‡πà‡∏≤)

                years.forEach(year => {
                    const count = signals[year];
                    const color = count > switchLimit ? 'text-red-500 font-bold' : 'text-green-600';
                    html += `<p><strong>‡∏õ‡∏µ ${year}:</strong> <span class="${color}">${count}</span> / ${switchLimit} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span></p>`;
                });

                html += `</div>`;
                div.innerHTML = html;
                backtestResultsDiv.appendChild(div);
            });
        }

        // --- 3.6.4 Suggestion ---
        function runSuggestionAnalysis(allFundStatuses) {
            suggestionResultsDiv.innerHTML = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ú‡∏•‡πÄ‡∏Å‡πà‡∏≤
            
            const heldFundName = currentFundSelect.value;
            const entryDateStr = entryDateInput.value;

            if (!heldFundName) {
                suggestionResultsDiv.innerHTML = '<p class="text-gray-500">‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà" ‡πÉ‡∏ô Sidebar (‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4) ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå"</p>';
                return;
            }

            const heldFundStatus = allFundStatuses.find(f => f.name === heldFundName);
            if (!heldFundStatus) {
                suggestionResultsDiv.innerHTML = `<p class="text-red-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô '${heldFundName}' (‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3)</p>`;
                return;
            }

            // --- 1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì P/L ---
            let plSection = '';
            if (entryDateStr) {
                const entryDate = new Date(entryDateStr);
                const fundData = fundsData[heldFundName];
                const { date: actualDate, nav: entryNav } = findNavOnDate(fundData, entryDate);
                const latestNav = fundData[fundData.length - 1].nav;
                
                if (entryNav) {
                    const plPercent = ((latestNav - entryNav) / entryNav) * 100;
                    const plColor = plPercent >= 0 ? 'text-green-600' : 'text-red-600';

                    plSection = `
                        <h4 class="text-lg font-semibold">‡∏™‡∏£‡∏∏‡∏õ‡∏û‡∏≠‡∏£‡πå‡∏ï: ${heldFundName}</h4>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <p class="text-gray-500">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤ (‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)</p>
                                <p class="font-semibold">${actualDate.toLocaleDateString('th-TH')}</p>
                            </div>
                            <div>
                                <p class="text-gray-500">NAV ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤</p>
                                <p class="font-semibold">${entryNav.toFixed(4)}</p>
                            </div>
                            <div>
                                <p class="text-gray-500">NAV ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</p>
                                <p class="font-semibold">${latestNav.toFixed(4)}</p>
                            </div>
                            <div>
                                <p class="text-gray-500">‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô</p>
                                <p class="font-bold text-xl ${plColor}">${plPercent.toFixed(2)}%</p>
                            </div>
                        </div>
                        <hr class="my-4">
                    `;
                }
            }

            // --- 2. ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ ---
            const buySignalFunds = allFundStatuses.filter(f => f.name !== heldFundName && f.isBuySignal);
            let suggestionHTML = '';

            if (heldFundStatus.isBuySignal) {
                // ‡∏Å‡∏£‡∏ì‡∏µ 1: ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠ ‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á
                suggestionHTML = `
                    <div class="p-4 rounded-lg bg-green-50 border border-green-200">
                        <h4 class="text-xl font-bold text-green-700">‚úÖ ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏ñ‡∏∑‡∏≠‡∏ï‡πà‡∏≠ (Hold)</h4>
                        <p class="mt-2 text-gray-700">
                            ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô <strong>${heldFundName}</strong> ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô <strong>${heldFundStatus.status}</strong>
                            ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡∏î‡∏µ ‡∏à‡∏∂‡∏á‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ñ‡∏∑‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô
                        </p>
                    </div>
                `;
            } else if (heldFundStatus.isSellSignal) {
                // ‡∏Å‡∏£‡∏ì‡∏µ 2: ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠ ‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏≠
                if (buySignalFunds.length > 0) {
                    // 2a: ‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏≠ ‡πÅ‡∏ï‡πà‡∏°‡∏µ‡∏Å‡∏≠‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏´‡πâ‡∏™‡∏•‡∏±‡∏ö
                    suggestionHTML = `
                        <div class="p-4 rounded-lg bg-yellow-50 border border-yellow-300">
                            <h4 class="text-xl font-bold text-yellow-700">‚ö†Ô∏è ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏™‡∏•‡∏±‡∏ö (Switch)</h4>
                            <p class="mt-2 text-gray-700">
                                ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô <strong>${heldFundName}</strong> ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ <strong>${heldFundStatus.status}</strong> (‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏Ç‡∏≤‡∏¢)
                            </p>
                            <p class="mt-3 text-gray-700">‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡∏Å‡πá‡∏ï‡∏≤‡∏° ‡∏û‡∏ö‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤:</p>
                            <ul class="list-disc list-inside mt-2 space-y-1">
                                ${buySignalFunds.map(f => `<li class="font-semibold text-green-600">${f.name} (${f.status})</li>`).join('')}
                            </ul>
                            <p class="mt-2 text-gray-700">‡∏≠‡∏≤‡∏à‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ó‡∏≥‡∏Å‡∏≥‡πÑ‡∏£</p>
                        </div>
                    `;
                } else {
                    // 2b: ‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏≠ ‡πÅ‡∏•‡∏∞‡∏Å‡∏≠‡∏á‡∏≠‡∏∑‡πà‡∏ô‡∏Å‡πá‡πÑ‡∏°‡πà‡∏î‡∏µ
                    suggestionHTML = `
                        <div class="p-4 rounded-lg bg-red-50 border border-red-200">
                            <h4 class="text-xl font-bold text-red-700">üö® ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏Ç‡∏≤‡∏¢/‡∏£‡∏≠ (Wait)</h4>
                            <p class="mt-2 text-gray-700">
                                ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô <strong>${heldFundName}</strong> ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ <strong>${heldFundStatus.status}</strong> (‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏Ç‡∏≤‡∏¢)
                                ‡πÅ‡∏•‡∏∞‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ <strong>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏≠‡∏∑‡πà‡∏ô</strong> (‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ß‡πâ) ‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
                            </p>
                            <p class="mt-2 text-gray-700">
                                ‡∏≠‡∏≤‡∏à‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏Ç‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≥ (‡πÄ‡∏ä‡πà‡∏ô ‡∏ï‡∏£‡∏≤‡∏™‡∏≤‡∏£‡∏´‡∏ô‡∏µ‡πâ, ‡πÄ‡∏á‡∏¥‡∏ô‡∏ù‡∏≤‡∏Å) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏î‡∏π‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà
                            </p>
                        </div>
                    `;
                }
            } else {
                // ‡∏Å‡∏£‡∏ì‡∏µ 3: ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠ Sideways
                suggestionHTML = `
                    <div class="p-4 rounded-lg bg-gray-100 border border-gray-200">
                        <h4 class="text-xl font-bold text-gray-700">‚öñÔ∏è ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏£‡∏≠‡∏î‡∏π‡∏ó‡πà‡∏≤‡∏ó‡∏µ (Sideways)</h4>
                        <p class="mt-2 text-gray-700">
                            ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô <strong>${heldFundName}</strong> ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
                            (‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${heldFundStatus.status}) ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏î‡∏π‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ï‡πà‡∏≠‡πÑ‡∏õ
                        </p>
                    </div>
                `;
            }

            suggestionResultsDiv.innerHTML = plSection + suggestionHTML;
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV (Restore)
        function parseCSV(file) {
            Papa.parse(file, {
                header: true,
                skipEmptyLines: true,
                dynamicTyping: true, // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÅ‡∏õ‡∏•‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
                complete: (results) => {
                    processData(results.data);
                },
                error: (err) => {
                    setStatus(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå: ${err.message}`, 'red');
                }
            });
        }

        // === 3.5 ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å: ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ===

        // (*** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏õ‡∏£‡∏±‡∏ö_‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå_‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà_‡∏ï‡∏≤‡∏°‡πÑ‡∏ü‡∏•‡πå CSV ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ***)
        // (*** ‡∏´‡∏≤‡∏Å_‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå_‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà_‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà_ 'Date' ‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç_‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ***)
        const DATE_COL = 'Date';

        function processData(data) {
            if (data.length === 0) {
                setStatus('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå', 'red');
                return;
            }

            const headers = Object.keys(data[0]);
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå 'Date' (‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤)
            if (!headers.includes(DATE_COL)) {
                setStatus(`‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô '${DATE_COL}')`, 'red');
                return;
            }

            // ‡πÅ‡∏¢‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô (‡∏Ñ‡∏∑‡∏≠‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà 'Date' ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤)
            // (‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ß‡πà‡∏≤‡∏á‡πÜ ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏≠‡∏ô‡∏ó‡πâ‡∏≤‡∏¢ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏Å‡∏£‡∏≠‡∏á‡∏≠‡∏≠‡∏Å)
            const fundNames = headers.filter(h => 
                h !== DATE_COL && 
                h.trim() !== "" &&
                !h.includes("‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á") &&  // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
                !h.includes("‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°‡∏™‡∏≥‡∏£‡∏≠‡∏á")      // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
            );

            if (fundNames.length === 0) {
                setStatus('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå (‡∏ô‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Date)', 'red');
                return;
            }

            allData = data; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö‡πÑ‡∏ß‡πâ (‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ)
            fundsData = {}; // Reset ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô
            fundNames.forEach(fundName => {
                fundsData[fundName] = [];
            });

            // "Unpivot" ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ñ‡∏ß (‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ß‡∏±‡∏ô)
            data.forEach(row => {
                const dateStr = row[DATE_COL];
                let date;

                if (typeof dateStr === 'string' && dateStr.includes('/')) {
                    const parts = dateStr.split('/'); // [dd, mm, yyyy]
                    if (parts.length === 3) {
                        const day = parts[0];
                        const month = parts[1]; // 01-12
                        let year = parseInt(parts[2]);
                        
                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô_‡∏û.‡∏®._(‡∏õ‡∏µ‡∏û‡∏∏‡∏ó‡∏ò)
                        if (year > 2500) {
                            year = year - 543; // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô_‡∏Ñ.‡∏®.
                        }
                        
                        // JavaScript Date (month is 0-indexed)
                        date = new Date(year, parseInt(month) - 1, parseInt(day));
                    } else {
                        date = new Date(dateStr); // ‡∏•‡∏≠‡∏á‡πÅ‡∏õ‡∏•‡∏á‡∏ï‡∏£‡∏á‡πÜ
                    }
                } else {
                    date = new Date(dateStr); // ‡∏•‡∏≠‡∏á‡πÅ‡∏õ‡∏•‡∏á‡∏ï‡∏£‡∏á‡πÜ
                }

                if (isNaN(date) || !date) {
                    // console.warn(`‡∏Ç‡πâ‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ${row[DATE_COL]}`);
                    return; // ‡∏Ç‡πâ‡∏≤‡∏°‡πÅ‡∏ñ‡∏ß‡∏ô‡∏µ‡πâ‡∏ñ‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                }

                // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß‡∏ô‡∏±‡πâ‡∏ô
                fundNames.forEach(fundName => {
                    let navStr = row[fundName];
                    
                    // PapaParse ‡∏≠‡∏≤‡∏à‡∏≠‡πà‡∏≤‡∏ô '21,254.12' ‡πÄ‡∏õ‡πá‡∏ô string
                    if (typeof navStr === 'string') {
                        navStr = navStr.replace(/,/g, ''); // ‡∏•‡∏ö comma ‡∏≠‡∏≠‡∏Å
                    }

                    const nav = parseFloat(navStr);

                    if (!isNaN(nav) && nav > 0) { // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                        fundsData[fundName].push({
                            date: date,
                            nav: nav
                        });
                    }
                });
            });

            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡πÄ‡∏Å‡πà‡∏≤ -> ‡πÉ‡∏´‡∏°‡πà)
            // (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå CSV ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å ‡πÉ‡∏´‡∏°‡πà -> ‡πÄ‡∏Å‡πà‡∏≤)
            for (const fund in fundsData) {
                fundsData[fund].sort((a, b) => a.date - b.date);
            }

            // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡πÉ‡∏ô Sidebar
            populateFundSelector();
            setStatus(`‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${Object.keys(fundsData).length} ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, 'green');
        }

        // === 3.7 ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì (Technical Analysis) ===

        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Simple Moving Average (MA)
        function calculateMA(data, period) {
            let results = [];
            for (let i = 0; i < data.length; i++) {
                if (i < period - 1) {
                    results.push(NaN); // ‡∏¢‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
                } else {
                    let sum = 0;
                    for (let k = 0; k < period; k++) {
                        sum += data[i - k];
                    }
                    results.push(sum / period);
                }
            }
            return results;
        }

        // === 3.7 ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì (Technical Analysis) ===
        function calculateRSI(data, period) {
            let gains = [];
            let losses = [];
            let rsi = [];

            // 1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Gains/Losses
            for (let i = 1; i < data.length; i++) {
                const change = data[i] - data[i-1];
                gains.push(change > 0 ? change : 0);
                losses.push(change < 0 ? Math.abs(change) : 0);
            }

            // 2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Average Gain/Loss ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            let avgGain = 0;
            let avgLoss = 0;
            for (let i = 0; i < period; i++) {
                avgGain += gains[i];
                avgLoss += losses[i];
            }
            avgGain /= period;
            avgLoss /= period;
            
            // 3. ‡πÄ‡∏ï‡∏¥‡∏° NaN ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡∏à‡∏∏‡∏î‡πÅ‡∏£‡∏Å)
            for(let i=0; i < period; i++) {
                rsi.push(NaN);
            }

            // 4. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì RSI ‡πÅ‡∏£‡∏Å
            let rs = (avgLoss === 0) ? 100 : avgGain / avgLoss;
            rsi.push(100 - (100 / (1 + rs)));

            // 5. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì RSI ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (Smooth)
            for (let i = period + 1; i < data.length; i++) {
                avgGain = ((avgGain * (period - 1)) + gains[i-1]) / period;
                avgLoss = ((avgLoss * (period - 1)) + losses[i-1]) / period;
                
                rs = (avgLoss === 0) ? 100 : avgGain / avgLoss;
                rsi.push(100 - (100 / (1 + rs)));
            }

            return rsi;
        }

        // === 3.8 ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ===
        function setStatus(message, color) {
            statusMessage.textContent = message;
            if (color === 'green') {
                statusMessage.className = 'text-green-600';
            } else if (color === 'red') {
                statusMessage.className = 'text-red-600';
            } else {
                statusMessage.className = 'text-blue-600';
            }
        }

        // (‡πÉ‡∏´‡∏°‡πà) ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ NAV ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î (‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏Å‡πâ‡∏•‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)
        function findNavOnDate(fundData, targetDate) {
            if (!fundData || fundData.length === 0) {
                return { date: null, nav: null };
            }

            // ‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡πâ‡∏•‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î)
            let closestData = fundData[0];
            let minDiff = Math.abs(targetDate - closestData.date);

            for (let i = 1; i < fundData.length; i++) {
                const currentDiff = Math.abs(targetDate - fundData[i].date);
                if (currentDiff < minDiff) {
                    minDiff = currentDiff;
                    closestData = fundData[i];
                }
            }
            
            return closestData; // { date: Date, nav: Number }
        }

    </script>
</body>
</html>