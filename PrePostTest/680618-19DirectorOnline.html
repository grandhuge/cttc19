<html lang="th"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>โปรแกรมแสดงผลคะแนนการทำแบบทดสอบก่อน-หลังอบรม</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&amp;display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        softblue: '#a6d8f5',
                        softmint: '#c3f0d4',
                        softpink: '#ffd6e0',
                        softpurple: '#e5d4f0',
                        softgray: '#f0f0f0',
                    },
                    fontFamily: {
                        prompt: ['Prompt', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Prompt', sans-serif;
            background-color: #f8f9fa;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #c3f0d4 0%, #a6d8f5 50%, #ffd6e0 100%);
        }
        .card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .table-container {
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th {
            cursor: pointer;
            position: relative;
        }
        th:hover {
            background-color: #f0f0f0;
        }
        th::after {
            content: '';
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
        }
        th.sort-asc::after {
            content: '▲';
        }
        th.sort-desc::after {
            content: '▼';
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #a6d8f5;
            border-top: 5px solid #ffd6e0;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .highlight {
            background-color: #fffde7;
        }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.16 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.container{width:100%}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.absolute{position:absolute}.relative{position:relative}.right-3{right:0.75rem}.top-2\.5{top:0.625rem}.mx-auto{margin-left:auto;margin-right:auto}.mb-2{margin-bottom:0.5rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.ml-4{margin-left:1rem}.mr-4{margin-right:1rem}.mt-2{margin-top:0.5rem}.mt-auto{margin-top:auto}.inline-block{display:inline-block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.min-h-screen{min-height:100vh}.w-full{width:100%}.min-w-full{min-width:100%}.max-w-4xl{max-width:56rem}.flex-grow{flex-grow:1}.list-inside{list-style-position:inside}.list-decimal{list-style-type:decimal}.grid-cols-1{grid-template-columns:repeat(1, minmax(0, 1fr))}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.gap-8{gap:2rem}.overflow-hidden{overflow:hidden}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:0.5rem}.rounded-xl{border-radius:0.75rem}.border{border-width:1px}.border-b{border-bottom-width:1px}.border-l-4{border-left-width:4px}.border-gray-300{--tw-border-opacity:1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1))}.border-softblue{--tw-border-opacity:1;border-color:rgb(166 216 245 / var(--tw-border-opacity, 1))}.border-softmint{--tw-border-opacity:1;border-color:rgb(195 240 212 / var(--tw-border-opacity, 1))}.border-softpink{--tw-border-opacity:1;border-color:rgb(255 214 224 / var(--tw-border-opacity, 1))}.border-softpurple{--tw-border-opacity:1;border-color:rgb(229 212 240 / var(--tw-border-opacity, 1))}.bg-gray-50{--tw-bg-opacity:1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1))}.bg-gray-800{--tw-bg-opacity:1;background-color:rgb(31 41 55 / var(--tw-bg-opacity, 1))}.bg-softblue{--tw-bg-opacity:1;background-color:rgb(166 216 245 / var(--tw-bg-opacity, 1))}.bg-softmint{--tw-bg-opacity:1;background-color:rgb(195 240 212 / var(--tw-bg-opacity, 1))}.bg-softpink{--tw-bg-opacity:1;background-color:rgb(255 214 224 / var(--tw-bg-opacity, 1))}.bg-softpurple{--tw-bg-opacity:1;background-color:rgb(229 212 240 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-opacity-20{--tw-bg-opacity:0.2}.p-3{padding:0.75rem}.p-6{padding:1.5rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-12{padding-top:3rem;padding-bottom:3rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.py-6{padding-top:1.5rem;padding-bottom:1.5rem}.py-8{padding-top:2rem;padding-bottom:2rem}.text-left{text-align:left}.text-center{text-align:center}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-5xl{font-size:3rem;line-height:1}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-semibold{font-weight:600}.uppercase{text-transform:uppercase}.tracking-wider{letter-spacing:0.05em}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175 / var(--tw-text-opacity, 1))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128 / var(--tw-text-opacity, 1))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.shadow{--tw-shadow:0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.transition{transition-property:color, background-color, border-color, fill, stroke, opacity, box-shadow, transform, filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.duration-300{transition-duration:300ms}.hover\:bg-blue-300:hover{--tw-bg-opacity:1;background-color:rgb(147 197 253 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-100:hover{--tw-bg-opacity:1;background-color:rgb(243 244 246 / var(--tw-bg-opacity, 1))}.hover\:bg-pink-300:hover{--tw-bg-opacity:1;background-color:rgb(249 168 212 / var(--tw-bg-opacity, 1))}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\:ring-2:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}.focus\:ring-softblue:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(166 216 245 / var(--tw-ring-opacity, 1))}@media (min-width: 640px){.sm\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}}@media (min-width: 768px){.md\:mb-0{margin-bottom:0px}.md\:w-80{width:20rem}.md\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.md\:flex-row{flex-direction:row}.md\:items-center{align-items:center}.md\:text-3xl{font-size:1.875rem;line-height:2.25rem}.md\:text-5xl{font-size:3rem;line-height:1}}@media (min-width: 1024px){.lg\:grid-cols-4{grid-template-columns:repeat(4, minmax(0, 1fr))}}</style></head>
<body class="bg-gray-50">
    <div id="loading" class="loading-overlay hidden">
        <div class="spinner"></div>
    </div>

    <!-- Cover Page -->
    <div id="coverPage" class="min-h-screen flex flex-col">
        <div class="gradient-bg py-8 px-4 shadow-md">
            <div class="container mx-auto text-center">
                <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-2">โปรแกรมแสดงผลคะแนนการทำแบบทดสอบก่อน-หลังอบรม</h1>
                <h2 class="text-2xl md:text-3xl font-medium text-gray-700">โครงการพัฒนาศักยภาพกรรมการออนไลน์</h2>
            </div>
        </div>

        <div class="container mx-auto flex-grow flex flex-col items-center justify-center px-4 py-12">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 w-full max-w-4xl">
                <div class="card bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="bg-softblue p-6 text-center">
                        <div class="text-5xl mb-4">📝</div>
                        <h3 class="text-2xl font-semibold text-gray-800">ทำแบบทดสอบ</h3>
                    </div>
                    <div class="p-6 text-center">
                        <p class="text-gray-600 mb-6">คลิกที่ปุ่มด้านล่างเพื่อทำแบบทดสอบก่อนหรือหลังการอบรม</p>
                        <a href="https://docs.google.com/forms/d/e/1FAIpQLSeHRZaUu-np--Y6a96k_1NIWJtrxvS0wEYc9yw9nUJh7nFTPA/viewform?usp=dialog" target="_blank" class="inline-block bg-softblue hover:bg-blue-300 text-gray-800 font-medium py-3 px-6 rounded-lg transition duration-300">
                            ทำแบบทดสอบ
                        </a>
                    </div>
                </div>

                <div class="card bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="bg-softpink p-6 text-center">
                        <div class="text-5xl mb-4">📊</div>
                        <h3 class="text-2xl font-semibold text-gray-800">ดูคะแนน</h3>
                    </div>
                    <div class="p-6 text-center">
                        <p class="text-gray-600 mb-6">คลิกที่ปุ่มด้านล่างเพื่อดูผลคะแนนการทำแบบทดสอบ</p>
                        <button onclick="showDashboard()" class="bg-softpink hover:bg-pink-300 text-gray-800 font-medium py-3 px-6 rounded-lg transition duration-300">
                            ดูคะแนน
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboardPage" class="min-h-screen flex flex-col hidden">
        <div class="gradient-bg py-6 px-4 shadow-md">
            <div class="container mx-auto flex flex-col md:flex-row justify-between items-center">
                <h1 class="text-3xl font-bold text-gray-800 mb-4 md:mb-0">ผลคะแนนการทำแบบทดสอบ</h1>
                <button onclick="showCoverPage()" class="bg-white hover:bg-gray-100 text-gray-800 font-medium py-2 px-4 rounded-lg transition duration-300 shadow">
                    กลับหน้าหลัก
                </button>
            </div>
        </div>

        <div class="container mx-auto px-4 py-8">
            <!-- Criteria Info Box -->
            <div class="bg-softblue bg-opacity-20 rounded-xl p-6 mb-8 border-l-4 border-softblue">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">เกณฑ์การประเมินผล</h3>
                <p class="text-gray-700">ผู้ผ่านเกณฑ์ต้องผ่านคุณสมบัติทั้ง 3 ข้อดังนี้</p>
                <ol class="list-decimal list-inside mt-2 ml-4 text-gray-700">
                    <li>ทำแบบทดสอบครบทั้งก่อนและหลังอบรม</li>
                    <li>คะแนนหลังอบรมไม่น้อยกว่า 12 คะแนน</li>
                    <li>คะแนนหลังอบรมไม่น้อยกว่าก่อนอบรม</li>
                </ol>
                <p class="text-gray-700 mt-2"><em>หมายเหตุ: หากผู้เข้าอบรมทำแบบทดสอบหลังอบรมมากกว่า 1 ครั้ง จะใช้คะแนนครั้งที่มากกว่ามาเป็นเกณฑ์ประเมินผล</em></p>
            </div>

            <!-- Summary Cards -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow p-6 border-l-4 border-softblue">
                    <div class="flex items-center">
                        <div class="bg-softblue bg-opacity-20 p-3 rounded-full mr-4">
                            <span class="text-2xl">👥</span>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">ผู้ลงทะเบียนทั้งหมด</p>
                            <h3 id="totalRegistered" class="text-2xl font-bold text-gray-800">0</h3>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow p-6 border-l-4 border-softmint">
                    <div class="flex items-center">
                        <div class="bg-softmint bg-opacity-20 p-3 rounded-full mr-4">
                            <span class="text-2xl">📝</span>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">ผู้ทำแบบทดสอบทั้งหมด</p>
                            <h3 id="totalTested" class="text-2xl font-bold text-gray-800">0</h3>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow p-6 border-l-4 border-softpink">
                    <div class="flex items-center">
                        <div class="bg-softpink bg-opacity-20 p-3 rounded-full mr-4">
                            <span class="text-2xl">✅</span>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">ผู้ผ่านเกณฑ์</p>
                            <h3 id="totalPassed" class="text-2xl font-bold text-gray-800">0</h3>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow p-6 border-l-4 border-softpurple">
                    <div class="flex items-center">
                        <div class="bg-softpurple bg-opacity-20 p-3 rounded-full mr-4">
                            <span class="text-2xl">❌</span>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">ผู้ไม่ผ่านเกณฑ์</p>
                            <h3 id="totalFailed" class="text-2xl font-bold text-gray-800">0</h3>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Search Box -->
            <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                    <h2 class="text-xl font-semibold text-gray-800">รายชื่อผู้ทำแบบทดสอบ</h2>
                    <div class="relative">
                        <input type="text" id="searchInput" placeholder="ค้นหารายชื่อ..." class="w-full md:w-80 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-softblue">
                        <span class="absolute right-3 top-2.5 text-gray-400">🔍</span>
                    </div>
                </div>
            </div>

            <!-- Table -->
            <div class="bg-white rounded-xl shadow-md overflow-hidden">
                <div class="table-container">
                    <table class="min-w-full">
                        <thead>
                            <tr class="bg-gray-50 border-b">
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(0)">คำนำหน้า</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(1)">ชื่อ - นามสกุล</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(2)">สหกรณ์</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(3)">จังหวัด</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(4)">คะแนนก่อนอบรม</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(5)">คะแนนหลังอบรม</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(6)">ผลประเมิน</th>
                            </tr>
                        </thead>
                        <tbody id="resultTable">
                            <!-- Data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <footer class="bg-gray-800 text-white py-6 mt-auto">
            <div class="container mx-auto px-4 text-center">
                <p>© 2025 developed by Tle Narongphisit | ศูนย์ถ่ายทอดเทคโนโลยีการสหกรณ์ที่ 19 จังหวัดสุราษฎร์ธานี</p>
            </div>
        </footer>
    </div>

    <script>
        // Global variables
        let registrationData = [];
        let testScoreData = [];
        let combinedData = [];
        let currentSortColumn = 1; // Default sort by name
        let currentSortDirection = 'asc'; // Default sort direction

        // Show loading spinner
        function showLoading() {
            document.getElementById('loading').classList.remove('hidden');
        }

        // Hide loading spinner
        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
        }

        // Switch between pages
        function showCoverPage() {
            document.getElementById('dashboardPage').classList.add('hidden');
            document.getElementById('coverPage').classList.remove('hidden');
        }

        function showDashboard() {
            showLoading();
            document.getElementById('coverPage').classList.add('hidden');
            document.getElementById('dashboardPage').classList.remove('hidden');
            fetchData();
        }

        // Fetch data using JSONP
        function fetchData() {
            // Create a unique callback name
            const callbackName = 'jsonpCallback_' + Math.round(Math.random() * 1000000);
            
            // Define the callback function
            window[callbackName] = function(data) {
                processData(data);
                // Clean up the script tag and callback function
                document.body.removeChild(document.getElementById('jsonpScript'));
                delete window[callbackName];
                hideLoading();
            };
            
            // Create script tag for JSONP request
            const script = document.createElement('script');
            script.id = 'jsonpScript';
            script.src = `https://script.google.com/macros/s/AKfycbxgtBPdY3jGSOjjAjeHmiV6GyJMn8d12lblMV0mn0DfYdDfWe__2bcadRADIiLMn1a1VA/exec?callback=${callbackName}`;
            document.body.appendChild(script);
            
            // Handle timeout
            setTimeout(function() {
                if (window[callbackName]) {
                    alert('การเชื่อมต่อล้มเหลว กรุณาลองใหม่อีกครั้ง');
                    hideLoading();
                    delete window[callbackName];
                    if (document.getElementById('jsonpScript')) {
                        document.body.removeChild(document.getElementById('jsonpScript'));
                    }
                }
            }, 10000); // 10 seconds timeout
        }

        // Process the data received from the API
        function processData(data) {
            if (!data || !data.registrationData || !data.testScoreData) {
                alert('ไม่สามารถดึงข้อมูลได้ กรุณาลองใหม่อีกครั้ง');
                return;
            }
            
            registrationData = data.registrationData;
            testScoreData = data.testScoreData;
            
            // Process and combine data
            combinedData = processAndCombineData(registrationData, testScoreData);
            
            // Update the UI
            updateUI(combinedData);
        }

        // Process and combine data from both sources
        function processAndCombineData(registrationData, testScoreData) {
            const combined = [];
            const nameMap = new Map();
            
            // Process registration data - filter out duplicates
            const processedNames = new Set();
            
            // Skip header row if it exists
            const startIdx = registrationData.length > 0 && !registrationData[0]['ชื่อ-นามสกุล'] ? 1 : 0;
            
            for (let i = startIdx; i < registrationData.length; i++) {
                const person = registrationData[i];
                if (!person['ชื่อ-นามสกุล']) continue; // Skip if no name
                
                const name = person['ชื่อ-นามสกุล'].trim();
                
                // Skip duplicates
                if (processedNames.has(name)) continue;
                processedNames.add(name);
                
                nameMap.set(name, {
                    prefix: person['คำนำหน้า'] || '',
                    name: name,
                    cooperative: person['สังกัดสหกรณ์'] || '',
                    province: person['จังหวัด'] || '',
                    preScore: null,
                    postScore: null,
                    evaluation: 'ไม่ได้ทำแบบทดสอบ'
                });
            }
            
            // Process test score data
            const preScores = new Map();
            const postScores = new Map();
            
            // Skip header row if it exists
            const testStartIdx = testScoreData.length > 0 && !testScoreData[0]['ชื่อ-นามสกุล'] ? 1 : 0;
            
            for (let i = testStartIdx; i < testScoreData.length; i++) {
                const score = testScoreData[i];
                if (!score['ชื่อ-นามสกุล']) continue; // Skip if no name
                
                const name = score['ชื่อ-นามสกุล'].trim();
                const scoreValue = parseInt(score['คะแนน']) || 0;
                const testType = score['ประเภทการทดสอบ'];
                
                if (testType === 'ก่อนอบรม') {
                    if (!preScores.has(name) || scoreValue > preScores.get(name)) {
                        preScores.set(name, scoreValue);
                    }
                } else if (testType === 'หลังอบรม') {
                    if (!postScores.has(name) || scoreValue > postScores.get(name)) {
                        postScores.set(name, scoreValue);
                    }
                }
                
                // If person is not in registration data, add them
                if (!nameMap.has(name)) {
                    nameMap.set(name, {
                        prefix: '',
                        name: name,
                        cooperative: '',
                        province: '',
                        preScore: null,
                        postScore: null,
                        evaluation: 'ไม่ได้ลงทะเบียน'
                    });
                }
            }
            
            // Update scores and evaluate
            nameMap.forEach((person, name) => {
                person.preScore = preScores.has(name) ? preScores.get(name) : null;
                person.postScore = postScores.has(name) ? postScores.get(name) : null;
                
                // Evaluate based on all three criteria
                if (person.preScore !== null && person.postScore !== null) {
                    // Check all three criteria
                    const criterion1 = true; // Both tests taken
                    const criterion2 = person.postScore >= 12;
                    const criterion3 = person.postScore >= person.preScore;
                    
                    if (criterion1 && criterion2 && criterion3) {
                        person.evaluation = 'ผ่าน';
                    } else {
                        // Provide specific reason for failure
                        if (!criterion2 && !criterion3) {
                            person.evaluation = 'ไม่ผ่าน (คะแนนหลังอบรมน้อยกว่า 12 และน้อยกว่าก่อนอบรม)';
                        } else if (!criterion2) {
                            person.evaluation = 'ไม่ผ่าน (คะแนนหลังอบรมน้อยกว่า 12)';
                        } else if (!criterion3) {
                            person.evaluation = 'ไม่ผ่าน (คะแนนหลังอบรมน้อยกว่าก่อนอบรม)';
                        } else {
                            person.evaluation = 'ไม่ผ่าน';
                        }
                    }
                } else if (person.postScore !== null) {
                    if (person.postScore >= 12) {
                        person.evaluation = 'ไม่ผ่าน (ไม่ได้ทำแบบทดสอบก่อนอบรม)';
                    } else {
                        person.evaluation = 'ไม่ผ่าน (คะแนนหลังอบรมน้อยกว่า 12 และไม่ได้ทำแบบทดสอบก่อนอบรม)';
                    }
                } else if (person.preScore !== null) {
                    person.evaluation = 'ไม่ผ่าน (ไม่ได้ทำแบบทดสอบหลังอบรม)';
                }
                
                combined.push(person);
            });
            
            // Sort by name (default)
            return combined.sort((a, b) => a.name.localeCompare(b.name, 'th'));
        }

        // Update the UI with the processed data
        function updateUI(data) {
            // Count unique registered participants (after removing duplicates)
            const uniqueRegistered = data.filter(item => 
                item.evaluation !== 'ไม่ได้ลงทะเบียน'
            ).length;
            
            // Count unique testers (people who took at least one test)
            const uniqueTesters = data.filter(item => 
                item.preScore !== null || item.postScore !== null
            ).length;
            
            // Count passed participants (must meet all three criteria)
            const passedCount = data.filter(item => item.evaluation === 'ผ่าน').length;
            
            // Count failed participants (took at least one test but didn't pass)
            const failedCount = data.filter(item => 
                (item.preScore !== null || item.postScore !== null) && 
                item.evaluation !== 'ผ่าน'
            ).length;
            
            document.getElementById('totalRegistered').textContent = uniqueRegistered;
            document.getElementById('totalTested').textContent = uniqueTesters;
            document.getElementById('totalPassed').textContent = passedCount;
            document.getElementById('totalFailed').textContent = failedCount;
            
            // Update table
            renderTable(data);
            
            // Set up search functionality
            document.getElementById('searchInput').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const filteredData = data.filter(item => 
                    item.name.toLowerCase().includes(searchTerm)
                );
                renderTable(filteredData, searchTerm);
            });
        }

        // Render the table with data
        function renderTable(data, searchTerm = '') {
            const tableBody = document.getElementById('resultTable');
            tableBody.innerHTML = '';
            
            if (data.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="7" class="px-6 py-4 text-center text-gray-500">ไม่พบข้อมูล</td>`;
                tableBody.appendChild(row);
                return;
            }
            
            data.forEach(person => {
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-50';
                
                // Determine evaluation color
                const evaluationColor = person.evaluation === 'ผ่าน' ? 'text-green-600' : 'text-red-600';
                
                // Highlight search term in name if provided
                let displayName = person.name;
                if (searchTerm) {
                    const lowerName = person.name.toLowerCase();
                    const index = lowerName.indexOf(searchTerm);
                    if (index >= 0) {
                        const before = person.name.substring(0, index);
                        const match = person.name.substring(index, index + searchTerm.length);
                        const after = person.name.substring(index + searchTerm.length);
                        displayName = `${before}<span class="bg-yellow-200">${match}</span>${after}`;
                    }
                }
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${person.prefix}</td>
                    <td class="px-6 py-4 whitespace-nowrap font-medium">${displayName}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${person.cooperative}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${person.province}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${person.preScore !== null ? person.preScore : '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${person.postScore !== null ? person.postScore : '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap ${evaluationColor}">${person.evaluation}</td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // Sort table by column
        function sortTable(columnIndex) {
            // Reset all headers
            const headers = document.querySelectorAll('th');
            headers.forEach(header => {
                header.classList.remove('sort-asc', 'sort-desc');
            });
            
            // If clicking the same column, toggle direction
            if (currentSortColumn === columnIndex) {
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortColumn = columnIndex;
                currentSortDirection = 'asc';
            }
            
            // Add sort indicator to header
            headers[columnIndex].classList.add(currentSortDirection === 'asc' ? 'sort-asc' : 'sort-desc');
            
            // Sort data
            combinedData.sort((a, b) => {
                let valueA, valueB;
                
                switch (columnIndex) {
                    case 0: // Prefix
                        valueA = a.prefix;
                        valueB = b.prefix;
                        break;
                    case 1: // Name
                        valueA = a.name;
                        valueB = b.name;
                        break;
                    case 2: // Cooperative
                        valueA = a.cooperative;
                        valueB = b.cooperative;
                        break;
                    case 3: // Province
                        valueA = a.province;
                        valueB = b.province;
                        break;
                    case 4: // Pre-score
                        valueA = a.preScore === null ? -1 : a.preScore;
                        valueB = b.preScore === null ? -1 : b.preScore;
                        return currentSortDirection === 'asc' ? valueA - valueB : valueB - valueA;
                    case 5: // Post-score
                        valueA = a.postScore === null ? -1 : a.postScore;
                        valueB = b.postScore === null ? -1 : b.postScore;
                        return currentSortDirection === 'asc' ? valueA - valueB : valueB - valueA;
                    case 6: // Evaluation
                        valueA = a.evaluation;
                        valueB = b.evaluation;
                        break;
                }
                
                // String comparison for text columns
                if (currentSortDirection === 'asc') {
                    return valueA.localeCompare(valueB, 'th');
                } else {
                    return valueB.localeCompare(valueA, 'th');
                }
            });
            
            // Apply search filter if there's a search term
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                const filteredData = combinedData.filter(item => 
                    item.name.toLowerCase().includes(searchTerm)
                );
                renderTable(filteredData, searchTerm);
            } else {
                renderTable(combinedData);
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'94c8637e320455a1',t:'MTc0OTM4NTcwMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><iframe height="1" width="1" style="position: absolute; top: 0px; left: 0px; border: none; visibility: hidden;"></iframe>

</body></html>