<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÑ‡∏ã‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏î‡πá‡∏Å</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Kanit', sans-serif;
        }
        
        .game-card {
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        .badge {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .website-card {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .website-card:hover {
            transform: scale(1.02);
        }
        
        .correct {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            animation: correctPulse 0.5s ease;
        }
        
        .incorrect {
            background: linear-gradient(135deg, #f87171, #ef4444);
            animation: shake 0.5s ease;
        }
        
        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .draggable {
            cursor: grab;
            transition: all 0.2s ease;
        }
        
        .draggable:active {
            cursor: grabbing;
            transform: rotate(5deg);
        }
        
        .drop-zone {
            min-height: 60px;
            border: 2px dashed #cbd5e1;
            transition: all 0.2s ease;
        }
        
        .drop-zone.drag-over {
            border-color: #3b82f6;
            background-color: #dbeafe;
        }
        
        .timer-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: conic-gradient(#ef4444 0deg, #fbbf24 0deg);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            animation: timerPulse 1s infinite;
        }
        
        .timer-circle.warning {
            animation: timerWarning 0.5s infinite;
        }
        
        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes timerWarning {
            0%, 100% { transform: scale(1); background-color: #ef4444; }
            50% { transform: scale(1.1); background-color: #dc2626; }
        }
        
        .button-click {
            animation: buttonClick 0.2s ease;
        }
        
        @keyframes buttonClick {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }
        
        .score-popup {
            animation: scorePopup 1s ease;
        }
        
        @keyframes scorePopup {
            0% { transform: scale(0) rotate(180deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(0deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #fbbf24;
            animation: confetti 3s ease-out forwards;
            z-index: 1000;
        }
        
        @keyframes confetti {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        .floating-text {
            position: absolute;
            font-weight: bold;
            font-size: 1.5rem;
            animation: floatingText 2s ease-out forwards;
            pointer-events: none;
            z-index: 100;
        }
        
        @keyframes floatingText {
            0% {
                transform: translateY(0);
                opacity: 1;
            }
            100% {
                transform: translateY(-50px);
                opacity: 0;
            }
        }
        
        .stats-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            transition: all 0.3s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-400 via-pink-500 to-red-500 min-h-screen">
    <!-- Header -->
    <div class="bg-white/20 backdrop-blur-sm border-b border-white/30">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <img src="https://cttc19.onrender.com/game/img/logo.png" alt="CTTC19 Logo" class="w-12 h-12 rounded-lg bg-white/20 p-1" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <div class="text-4xl hidden">üõ°Ô∏è</div>
                    <div>
                        <h1 class="text-xl md:text-2xl font-bold text-white">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÅ‡∏ö‡∏ö‡πÄ‡∏Å‡∏°</h1>
                        <p class="text-white/80 text-xs md:text-sm">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤</p>
                        <p class="text-white/70 text-xs font-semibold">‡πÇ‡∏ã‡∏ô 4: ‡∏≠‡∏±‡∏®‡∏ß‡∏¥‡∏ô‡πÑ‡∏ã‡πÄ‡∏ö‡∏≠‡∏£‡πå (Cyber Knight - Level 4)</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="bg-white/20 rounded-full px-4 py-2">
                        <span class="text-white font-semibold">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="totalScore">0</span></span>
                    </div>
                    <button onclick="showStats()" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-full transition-colors">
                        üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
                    </button>
                    <div id="badges" class="flex space-x-2"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        <!-- Game Selection -->
        <div id="gameSelection" class="space-y-6">
            <div class="text-center mb-8">
                <div class="flex justify-center mb-4">
                    <img src="https://cttc19.onrender.com/game/img/mascot.gif" alt="Cyber Knight Mascot" class="w-24 h-24 rounded-full bg-white/20 p-2" onerror="this.style.display='none';">
                </div>
                <h2 class="text-3xl font-bold text-white mb-4">üéÆ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</h2>
                <p class="text-white/90 mb-4">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ!</p>
                <div class="bg-white/10 backdrop-blur-sm rounded-xl p-4 max-w-4xl mx-auto">
                    <h3 class="text-lg font-semibold text-white mb-3">üìã ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</h3>
                    <div class="grid md:grid-cols-3 gap-4 text-sm text-white/90">
                        <div class="bg-white/10 rounded-lg p-3">
                            <div class="text-2xl mb-2">üåê</div>
                            <div class="font-semibold mb-1">‡πÄ‡∏Å‡∏°‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡∏î‡∏µ-‡πÄ‡∏ß‡πá‡∏ö‡∏õ‡∏•‡∏≠‡∏°</div>
                            <p class="text-xs">‡∏î‡∏π‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÄ‡∏ß‡πá‡∏ö‡∏õ‡∏•‡∏≠‡∏°‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏´‡∏•‡∏≠‡∏Å‡∏•‡∏ß‡∏á!</p>
                        </div>
                        <div class="bg-white/10 rounded-lg p-3">
                            <div class="text-2xl mb-2">üëÆ‚Äç‚ôÇÔ∏è</div>
                            <div class="font-semibold mb-1">‡πÉ‡∏Ñ‡∏£‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏£‡πâ‡∏≤‡∏¢‡πÑ‡∏ã‡πÄ‡∏ö‡∏≠‡∏£‡πå</div>
                            <p class="text-xs">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏±‡πâ‡∏ô‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</p>
                        </div>
                        <div class="bg-white/10 rounded-lg p-3">
                            <div class="text-2xl mb-2">üîç</div>
                            <div class="font-semibold mb-1">‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>
                            <p class="text-xs">‡∏•‡∏≤‡∏Å‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- High Score Summary Section -->
            <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6 mb-8">
                <h3 class="text-2xl font-bold text-white text-center mb-6 flex items-center justify-center">
                    üèÜ ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
                </h3>
                <div class="grid md:grid-cols-3 gap-4">
                    <div class="bg-gradient-to-br from-blue-500/20 to-purple-500/20 rounded-xl p-4 text-white text-center border border-white/20">
                        <div class="text-3xl mb-2">üåê</div>
                        <div class="font-semibold text-sm mb-1">‡πÄ‡∏ß‡πá‡∏ö‡∏î‡∏µ-‡πÄ‡∏ß‡πá‡∏ö‡∏õ‡∏•‡∏≠‡∏°</div>
                        <div class="text-2xl font-bold text-yellow-300" id="mainHighScore1">0</div>
                        <div class="text-xs opacity-80">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                        <div class="text-xs opacity-70 mt-1">
                            ‡πÄ‡∏ß‡∏•‡∏≤: <span id="mainHighTime1">-</span>
                        </div>
                        <div class="text-xs opacity-70">
                            ‡πÄ‡∏•‡πà‡∏ô: <span id="mainPlayCount1">0</span> ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-green-500/20 to-blue-500/20 rounded-xl p-4 text-white text-center border border-white/20">
                        <div class="text-3xl mb-2">üëÆ‚Äç‚ôÇÔ∏è</div>
                        <div class="font-semibold text-sm mb-1">‡∏ú‡∏π‡πâ‡∏£‡πâ‡∏≤‡∏¢‡πÑ‡∏ã‡πÄ‡∏ö‡∏≠‡∏£‡πå</div>
                        <div class="text-2xl font-bold text-yellow-300" id="mainHighScore2">0</div>
                        <div class="text-xs opacity-80">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                        <div class="text-xs opacity-70 mt-1">
                            ‡πÄ‡∏ß‡∏•‡∏≤: <span id="mainHighTime2">-</span>
                        </div>
                        <div class="text-xs opacity-70">
                            ‡πÄ‡∏•‡πà‡∏ô: <span id="mainPlayCount2">0</span> ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-purple-500/20 to-pink-500/20 rounded-xl p-4 text-white text-center border border-white/20">
                        <div class="text-3xl mb-2">üîç</div>
                        <div class="font-semibold text-sm mb-1">‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô</div>
                        <div class="text-2xl font-bold text-yellow-300" id="mainHighScore3">0</div>
                        <div class="text-xs opacity-80">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                        <div class="text-xs opacity-70 mt-1">
                            ‡πÄ‡∏ß‡∏•‡∏≤: <span id="mainHighTime3">-</span>
                        </div>
                        <div class="text-xs opacity-70">
                            ‡πÄ‡∏•‡πà‡∏ô: <span id="mainPlayCount3">0</span> ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                        </div>
                    </div>
                </div>
                
                <!-- Overall Stats -->
                <div class="mt-6 grid md:grid-cols-2 gap-4">
                    <div class="bg-gradient-to-r from-yellow-500/20 to-orange-500/20 rounded-xl p-4 text-white text-center border border-white/20">
                        <div class="text-2xl mb-2">üéØ</div>
                        <div class="font-semibold text-sm mb-1">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        <div class="text-xl font-bold text-yellow-300" id="mainTotalScore">0</div>
                    </div>
                    <div class="bg-gradient-to-r from-pink-500/20 to-red-500/20 rounded-xl p-4 text-white text-center border border-white/20">
                        <div class="text-2xl mb-2">üèÖ</div>
                        <div class="font-semibold text-sm mb-1">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</div>
                        <div class="text-xl font-bold text-yellow-300" id="mainTotalBadges">0</div>
                    </div>
                </div>
            </div>

            <div class="grid md:grid-cols-3 gap-6">
                <!-- Game 1 -->
                <div class="game-card rounded-2xl p-6 text-white cursor-pointer" onclick="startGame(1)">
                    <div class="text-center">
                        <div class="text-6xl mb-4">üåê</div>
                        <h3 class="text-xl font-bold mb-2">‡πÄ‡∏Å‡∏°‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡∏î‡∏µ-‡πÄ‡∏ß‡πá‡∏ö‡∏õ‡∏•‡∏≠‡∏°</h3>
                        <p class="text-sm opacity-90 mb-3">‡∏ù‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡πÅ‡∏¢‡∏∞‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</p>
                        <div class="bg-white/10 rounded-lg p-2 mb-3 text-xs">
                            <p>‚Ä¢ ‡∏î‡∏π URL ‡πÅ‡∏•‡∏∞‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</p>
                            <p>‚Ä¢ ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÄ‡∏ß‡πá‡∏ö‡∏õ‡∏•‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏≠‡∏Å‡∏•‡∏ß‡∏á</p>
                            <p>‚Ä¢ ‡πÄ‡∏ß‡∏•‡∏≤: 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ/‡∏Ç‡πâ‡∏≠</p>
                        </div>
                        <div class="bg-white/20 rounded-full px-3 py-1 text-xs mb-2">
                            ‡∏£‡∏∞‡∏î‡∏±‡∏ö: ‡∏á‡πà‡∏≤‡∏¢ - ‡∏¢‡∏≤‡∏Å | 5 ‡∏Ç‡πâ‡∏≠
                        </div>
                        <div class="bg-yellow-400/20 rounded-lg px-3 py-2 text-xs">
                            <div class="font-semibold">üèÜ ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</div>
                            <div id="game1BestDisplay">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="game1MainBest">0</span> | ‡πÄ‡∏ß‡∏•‡∏≤: <span id="game1MainTime">-</span></div>
                        </div>
                    </div>
                </div>

                <!-- Game 2 -->
                <div class="game-card rounded-2xl p-6 text-white cursor-pointer" onclick="startGame(2)">
                    <div class="text-center">
                        <div class="text-6xl mb-4">üëÆ‚Äç‚ôÇÔ∏è</div>
                        <h3 class="text-xl font-bold mb-2">‡πÉ‡∏Ñ‡∏£‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏£‡πâ‡∏≤‡∏¢‡πÑ‡∏ã‡πÄ‡∏ö‡∏≠‡∏£‡πå</h3>
                        <p class="text-sm opacity-90 mb-3">‡πÅ‡∏¢‡∏Å‡πÅ‡∏¢‡∏∞‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</p>
                        <div class="bg-white/10 rounded-lg p-2 mb-3 text-xs">
                            <p>‚Ä¢ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ï‡πà‡∏≤‡∏á‡πÜ</p>
                            <p>‚Ä¢ ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</p>
                            <p>‚Ä¢ ‡πÄ‡∏ß‡∏•‡∏≤: 25 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ/‡∏Ç‡πâ‡∏≠</p>
                        </div>
                        <div class="bg-white/20 rounded-full px-3 py-1 text-xs mb-2">
                            ‡∏£‡∏∞‡∏î‡∏±‡∏ö: ‡∏á‡πà‡∏≤‡∏¢ - ‡∏¢‡∏≤‡∏Å | 5 ‡∏Ç‡πâ‡∏≠
                        </div>
                        <div class="bg-yellow-400/20 rounded-lg px-3 py-2 text-xs">
                            <div class="font-semibold">üèÜ ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</div>
                            <div id="game2BestDisplay">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="game2MainBest">0</span> | ‡πÄ‡∏ß‡∏•‡∏≤: <span id="game2MainTime">-</span></div>
                        </div>
                    </div>
                </div>

                <!-- Game 3 -->
                <div class="game-card rounded-2xl p-6 text-white cursor-pointer" onclick="startGame(3)">
                    <div class="text-center">
                        <div class="text-6xl mb-4">üîç</div>
                        <h3 class="text-xl font-bold mb-2">‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h3>
                        <p class="text-sm opacity-90 mb-3">‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</p>
                        <div class="bg-white/10 rounded-lg p-2 mb-3 text-xs">
                            <p>‚Ä¢ ‡∏•‡∏≤‡∏Å‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
                            <p>‚Ä¢ ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</p>
                            <p>‚Ä¢ ‡πÄ‡∏ß‡∏•‡∏≤: 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ/‡∏î‡πà‡∏≤‡∏ô</p>
                        </div>
                        <div class="bg-white/20 rounded-full px-3 py-1 text-xs mb-2">
                            ‡∏£‡∏∞‡∏î‡∏±‡∏ö: ‡∏á‡πà‡∏≤‡∏¢ - ‡∏¢‡∏≤‡∏Å | 3 ‡∏î‡πà‡∏≤‡∏ô
                        </div>
                        <div class="bg-yellow-400/20 rounded-lg px-3 py-2 text-xs">
                            <div class="font-semibold">üèÜ ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</div>
                            <div id="game3BestDisplay">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="game3MainBest">0</span> | ‡πÄ‡∏ß‡∏•‡∏≤: <span id="game3MainTime">-</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game 1: Website Detection -->
        <div id="game1" class="hidden">
            <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-white flex items-center">
                        üåê ‡πÄ‡∏Å‡∏°‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡∏î‡∏µ-‡πÄ‡∏ß‡πá‡∏ö‡∏õ‡∏•‡∏≠‡∏°
                    </h2>
                    <button onclick="backToMenu()" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-colors">
                        ‚Üê ‡∏Å‡∏•‡∏±‡∏ö
                    </button>
                </div>
                <div class="text-white/90 mb-6">
                    <p>‡∏î‡∏π‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô "‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏î‡∏µ" ‡∏´‡∏£‡∏∑‡∏≠ "‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏õ‡∏•‡∏≠‡∏°"</p>
                    <div class="mt-2 flex items-center justify-between">
                        <div>
                            <span class="bg-green-500/20 text-green-200 px-3 py-1 rounded-full text-sm mr-2">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="game1Score">0</span></span>
                            <span class="bg-blue-500/20 text-blue-200 px-3 py-1 rounded-full text-sm">‡∏Ç‡πâ‡∏≠: <span id="game1Question">1</span>/5</span>
                        </div>
                        <div class="timer-circle bg-white/20" id="game1Timer">
                            <span class="text-white font-bold text-lg" id="game1TimeLeft">30</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl p-6 mb-6">
                <div id="websiteDisplay" class="border-2 border-gray-200 rounded-lg p-4 mb-6">
                    <!-- Website content will be inserted here -->
                </div>
                
                <div class="flex justify-center space-x-4">
                    <button onclick="selectAnswer(true)" class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-lg font-semibold transition-colors">
                        ‚úÖ ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏î‡∏µ
                    </button>
                    <button onclick="selectAnswer(false)" class="bg-red-500 hover:bg-red-600 text-white px-8 py-3 rounded-lg font-semibold transition-colors">
                        ‚ùå ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏õ‡∏•‡∏≠‡∏°
                    </button>
                </div>
            </div>

            <div id="game1Feedback" class="hidden bg-white rounded-2xl p-6">
                <div id="feedbackContent"></div>
                <button onclick="nextQuestion()" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors">
                    ‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí
                </button>
            </div>
        </div>

        <!-- Game 2: Cyber Villain Detective -->
        <div id="game2" class="hidden">
            <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-white flex items-center">
                        üëÆ‚Äç‚ôÇÔ∏è ‡πÄ‡∏Å‡∏° "‡πÉ‡∏Ñ‡∏£‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏£‡πâ‡∏≤‡∏¢‡πÑ‡∏ã‡πÄ‡∏ö‡∏≠‡∏£‡πå"
                    </h2>
                    <div class="flex items-center space-x-2">
                        <button id="game2SpeechToggle" class="speak-button bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                            <span class="speak-icon">üîä</span> ‡∏≠‡πà‡∏≤‡∏ô
                        </button>
                        <button onclick="backToMenu()" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-colors">
                            ‚Üê ‡∏Å‡∏•‡∏±‡∏ö
                        </button>
                    </div>
                </div>
                <div class="text-white/90 mb-6">
                    <p>‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏±‡πâ‡∏ô "‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢" ‡∏´‡∏£‡∏∑‡∏≠ "‡πÑ‡∏°‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢"</p>
                    <div class="mt-2 flex items-center justify-between">
                        <div>
                            <span class="bg-green-500/20 text-green-200 px-3 py-1 rounded-full text-sm mr-2">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="game2Score">0</span></span>
                            <span class="bg-blue-500/20 text-blue-200 px-3 py-1 rounded-full text-sm">‡∏Ç‡πâ‡∏≠: <span id="game2Question">1</span>/5</span>
                        </div>
                        <div class="timer-circle bg-white/20" id="game2Timer">
                            <span class="text-white font-bold text-lg" id="game2TimeLeft">25</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl p-6 mb-6">
                <div id="scenarioDisplay" class="text-center mb-6">
                    <!-- Scenario content will be inserted here -->
                </div>
                
                <div class="flex justify-center space-x-4 mb-4">
                    <button onclick="selectBehavior(true)" class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-lg font-semibold transition-colors">
                        ‚úÖ ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
                    </button>
                    <button onclick="selectBehavior(false)" class="bg-red-500 hover:bg-red-600 text-white px-8 py-3 rounded-lg font-semibold transition-colors">
                        ‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
                    </button>
                </div>
                
                <div class="text-center">
                    <button id="game2ScenarioSpeech" class="speak-button bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                        <span class="speak-icon">üîä</span> ‡∏≠‡πà‡∏≤‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå
                    </button>
                </div>
            </div>

            <div id="game2Feedback" class="hidden bg-white rounded-2xl p-6">
                <div id="behaviorFeedbackContent"></div>
                <button onclick="nextScenario()" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors">
                    ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí
                </button>
            </div>
        </div>

        <!-- Game 3: Search Steps Puzzle -->
        <div id="game3" class="hidden">
            <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-white flex items-center">
                        üîç ‡πÄ‡∏Å‡∏° Puzzle ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                    </h2>
                    <div class="flex items-center space-x-2">
                        <button id="game3SpeechToggle" class="speak-button bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                            <span class="speak-icon">üîä</span> ‡∏≠‡πà‡∏≤‡∏ô
                        </button>
                        <button onclick="backToMenu()" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-colors">
                            ‚Üê ‡∏Å‡∏•‡∏±‡∏ö
                        </button>
                    </div>
                </div>
                <div class="text-white/90 mb-6">
                    <p id="puzzleTask">‡∏•‡∏≤‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÑ‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
                    <div class="mt-2 flex items-center justify-between">
                        <div>
                            <span class="bg-green-500/20 text-green-200 px-3 py-1 rounded-full text-sm mr-2">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="game3Score">0</span></span>
                            <span class="bg-blue-500/20 text-blue-200 px-3 py-1 rounded-full text-sm">‡∏î‡πà‡∏≤‡∏ô: <span id="game3Level">1</span>/3</span>
                        </div>
                        <div class="timer-circle bg-white/20" id="game3Timer">
                            <span class="text-white font-bold text-lg" id="game3TimeLeft">60</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white rounded-2xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏á</h3>
                        <button id="game3StepsSpeech" class="speak-button bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs transition-colors">
                            <span class="speak-icon">üîä</span> ‡∏≠‡πà‡∏≤‡∏ô
                        </button>
                    </div>
                    <div id="stepsList" class="space-y-3">
                        <!-- Steps will be inserted here -->
                    </div>
                </div>

                <div class="bg-white rounded-2xl p-6">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800">‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</h3>
                    <div id="dropZones" class="space-y-3">
                        <!-- Drop zones will be inserted here -->
                    </div>
                    <div class="mt-4 space-y-2">
                        <button onclick="checkPuzzleAnswer()" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg transition-colors">
                            ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
                        </button>
                        <button onclick="resetPuzzle()" class="w-full bg-gray-500 hover:bg-gray-600 text-white py-2 rounded-lg transition-colors text-sm">
                            üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
                        </button>
                        <div class="text-center mt-2">
                            <button id="game3TaskSpeech" class="speak-button bg-purple-500 hover:bg-purple-600 text-white px-3 py-1 rounded text-xs transition-colors">
                                <span class="speak-icon">üîä</span> ‡∏≠‡πà‡∏≤‡∏ô‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="game3Feedback" class="hidden mt-6 bg-white rounded-2xl p-6">
                <div id="puzzleFeedbackContent"></div>
                <button onclick="nextPuzzle()" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors">
                    ‡∏î‡πà‡∏≤‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí
                </button>
            </div>
        </div>

        <!-- Stats Page -->
        <div id="statsPage" class="hidden">
            <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-white flex items-center">
                        üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô
                    </h2>
                    <button onclick="backToMenu()" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-colors">
                        ‚Üê ‡∏Å‡∏•‡∏±‡∏ö
                    </button>
                </div>
            </div>

            <div class="grid md:grid-cols-3 gap-6">
                <!-- Game 1 Stats -->
                <div class="stats-card rounded-2xl p-6 text-white">
                    <div class="text-center">
                        <div class="text-4xl mb-3">üåê</div>
                        <h3 class="text-lg font-bold mb-3">‡πÄ‡∏Å‡∏°‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡∏î‡∏µ-‡πÄ‡∏ß‡πá‡∏ö‡∏õ‡∏•‡∏≠‡∏°</h3>
                        <div class="space-y-2 text-sm">
                            <div class="bg-white/20 rounded-lg p-2">
                                <span class="block">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</span>
                                <span class="text-xl font-bold" id="game1BestScore">0</span>
                            </div>
                            <div class="bg-white/20 rounded-lg p-2">
                                <span class="block">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</span>
                                <span class="font-semibold" id="game1BestTime">-</span>
                            </div>
                            <div class="bg-white/20 rounded-lg p-2">
                                <span class="block">‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß</span>
                                <span class="font-semibold" id="game1PlayCount">0 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Game 2 Stats -->
                <div class="stats-card rounded-2xl p-6 text-white">
                    <div class="text-center">
                        <div class="text-4xl mb-3">üëÆ‚Äç‚ôÇÔ∏è</div>
                        <h3 class="text-lg font-bold mb-3">‡πÉ‡∏Ñ‡∏£‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏£‡πâ‡∏≤‡∏¢‡πÑ‡∏ã‡πÄ‡∏ö‡∏≠‡∏£‡πå</h3>
                        <div class="space-y-2 text-sm">
                            <div class="bg-white/20 rounded-lg p-2">
                                <span class="block">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</span>
                                <span class="text-xl font-bold" id="game2BestScore">0</span>
                            </div>
                            <div class="bg-white/20 rounded-lg p-2">
                                <span class="block">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</span>
                                <span class="font-semibold" id="game2BestTime">-</span>
                            </div>
                            <div class="bg-white/20 rounded-lg p-2">
                                <span class="block">‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß</span>
                                <span class="font-semibold" id="game2PlayCount">0 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Game 3 Stats -->
                <div class="stats-card rounded-2xl p-6 text-white">
                    <div class="text-center">
                        <div class="text-4xl mb-3">üîç</div>
                        <h3 class="text-lg font-bold mb-3">‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h3>
                        <div class="space-y-2 text-sm">
                            <div class="bg-white/20 rounded-lg p-2">
                                <span class="block">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</span>
                                <span class="text-xl font-bold" id="game3BestScore">0</span>
                            </div>
                            <div class="bg-white/20 rounded-lg p-2">
                                <span class="block">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</span>
                                <span class="font-semibold" id="game3BestTime">-</span>
                            </div>
                            <div class="bg-white/20 rounded-lg p-2">
                                <span class="block">‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß</span>
                                <span class="font-semibold" id="game3PlayCount">0 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-6 bg-white/10 backdrop-blur-sm rounded-2xl p-6">
                <h3 class="text-xl font-bold text-white mb-4 text-center">üèÜ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="bg-white/20 rounded-lg p-4 text-white text-center">
                        <div class="text-2xl mb-2">üéØ</div>
                        <div class="font-semibold">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        <div class="text-2xl font-bold" id="totalAllTimeScore">0</div>
                    </div>
                    <div class="bg-white/20 rounded-lg p-4 text-white text-center">
                        <div class="text-2xl mb-2">üèÖ</div>
                        <div class="font-semibold">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</div>
                        <div class="text-lg font-bold" id="totalBadges">0 ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-black/20 backdrop-blur-sm border-t border-white/20 mt-12">
        <div class="container mx-auto px-4 py-6">
            <div class="text-center text-white/80 text-sm">
                <p>¬© developed by Tle Narongphisit | CTTC19 @ CPD</p>
            </div>
        </div>
    </footer>

    <script>
        let gameState = {
            totalScore: 0,
            game1: { 
                score: 0, 
                question: 1, 
                timer: null, 
                timeLeft: 30, 
                startTime: null, 
                initialDuration: 30,
                bestScore: 0, 
                bestTime: null, 
                playCount: 0,
                isActive: false
            },
            game2: { 
                score: 0, 
                question: 1, 
                timer: null, 
                timeLeft: 25, 
                startTime: null, 
                initialDuration: 25,
                bestScore: 0, 
                bestTime: null, 
                playCount: 0,
                isActive: false
            },
            game3: { 
                score: 0, 
                level: 1, 
                timer: null, 
                timeLeft: 60, 
                startTime: null, 
                initialDuration: 60,
                bestScore: 0, 
                bestTime: null, 
                playCount: 0,
                isActive: false
            },
            badges: [],
            stats: {
                totalAllTimeScore: 0,
                totalBadges: 0
            }
        };

        // Sound system using Web Audio API
        let audioContext;
        
        function initAudioContext() {
            if (!audioContext) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('Audio context not supported');
                    return false;
                }
            }
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume();
            }
            return true;
        }

        // Text-to-Speech system
        let speechSynthesis = window.speechSynthesis;
        let currentUtterance = null;
        let isSpeaking = false;

        function initTTS() {
            // Check if browser supports speech synthesis
            if (!speechSynthesis) {
                console.log('Text-to-speech not supported');
                return false;
            }
            return true;
        }

        function speakText(text, options = {}) {
            if (!initTTS()) return;
            
            // Stop any current speech
            stopSpeech();
            
            currentUtterance = new SpeechSynthesisUtterance(text);
            
            // Set voice properties
            currentUtterance.lang = 'th-TH'; // Thai language
            currentUtterance.rate = options.rate || 0.9; // Slightly slower for children
            currentUtterance.pitch = options.pitch || 1.1; // Slightly higher pitch for friendliness
            currentUtterance.volume = options.volume || 0.8;
            
            // Try to find a Thai voice, fallback to default
            const voices = speechSynthesis.getVoices();
            const thaiVoice = voices.find(voice => voice.lang.includes('th')) || 
                             voices.find(voice => voice.lang.includes('TH'));
            
            if (thaiVoice) {
                currentUtterance.voice = thaiVoice;
            }
            
            currentUtterance.onstart = () => {
                isSpeaking = true;
                updateSpeechButtons();
            };
            
            currentUtterance.onend = () => {
                isSpeaking = false;
                currentUtterance = null;
                updateSpeechButtons();
            };
            
            currentUtterance.onerror = () => {
                isSpeaking = false;
                currentUtterance = null;
                updateSpeechButtons();
            };
            
            speechSynthesis.speak(currentUtterance);
        }

        function stopSpeech() {
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }
            isSpeaking = false;
            currentUtterance = null;
            updateSpeechButtons();
        }

        function toggleSpeech(text) {
            if (isSpeaking) {
                stopSpeech();
            } else {
                speakText(text);
            }
        }

        function updateSpeechButtons() {
            const speakButtons = document.querySelectorAll('.speak-button');
            speakButtons.forEach(button => {
                const icon = button.querySelector('.speak-icon');
                if (icon) {
                    icon.textContent = isSpeaking ? 'üîá' : 'üîä';
                }
                button.title = isSpeaking ? '‡∏´‡∏¢‡∏∏‡∏î‡∏≠‡πà‡∏≤‡∏ô' : '‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°';
            });
        }


        
        function playSound(frequency, duration, type = 'sine') {
            if (!initAudioContext()) return;
            
            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
            
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            } catch (error) {
                console.log('Audio playback failed');
            }
        }

        function playCorrectSound() {
            playSound(523, 0.2); // C5
            setTimeout(() => playSound(659, 0.2), 100); // E5
            setTimeout(() => playSound(784, 0.3), 200); // G5
        }

        function playIncorrectSound() {
            playSound(220, 0.3, 'sawtooth'); // A3
            setTimeout(() => playSound(196, 0.4, 'sawtooth'), 150); // G3
        }

        function playClickSound() {
            playSound(800, 0.1, 'square');
        }

        function playTimerWarningSound() {
            playSound(440, 0.1, 'triangle');
        }

        function playCompleteSound() {
            const notes = [523, 659, 784, 1047]; // C5, E5, G5, C6
            notes.forEach((note, index) => {
                setTimeout(() => playSound(note, 0.3), index * 150);
            });
        }

        // Visual effects
        function createConfetti() {
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.backgroundColor = ['#fbbf24', '#f59e0b', '#d97706', '#92400e'][Math.floor(Math.random() * 4)];
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 50);
            }
        }

        function showFloatingText(text, element, color = '#22c55e') {
            const floatingText = document.createElement('div');
            floatingText.className = 'floating-text';
            floatingText.textContent = text;
            floatingText.style.color = color;
            
            const rect = element.getBoundingClientRect();
            floatingText.style.left = rect.left + rect.width / 2 - 50 + 'px';
            floatingText.style.top = rect.top - 20 + 'px';
            
            document.body.appendChild(floatingText);
            setTimeout(() => floatingText.remove(), 2000);
        }

        function addButtonClickEffect(button) {
            button.classList.add('button-click');
            setTimeout(() => button.classList.remove('button-click'), 200);
        }

        // Timer functions
        function startTimer(gameNumber, duration) {
            const game = gameState[`game${gameNumber}`];
            game.timeLeft = duration;
            game.startTime = Date.now();
            game.initialDuration = duration;
            
            const timerElement = document.getElementById(`game${gameNumber}TimeLeft`);
            const timerCircle = document.getElementById(`game${gameNumber}Timer`);
            
            // Clear any existing timer
            if (game.timer) {
                clearInterval(game.timer);
            }
            
            game.timer = setInterval(() => {
                game.timeLeft--;
                timerElement.textContent = game.timeLeft;
                
                // Update timer circle color
                const percentage = (game.timeLeft / duration) * 100;
                const color = percentage > 50 ? '#22c55e' : percentage > 25 ? '#fbbf24' : '#ef4444';
                timerCircle.style.background = `conic-gradient(${color} ${percentage * 3.6}deg, #e5e7eb ${percentage * 3.6}deg)`;
                
                // Warning effects
                if (game.timeLeft <= 10) {
                    timerCircle.classList.add('warning');
                    if (game.timeLeft <= 5) {
                        playTimerWarningSound();
                    }
                }
                
                // Time up
                if (game.timeLeft <= 0) {
                    clearInterval(game.timer);
                    game.timer = null;
                    handleTimeUp(gameNumber);
                }
            }, 1000);
        }

        function stopTimer(gameNumber) {
            const game = gameState[`game${gameNumber}`];
            if (game.timer) {
                clearInterval(game.timer);
                game.timer = null;
            }
        }

        function getElapsedTime(gameNumber) {
            const game = gameState[`game${gameNumber}`];
            if (game.startTime) {
                return Math.floor((Date.now() - game.startTime) / 1000);
            }
            return 0;
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function handleTimeUp(gameNumber) {
            playIncorrectSound();
            showFloatingText('‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤!', document.getElementById(`game${gameNumber}Timer`), '#ef4444');
            
            if (gameNumber === 1) {
                selectAnswer(false, true); // Auto-select wrong answer
            } else if (gameNumber === 2) {
                selectBehavior(false, true); // Auto-select wrong answer
            } else if (gameNumber === 3) {
                checkPuzzleAnswer(true); // Auto-check with time up flag
            }
        }

        // Game data
        const websiteQuestions = [
            {
                url: "https://www.kids-learning.com",
                content: "üéì ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏î‡πá‡∏Å<br>üìö ‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏ü‡∏£‡∏µ<br>üë®‚Äçüè´ ‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç<br>üìû ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠: 02-123-4567",
                isGood: true,
                explanation: "‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏î‡∏µ‡πÄ‡∏û‡∏£‡∏≤‡∏∞: ‡∏°‡∏µ https://, ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡πá‡∏ö‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô, ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠, ‡πÅ‡∏•‡∏∞‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡πÄ‡∏î‡πá‡∏Å"
            },
            {
                url: "http://get-free-prize.xyz",
                content: "üéÅ ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ü‡∏£‡∏µ!!!<br>üí∞ ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏¢!!! ‡∏£‡∏ß‡∏¢‡πÉ‡∏ô 1 ‡∏ß‡∏±‡∏ô<br>‚ö° ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏ß‡∏•‡∏≤!!! ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 5 ‡∏ô‡∏≤‡∏ó‡∏µ<br>üî• ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏¢!",
                isGood: false,
                explanation: "‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏õ‡∏•‡∏≠‡∏°‡πÄ‡∏û‡∏£‡∏≤‡∏∞: ‡πÑ‡∏°‡πà‡∏°‡∏µ https://, ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏õ‡∏•‡∏Å, ‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤‡∏â‡∏π‡∏î‡∏â‡∏≤‡∏î, ‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß"
            },
            {
                url: "https://www.googlee.com",
                content: "üîç Googlee Search<br>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£<br>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥<br>‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏£‡∏µ",
                isGood: false,
                explanation: "‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏õ‡∏•‡∏≠‡∏°‡πÄ‡∏û‡∏£‡∏≤‡∏∞: ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏•‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö Google (googlee ‡πÅ‡∏ó‡∏ô google) ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏´‡∏•‡∏≠‡∏Å‡∏•‡∏ß‡∏á"
            },
            {
                url: "https://www.school.ac.th",
                content: "üè´ ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏ö‡πâ‡∏≤‡∏ô‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ<br>üìã ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£<br>üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô<br>üìß ‡∏≠‡∏µ‡πÄ‡∏°‡∏•: info@school.ac.th",
                isGood: true,
                explanation: "‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏î‡∏µ‡πÄ‡∏û‡∏£‡∏≤‡∏∞: ‡∏°‡∏µ https://, ‡πÉ‡∏ä‡πâ‡πÇ‡∏î‡πÄ‡∏°‡∏ô .ac.th ‡∏Ç‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ö‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤, ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô"
            },
            {
                url: "http://faceb00k.net",
                content: "üë• Faceb00k<br>‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÜ<br>‡πÅ‡∏ä‡∏£‡πå‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠<br>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏•‡∏¢!",
                isGood: false,
                explanation: "‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏õ‡∏•‡∏≠‡∏°‡πÄ‡∏û‡∏£‡∏≤‡∏∞: ‡πÑ‡∏°‡πà‡∏°‡∏µ https://, ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏•‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö Facebook (‡πÉ‡∏ä‡πâ 00 ‡πÅ‡∏ó‡∏ô oo), ‡πÅ‡∏•‡∏∞‡πÇ‡∏î‡πÄ‡∏°‡∏ô .net ‡πÅ‡∏ó‡∏ô .com"
            }
        ];

        const behaviorScenarios = [
            {
                character: "‡∏ô‡πâ‡∏≠‡∏á‡∏≠‡∏≠‡∏°",
                situation: "‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Ñ‡∏ô‡πÅ‡∏õ‡∏•‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô",
                emoji: "üéÆ",
                isSafe: false,
                explanation: "‡πÑ‡∏°‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢! ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡πÅ‡∏õ‡∏•‡∏Å‡∏´‡∏ô‡πâ‡∏≤ ‡∏Ñ‡∏ß‡∏£‡∏ö‡∏≠‡∏Å‡∏û‡πà‡∏≠‡πÅ‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏£‡∏π‡∏ó‡∏±‡∏ô‡∏ó‡∏µ"
            },
            {
                character: "‡∏ô‡πâ‡∏≠‡∏á‡∏°‡∏¥‡πâ‡∏ô",
                situation: "‡πÄ‡∏à‡∏≠‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡πà‡∏≤‡∏™‡∏á‡∏™‡∏±‡∏¢‡πÉ‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏• ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏£‡∏π‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏•‡∏¥‡∏Å",
                emoji: "üìß",
                isSafe: true,
                explanation: "‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢! ‡∏Å‡∏≤‡∏£‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏£‡∏π‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏•‡∏¥‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"
            },
            {
                character: "‡∏ô‡πâ‡∏≠‡∏á‡πÇ‡∏ö",
                situation: "‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏£‡∏π‡∏õ‡∏ö‡πâ‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏ô‡πÇ‡∏ã‡πÄ‡∏ä‡∏µ‡∏¢‡∏•‡∏°‡∏µ‡πÄ‡∏î‡∏µ‡∏¢",
                emoji: "üì±",
                isSafe: false,
                explanation: "‡πÑ‡∏°‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢! ‡∏Å‡∏≤‡∏£‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏ä‡πà‡∏ô ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡πÑ‡∏°‡πà‡∏î‡∏µ‡∏°‡∏≤‡∏ó‡∏≥‡∏£‡πâ‡∏≤‡∏¢‡πÑ‡∏î‡πâ"
            },
            {
                character: "‡∏ô‡πâ‡∏≠‡∏á‡πÅ‡∏õ‡πâ‡∏á",
                situation: "‡πÉ‡∏ä‡πâ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏ö‡∏≠‡∏Å‡πÉ‡∏Ñ‡∏£‡πÄ‡∏•‡∏¢",
                emoji: "üîê",
                isSafe: true,
                explanation: "‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢! ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏ú‡∏™‡∏°‡∏Å‡∏±‡∏ô"
            },
            {
                character: "‡∏ô‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏á",
                situation: "‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà‡∏°‡∏≤‡πÉ‡∏´‡πâ ‡πÅ‡∏ï‡πà‡∏î‡∏π‡πÅ‡∏õ‡∏•‡∏Å‡πÜ ‡πÄ‡∏•‡∏¢‡πÑ‡∏°‡πà‡∏Å‡∏î‡∏Ñ‡∏•‡∏¥‡∏Å",
                emoji: "üéØ",
                isSafe: true,
                explanation: "‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢! ‡πÅ‡∏°‡πâ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡∏π‡πÅ‡∏õ‡∏•‡∏Å‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ß‡∏£‡∏±‡∏™‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢"
            }
        ];

        const searchPuzzles = [
            {
                task: "‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á '‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÉ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô' ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢",
                steps: [
                    "‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå",
                    "‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô Google",
                    "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠",
                    "‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏à‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•",
                    "‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≤"
                ]
            },
            {
                task: "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô",
                steps: [
                    "‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå",
                    "‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏û‡∏à‡∏ô‡∏≤‡∏ô‡∏∏‡∏Å‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏î‡πâ",
                    "‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏≤",
                    "‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á",
                    "‡∏à‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏•‡∏á‡∏™‡∏°‡∏∏‡∏î"
                ]
            },
            {
                task: "‡∏´‡∏≤‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢",
                steps: [
                    "‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏û‡πà‡∏≠‡πÅ‡∏°‡πà‡∏Å‡πà‡∏≠‡∏ô",
                    "‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢",
                    "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°",
                    "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏≠‡∏≤‡∏¢‡∏∏",
                    "‡∏î‡∏π‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà"
                ]
            }
        ];

        function startGame(gameNumber) {
            playClickSound();
            document.getElementById('gameSelection').classList.add('hidden');
            document.getElementById('statsPage').classList.add('hidden');
            document.getElementById(`game${gameNumber}`).classList.remove('hidden');
            
            if (gameNumber === 1) {
                initGame1();
            } else if (gameNumber === 2) {
                initGame2();
            } else if (gameNumber === 3) {
                initGame3();
            }
        }

        function backToMenu() {
            playClickSound();
            // Stop any running timers
            [1, 2, 3].forEach(num => stopTimer(num));
            
            // Stop any speech
            stopSpeech();
            
            document.querySelectorAll('[id^="game"]').forEach(game => game.classList.add('hidden'));
            document.getElementById('statsPage').classList.add('hidden');
            document.getElementById('gameSelection').classList.remove('hidden');
        }

        function showStats() {
            playClickSound();
            document.getElementById('gameSelection').classList.add('hidden');
            document.querySelectorAll('[id^="game"]').forEach(game => game.classList.add('hidden'));
            document.getElementById('statsPage').classList.remove('hidden');
            updateStatsDisplay();
        }

        function initGame1() {
            // Reset game state
            gameState.game1.score = 0;
            gameState.game1.question = 1;
            gameState.game1.isActive = true;
            gameState.game1.playCount++;
            
            // Reset UI
            document.getElementById('game1Feedback').classList.add('hidden');
            const timerCircle = document.getElementById('game1Timer');
            timerCircle.classList.remove('warning');
            
            // Re-enable buttons
            const buttons = document.querySelectorAll('#game1 button[onclick*="selectAnswer"]');
            buttons.forEach(btn => btn.disabled = false);
            
            // Update display immediately
            updateGame1Display();
            showWebsite();
            startTimer(1, 30);
        }

        function showWebsite() {
            const question = websiteQuestions[gameState.game1.question - 1];
            const display = document.getElementById('websiteDisplay');
            
            display.innerHTML = `
                <div class="bg-gray-100 p-3 rounded-lg mb-4">
                    <div class="flex items-center space-x-2 mb-2">
                        <div class="w-3 h-3 bg-red-400 rounded-full"></div>
                        <div class="w-3 h-3 bg-yellow-400 rounded-full"></div>
                        <div class="w-3 h-3 bg-green-400 rounded-full"></div>
                        <div class="bg-white rounded px-3 py-1 text-sm font-mono">${question.url}</div>
                    </div>
                </div>
                <div class="text-center py-8">
                    ${question.content}
                </div>
            `;
            
            document.getElementById('game1Feedback').classList.add('hidden');
            
            // Reset timer circle
            const timerCircle = document.getElementById('game1Timer');
            timerCircle.classList.remove('warning');
            timerCircle.style.background = 'conic-gradient(#22c55e 360deg, #e5e7eb 360deg)';
        }

        function selectAnswer(isGood, timeUp = false) {
            // Prevent multiple selections
            if (!gameState.game1.isActive && !timeUp) return;
            
            if (!timeUp) {
                playClickSound();
                stopTimer(1);
                gameState.game1.isActive = false;
                
                // Disable buttons
                const buttons = document.querySelectorAll('#game1 button[onclick*="selectAnswer"]');
                buttons.forEach(btn => btn.disabled = true);
            }
            
            const question = websiteQuestions[gameState.game1.question - 1];
            const isCorrect = isGood === question.isGood;
            
            // Add button click effect
            const buttons = document.querySelectorAll('#game1 button');
            buttons.forEach(btn => {
                if ((isGood && btn.textContent.includes('‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏î‡∏µ')) || 
                    (!isGood && btn.textContent.includes('‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏õ‡∏•‡∏≠‡∏°'))) {
                    addButtonClickEffect(btn);
                }
            });
            
            let points = 0;
            if (isCorrect && !timeUp) {
                // Base points + time bonus
                const basePoints = 10;
                const timeBonus = Math.max(0, Math.floor(gameState.game1.timeLeft / 3)); // 1 point per 3 seconds left
                points = basePoints + timeBonus;
                
                gameState.game1.score += points;
                gameState.totalScore += points;
                playCorrectSound();
                showFloatingText(`+${points}`, document.getElementById('game1Score'), '#22c55e');
            } else {
                playIncorrectSound();
                if (!timeUp) {
                    showFloatingText('0', document.getElementById('game1Score'), '#ef4444');
                }
            }
            
            showGame1Feedback(isCorrect, question.explanation, timeUp, points);
            // Force update display after scoring
            setTimeout(() => {
                updateGame1Display();
                updateTotalScore();
                updateMainPageStats();
            }, 100);
        }

        function showGame1Feedback(isCorrect, explanation, timeUp = false, points = 0) {
            const feedback = document.getElementById('game1Feedback');
            const content = document.getElementById('feedbackContent');
            
            let message = isCorrect ? '‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!' : '‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏∞!';
            if (timeUp) message = '‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤!';
            
            let pointsBreakdown = '';
            if (isCorrect && !timeUp && points > 10) {
                const basePoints = 10;
                const timeBonus = points - basePoints;
                pointsBreakdown = `
                    <div class="bg-green-50 border border-green-200 rounded-lg p-3 mt-3">
                        <div class="text-sm text-green-800">
                            <div class="font-semibold mb-1">üéØ ‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:</div>
                            <div>‚Ä¢ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${basePoints} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                            <div>‚Ä¢ ‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡πÄ‡∏ß‡∏•‡∏≤: ${timeBonus} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                            <div class="font-bold border-t border-green-300 pt-1 mt-1">‡∏£‡∏ß‡∏°: ${points} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                        </div>
                    </div>
                `;
            }
            
            content.innerHTML = `
                <div class="text-center mb-4 score-popup">
                    <div class="text-6xl mb-2">${isCorrect ? 'üéâ' : timeUp ? '‚è∞' : 'üòÖ'}</div>
                    <h3 class="text-xl font-bold ${isCorrect ? 'text-green-600' : 'text-red-600'} mb-2">
                        ${message}
                    </h3>
                    <p class="text-gray-700">${explanation}</p>
                    ${pointsBreakdown}
                </div>
            `;
            
            feedback.classList.remove('hidden');
        }

        function nextQuestion() {
            playClickSound();
            
            // Re-enable buttons for next question
            const buttons = document.querySelectorAll('#game1 button[onclick*="selectAnswer"]');
            buttons.forEach(btn => btn.disabled = false);
            
            if (gameState.game1.question < websiteQuestions.length) {
                gameState.game1.question++;
                gameState.game1.isActive = true;
                // Force immediate display update
                updateGame1Display();
                showWebsite();
                startTimer(1, 30);
            } else {
                showGame1Complete();
            }
        }

        function showGame1Complete() {
            stopTimer(1);
            const totalTime = getElapsedTime(1);
            
            // Calculate final score with completion bonus
            const completionBonus = 20;
            const roundScore = gameState.game1.score; // Score from this round only
            const finalRoundScore = roundScore + completionBonus;
            
            // Add to total score
            gameState.totalScore += completionBonus;
            gameState.stats.totalAllTimeScore += finalRoundScore;
            
            // Update best score and time
            const isNewBest = finalRoundScore > gameState.game1.bestScore;
            if (isNewBest) {
                gameState.game1.bestScore = finalRoundScore;
                gameState.game1.bestTime = totalTime;
            }
            updateMainPageBestScores();
            
            const feedback = document.getElementById('game1Feedback');
            const content = document.getElementById('feedbackContent');
            
            let badge = '';
            if (finalRoundScore >= 60) {
                badge = 'üõ°Ô∏è ‡πÇ‡∏•‡πà‡∏´‡πå‡πÅ‡∏´‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢';
                addBadge('üõ°Ô∏è');
            }
            
            playCompleteSound();
            if (finalRoundScore >= 60) {
                createConfetti();
            }
            
            content.innerHTML = `
                <div class="text-center score-popup">
                    <div class="text-6xl mb-4">üèÜ</div>
                    <h3 class="text-2xl font-bold text-green-600 mb-2">‡πÄ‡∏Å‡∏°‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß!</h3>
                    <div class="bg-blue-50 rounded-lg p-4 mb-4">
                        <div class="text-sm text-gray-600 mb-2">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ:</div>
                        <div class="text-left text-sm mb-2">
                            <div>‚Ä¢ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö: ${roundScore} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                            <div>‚Ä¢ ‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏à‡∏ö‡πÄ‡∏Å‡∏°: ${completionBonus} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                        </div>
                        <div class="border-t border-blue-200 pt-2">
                            <p class="text-lg font-bold text-blue-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ: ${finalRoundScore} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                            <p class="text-sm text-gray-600">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: ${formatTime(totalTime)}</p>
                        </div>
                        ${isNewBest ? 
                            '<div class="bg-yellow-50 border border-yellow-200 rounded p-2 mt-2"><span class="text-yellow-800 text-xs font-semibold">üåü ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÉ‡∏´‡∏°‡πà!</span></div>' : ''}
                    </div>
                    ${badge ? `<div class="bg-yellow-100 border border-yellow-400 rounded-lg p-3 mb-4">
                        <p class="text-yellow-800 font-semibold">üéâ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•: ${badge}</p>
                    </div>` : ''}
                    <div class="flex space-x-3 justify-center">
                        <button onclick="initGame1()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg transition-colors">
                            üîÑ ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                        </button>
                        <button onclick="backToMenu()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors">
                            ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å
                        </button>
                    </div>
                </div>
            `;
            
            feedback.classList.remove('hidden');
            updateGame1Display();
            updateTotalScore();
            
            // Auto return to menu after 5 seconds
            setTimeout(() => {
                backToMenu();
            }, 5000);
        }

        function updateGame1Display() {
            const scoreElement = document.getElementById('game1Score');
            const questionElement = document.getElementById('game1Question');
            
            if (scoreElement) scoreElement.textContent = gameState.game1.score;
            if (questionElement) questionElement.textContent = gameState.game1.question;
        }

        function initGame2() {
            // Reset game state
            gameState.game2.score = 0;
            gameState.game2.question = 1;
            gameState.game2.isActive = true;
            gameState.game2.playCount++;
            
            // Reset UI
            document.getElementById('game2Feedback').classList.add('hidden');
            const timerCircle = document.getElementById('game2Timer');
            timerCircle.classList.remove('warning');
            
            // Re-enable buttons
            const buttons = document.querySelectorAll('#game2 button[onclick*="selectBehavior"]');
            buttons.forEach(btn => btn.disabled = false);
            
            // Update display immediately
            updateGame2Display();
            showScenario();
            startTimer(2, 25);
        }

        function showScenario() {
            const scenario = behaviorScenarios[gameState.game2.question - 1];
            const display = document.getElementById('scenarioDisplay');
            
            display.innerHTML = `
                <div class="text-8xl mb-4">${scenario.emoji}</div>
                <h3 class="text-xl font-bold mb-4 text-gray-800">‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå:</h3>
                <div class="bg-blue-50 rounded-lg p-4 mb-4">
                    <p class="text-lg text-gray-700">
                        <strong>${scenario.character}</strong> ${scenario.situation}
                    </p>
                </div>
                <p class="text-gray-600">‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
            `;
            
            // Setup TTS for scenario
            const scenarioText = `‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå: ${scenario.character} ${scenario.situation}. ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`;
            
            // Update speech buttons
            const game2SpeechToggle = document.getElementById('game2SpeechToggle');
            const game2ScenarioSpeech = document.getElementById('game2ScenarioSpeech');
            
            game2SpeechToggle.onclick = (e) => {
                e.preventDefault();
                playClickSound();
                toggleSpeech(scenarioText);
            };
            
            game2ScenarioSpeech.onclick = (e) => {
                e.preventDefault();
                playClickSound();
                toggleSpeech(scenarioText);
            };
            
            document.getElementById('game2Feedback').classList.add('hidden');
            
            // Auto-read scenario after a short delay (optional)
            setTimeout(() => {
                if (gameState.game2.isActive) {
                    speakText(scenarioText);
                }
            }, 1000);
        }

        function selectBehavior(isSafe, timeUp = false) {
            // Prevent multiple selections
            if (!gameState.game2.isActive && !timeUp) return;
            
            if (!timeUp) {
                playClickSound();
                stopTimer(2);
                gameState.game2.isActive = false;
                
                // Disable buttons
                const buttons = document.querySelectorAll('#game2 button[onclick*="selectBehavior"]');
                buttons.forEach(btn => btn.disabled = true);
            }
            
            const scenario = behaviorScenarios[gameState.game2.question - 1];
            const isCorrect = isSafe === scenario.isSafe;
            
            // Add button click effect
            const buttons = document.querySelectorAll('#game2 button');
            buttons.forEach(btn => {
                if ((isSafe && btn.textContent.includes('‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢')) || 
                    (!isSafe && btn.textContent.includes('‡πÑ‡∏°‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢'))) {
                    addButtonClickEffect(btn);
                }
            });
            
            let points = 0;
            if (isCorrect && !timeUp) {
                // Base points + time bonus
                const basePoints = 10;
                const timeBonus = Math.max(0, Math.floor(gameState.game2.timeLeft / 2.5)); // 1 point per 2.5 seconds left
                points = basePoints + timeBonus;
                
                gameState.game2.score += points;
                gameState.totalScore += points;
                playCorrectSound();
                showFloatingText(`+${points}`, document.getElementById('game2Score'), '#22c55e');
            } else {
                playIncorrectSound();
                if (!timeUp) {
                    showFloatingText('0', document.getElementById('game2Score'), '#ef4444');
                }
            }
            
            showGame2Feedback(isCorrect, scenario.explanation, timeUp, points);
            // Force update display after scoring
            setTimeout(() => {
                updateGame2Display();
                updateTotalScore();
                updateMainPageStats();
            }, 100);
        }

        function showGame2Feedback(isCorrect, explanation, timeUp = false, points = 0) {
            const feedback = document.getElementById('game2Feedback');
            const content = document.getElementById('behaviorFeedbackContent');
            
            let message = isCorrect ? '‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!' : '‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏∞!';
            if (timeUp) message = '‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤!';
            
            let pointsBreakdown = '';
            if (isCorrect && !timeUp && points > 10) {
                const basePoints = 10;
                const timeBonus = points - basePoints;
                pointsBreakdown = `
                    <div class="bg-green-50 border border-green-200 rounded-lg p-3 mt-3">
                        <div class="text-sm text-green-800">
                            <div class="font-semibold mb-1">üéØ ‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:</div>
                            <div>‚Ä¢ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${basePoints} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                            <div>‚Ä¢ ‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡πÄ‡∏ß‡∏•‡∏≤: ${timeBonus} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                            <div class="font-bold border-t border-green-300 pt-1 mt-1">‡∏£‡∏ß‡∏°: ${points} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                        </div>
                    </div>
                `;
            }
            
            content.innerHTML = `
                <div class="text-center mb-4 score-popup">
                    <div class="text-6xl mb-2">${isCorrect ? 'üéâ' : timeUp ? '‚è∞' : 'üòÖ'}</div>
                    <h3 class="text-xl font-bold ${isCorrect ? 'text-green-600' : 'text-red-600'} mb-2">
                        ${message}
                    </h3>
                    <p class="text-gray-700">${explanation}</p>
                    ${pointsBreakdown}
                </div>
            `;
            
            feedback.classList.remove('hidden');
        }

        function nextScenario() {
            playClickSound();
            
            // Re-enable buttons for next scenario
            const buttons = document.querySelectorAll('#game2 button[onclick*="selectBehavior"]');
            buttons.forEach(btn => btn.disabled = false);
            
            if (gameState.game2.question < behaviorScenarios.length) {
                gameState.game2.question++;
                gameState.game2.isActive = true;
                // Force immediate display update
                updateGame2Display();
                showScenario();
                startTimer(2, 25);
            } else {
                showGame2Complete();
            }
        }

        function showGame2Complete() {
            stopTimer(2);
            const totalTime = getElapsedTime(2);
            
            // Calculate final score with completion bonus
            const completionBonus = 20;
            const roundScore = gameState.game2.score; // Score from this round only
            const finalRoundScore = roundScore + completionBonus;
            
            // Add to total score
            gameState.totalScore += completionBonus;
            gameState.stats.totalAllTimeScore += finalRoundScore;
            
            // Update best score and time
            const isNewBest = finalRoundScore > gameState.game2.bestScore;
            if (isNewBest) {
                gameState.game2.bestScore = finalRoundScore;
                gameState.game2.bestTime = totalTime;
            }
            updateMainPageBestScores();
            
            const feedback = document.getElementById('game2Feedback');
            const content = document.getElementById('behaviorFeedbackContent');
            
            let badge = '';
            if (finalRoundScore >= 70) {
                badge = '‚öîÔ∏è ‡∏î‡∏≤‡∏ö‡πÅ‡∏´‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢';
                addBadge('‚öîÔ∏è');
            }
            
            playCompleteSound();
            if (finalRoundScore >= 70) {
                createConfetti();
            }
            
            content.innerHTML = `
                <div class="text-center score-popup">
                    <div class="text-6xl mb-4">üèÜ</div>
                    <h3 class="text-2xl font-bold text-green-600 mb-2">‡πÄ‡∏Å‡∏°‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß!</h3>
                    <div class="bg-blue-50 rounded-lg p-4 mb-4">
                        <div class="text-sm text-gray-600 mb-2">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ:</div>
                        <div class="text-left text-sm mb-2">
                            <div>‚Ä¢ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö: ${roundScore} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                            <div>‚Ä¢ ‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏à‡∏ö‡πÄ‡∏Å‡∏°: ${completionBonus} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                        </div>
                        <div class="border-t border-blue-200 pt-2">
                            <p class="text-lg font-bold text-blue-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ: ${finalRoundScore} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                            <p class="text-sm text-gray-600">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: ${formatTime(totalTime)}</p>
                        </div>
                        ${isNewBest ? 
                            '<div class="bg-yellow-50 border border-yellow-200 rounded p-2 mt-2"><span class="text-yellow-800 text-xs font-semibold">üåü ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÉ‡∏´‡∏°‡πà!</span></div>' : ''}
                    </div>
                    ${badge ? `<div class="bg-yellow-100 border border-yellow-400 rounded-lg p-3 mb-4">
                        <p class="text-yellow-800 font-semibold">üéâ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•: ${badge}</p>
                    </div>` : ''}
                    <div class="flex space-x-3 justify-center">
                        <button onclick="initGame2()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg transition-colors">
                            üîÑ ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                        </button>
                        <button onclick="backToMenu()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors">
                            ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å
                        </button>
                    </div>
                </div>
            `;
            
            feedback.classList.remove('hidden');
            updateGame2Display();
            updateTotalScore();
            
            // Auto return to menu after 5 seconds
            setTimeout(() => {
                backToMenu();
            }, 5000);
        }

        function updateGame2Display() {
            const scoreElement = document.getElementById('game2Score');
            const questionElement = document.getElementById('game2Question');
            
            if (scoreElement) scoreElement.textContent = gameState.game2.score;
            if (questionElement) questionElement.textContent = gameState.game2.question;
        }

        function initGame3() {
            // Reset game state
            gameState.game3.score = 0;
            gameState.game3.level = 1;
            gameState.game3.isActive = true;
            gameState.game3.playCount++;
            
            // Reset UI
            document.getElementById('game3Feedback').classList.add('hidden');
            const timerCircle = document.getElementById('game3Timer');
            timerCircle.classList.remove('warning');
            
            // Re-enable check button
            const checkButton = document.querySelector('button[onclick="checkPuzzleAnswer()"]');
            if (checkButton) checkButton.disabled = false;
            
            // Update display immediately
            updateGame3Display();
            showPuzzle();
            startTimer(3, 60);
        }

        function showPuzzle() {
            const puzzle = searchPuzzles[gameState.game3.level - 1];
            document.getElementById('puzzleTask').textContent = `‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à: ${puzzle.task}`;
            
            const stepsList = document.getElementById('stepsList');
            const dropZones = document.getElementById('dropZones');
            
            // Shuffle steps
            const shuffledSteps = [...puzzle.steps].sort(() => Math.random() - 0.5);
            
            stepsList.innerHTML = '';
            shuffledSteps.forEach((step, index) => {
                const stepDiv = document.createElement('div');
                stepDiv.className = 'draggable bg-blue-100 border border-blue-300 rounded-lg p-3 text-center cursor-grab';
                stepDiv.draggable = true;
                stepDiv.textContent = step;
                stepDiv.dataset.step = step;
                
                stepDiv.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', step);
                    stepDiv.style.opacity = '0.5';
                });
                
                stepDiv.addEventListener('dragend', () => {
                    stepDiv.style.opacity = '1';
                });
                
                stepsList.appendChild(stepDiv);
            });
            
            // Create drop zones
            dropZones.innerHTML = '';
            puzzle.steps.forEach((_, index) => {
                const dropZone = document.createElement('div');
                dropZone.className = 'drop-zone bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-3 text-center text-gray-500';
                dropZone.textContent = `‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà ${index + 1}`;
                dropZone.dataset.position = index;
                
                dropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropZone.classList.add('drag-over');
                });
                
                dropZone.addEventListener('dragleave', () => {
                    dropZone.classList.remove('drag-over');
                });
                
                dropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const step = e.dataTransfer.getData('text/plain');
                    
                    // If zone already has content, return it to steps list
                    if (dropZone.dataset.step) {
                        const returnStep = dropZone.dataset.step;
                        const stepDiv = document.createElement('div');
                        stepDiv.className = 'draggable bg-blue-100 border border-blue-300 rounded-lg p-3 text-center cursor-grab';
                        stepDiv.draggable = true;
                        stepDiv.textContent = returnStep;
                        stepDiv.dataset.step = returnStep;
                        
                        // Add drag events
                        stepDiv.addEventListener('dragstart', (e) => {
                            e.dataTransfer.setData('text/plain', returnStep);
                            stepDiv.style.opacity = '0.5';
                        });
                        stepDiv.addEventListener('dragend', () => {
                            stepDiv.style.opacity = '1';
                        });
                        
                        document.getElementById('stepsList').appendChild(stepDiv);
                    }
                    
                    dropZone.textContent = step;
                    dropZone.dataset.step = step;
                    dropZone.classList.remove('drag-over', 'bg-gray-50', 'border-gray-300');
                    dropZone.classList.add('bg-green-50', 'border-green-300');
                    
                    // Remove the dragged item from steps list
                    const draggedItem = document.querySelector(`#stepsList [data-step="${step}"]`);
                    if (draggedItem) {
                        draggedItem.remove();
                    }
                });
                
                dropZones.appendChild(dropZone);
            });
            
            // Setup TTS for puzzle
            const taskText = `‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à: ${puzzle.task}`;
            const stepsText = `‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏á: ${shuffledSteps.join(', ')}`;
            
            // Update speech buttons
            const game3SpeechToggle = document.getElementById('game3SpeechToggle');
            const game3TaskSpeech = document.getElementById('game3TaskSpeech');
            const game3StepsSpeech = document.getElementById('game3StepsSpeech');
            
            game3SpeechToggle.onclick = (e) => {
                e.preventDefault();
                playClickSound();
                toggleSpeech(`${taskText}. ${stepsText}`);
            };
            
            game3TaskSpeech.onclick = (e) => {
                e.preventDefault();
                playClickSound();
                toggleSpeech(taskText);
            };
            
            game3StepsSpeech.onclick = (e) => {
                e.preventDefault();
                playClickSound();
                toggleSpeech(stepsText);
            };
            
            document.getElementById('game3Feedback').classList.add('hidden');
            
            // Auto-read task after a short delay (optional)
            setTimeout(() => {
                if (gameState.game3.isActive) {
                    speakText(taskText);
                }
            }, 1000);
        }

        function checkPuzzleAnswer(timeUp = false) {
            // Prevent multiple submissions
            if (!gameState.game3.isActive && !timeUp) return;
            
            if (!timeUp) {
                playClickSound();
                stopTimer(3);
                gameState.game3.isActive = false;
            }
            
            const puzzle = searchPuzzles[gameState.game3.level - 1];
            const dropZones = document.querySelectorAll('#dropZones .drop-zone');
            let isCorrect = true;
            
            dropZones.forEach((zone, index) => {
                const userStep = zone.dataset.step;
                const correctStep = puzzle.steps[index];
                
                if (userStep !== correctStep) {
                    isCorrect = false;
                    zone.classList.add('bg-red-50', 'border-red-300');
                } else {
                    zone.classList.add('bg-green-50', 'border-green-300');
                }
            });
            
            let points = 0;
            if (isCorrect && !timeUp) {
                // Base points + time bonus
                const basePoints = 15;
                const timeBonus = Math.max(0, Math.floor(gameState.game3.timeLeft / 6)); // 1 point per 6 seconds left
                points = basePoints + timeBonus;
                
                gameState.game3.score += points;
                gameState.totalScore += points;
                playCorrectSound();
                showFloatingText(`+${points}`, document.getElementById('game3Score'), '#22c55e');
            } else {
                playIncorrectSound();
                if (!timeUp) {
                    showFloatingText('0', document.getElementById('game3Score'), '#ef4444');
                }
            }
            
            showGame3Feedback(isCorrect, timeUp, points);
            // Force update display after scoring
            setTimeout(() => {
                updateGame3Display();
                updateTotalScore();
                updateMainPageStats();
            }, 100);
        }

        function showGame3Feedback(isCorrect, timeUp = false, points = 0) {
            const feedback = document.getElementById('game3Feedback');
            const content = document.getElementById('puzzleFeedbackContent');
            
            let message = isCorrect ? '‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!' : '‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏∞!';
            if (timeUp) message = '‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤!';
            
            let pointsBreakdown = '';
            if (isCorrect && !timeUp && points > 15) {
                const basePoints = 15;
                const timeBonus = points - basePoints;
                pointsBreakdown = `
                    <div class="bg-green-50 border border-green-200 rounded-lg p-3 mt-3">
                        <div class="text-sm text-green-800">
                            <div class="font-semibold mb-1">üéØ ‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:</div>
                            <div>‚Ä¢ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${basePoints} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                            <div>‚Ä¢ ‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡πÄ‡∏ß‡∏•‡∏≤: ${timeBonus} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                            <div class="font-bold border-t border-green-300 pt-1 mt-1">‡∏£‡∏ß‡∏°: ${points} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                        </div>
                    </div>
                `;
            }
            
            content.innerHTML = `
                <div class="text-center mb-4 score-popup">
                    <div class="text-6xl mb-2">${isCorrect ? 'üéâ' : timeUp ? '‚è∞' : 'üòÖ'}</div>
                    <h3 class="text-xl font-bold ${isCorrect ? 'text-green-600' : 'text-red-600'} mb-2">
                        ${message}
                    </h3>
                    <p class="text-gray-700">
                        ${isCorrect ? '‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å! ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡πâ‡∏ß' : '‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£ ‡∏•‡∏≠‡∏á‡∏î‡∏π‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà'}
                    </p>
                    ${pointsBreakdown}
                </div>
            `;
            
            feedback.classList.remove('hidden');
        }

        function nextPuzzle() {
            playClickSound();
            
            if (gameState.game3.level < searchPuzzles.length) {
                gameState.game3.level++;
                gameState.game3.isActive = true;
                
                // Re-enable check button for next level
                const checkButton = document.querySelector('button[onclick="checkPuzzleAnswer()"]');
                if (checkButton) checkButton.disabled = false;
                
                // Force immediate display update
                updateGame3Display();
                showPuzzle();
                startTimer(3, 60);
            } else {
                showGame3Complete();
            }
        }

        function showGame3Complete() {
            stopTimer(3);
            const totalTime = getElapsedTime(3);
            
            // Calculate final score with completion bonus
            const completionBonus = 25;
            const roundScore = gameState.game3.score; // Score from this round only
            const finalRoundScore = roundScore + completionBonus;
            
            // Add to total score
            gameState.totalScore += completionBonus;
            gameState.stats.totalAllTimeScore += finalRoundScore;
            
            // Update best score and time
            const isNewBest = finalRoundScore > gameState.game3.bestScore;
            if (isNewBest) {
                gameState.game3.bestScore = finalRoundScore;
                gameState.game3.bestTime = totalTime;
            }
            updateMainPageBestScores();
            
            const feedback = document.getElementById('game3Feedback');
            const content = document.getElementById('puzzleFeedbackContent');
            
            let badge = '';
            if (finalRoundScore >= 70) {
                badge = 'üìö ‡∏Ñ‡∏±‡∏°‡∏†‡∏µ‡∏£‡πå‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                addBadge('üìö');
            }
            
            playCompleteSound();
            if (finalRoundScore >= 70) {
                createConfetti();
            }
            
            content.innerHTML = `
                <div class="text-center score-popup">
                    <div class="text-6xl mb-4">üèÜ</div>
                    <h3 class="text-2xl font-bold text-green-600 mb-2">‡πÄ‡∏Å‡∏°‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß!</h3>
                    <div class="bg-blue-50 rounded-lg p-4 mb-4">
                        <div class="text-sm text-gray-600 mb-2">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ:</div>
                        <div class="text-left text-sm mb-2">
                            <div>‚Ä¢ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á: ${roundScore} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                            <div>‚Ä¢ ‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏à‡∏ö‡πÄ‡∏Å‡∏°: ${completionBonus} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                        </div>
                        <div class="border-t border-blue-200 pt-2">
                            <p class="text-lg font-bold text-blue-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ: ${finalRoundScore} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                            <p class="text-sm text-gray-600">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: ${formatTime(totalTime)}</p>
                        </div>
                        ${isNewBest ? 
                            '<div class="bg-yellow-50 border border-yellow-200 rounded p-2 mt-2"><span class="text-yellow-800 text-xs font-semibold">üåü ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÉ‡∏´‡∏°‡πà!</span></div>' : ''}
                    </div>
                    ${badge ? `<div class="bg-yellow-100 border border-yellow-400 rounded-lg p-3 mb-4">
                        <p class="text-yellow-800 font-semibold">üéâ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•: ${badge}</p>
                    </div>` : ''}
                    <div class="flex space-x-3 justify-center">
                        <button onclick="initGame3()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg transition-colors">
                            üîÑ ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                        </button>
                        <button onclick="backToMenu()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors">
                            ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å
                        </button>
                    </div>
                </div>
            `;
            
            feedback.classList.remove('hidden');
            updateGame3Display();
            updateTotalScore();
            
            // Auto return to menu after 5 seconds
            setTimeout(() => {
                backToMenu();
            }, 5000);
        }

        function resetPuzzle() {
            playClickSound();
            if (!gameState.game3.isActive) return;
            
            showPuzzle(); // This will reset the puzzle to initial state
        }

        function updateGame3Display() {
            const scoreElement = document.getElementById('game3Score');
            const levelElement = document.getElementById('game3Level');
            
            if (scoreElement) scoreElement.textContent = gameState.game3.score;
            if (levelElement) levelElement.textContent = gameState.game3.level;
        }

        function updateTotalScore() {
            document.getElementById('totalScore').textContent = gameState.totalScore;
            
            // Check for special badges
            if (gameState.totalScore >= 200 && !gameState.badges.includes('üß†')) {
                addBadge('üß†');
            }
            
            // Save data when score updates
            saveGameData();
        }

        function updateMainPageBestScores() {
            // Update Game 1
            document.getElementById('game1MainBest').textContent = gameState.game1.bestScore;
            document.getElementById('game1MainTime').textContent = gameState.game1.bestTime ? formatTime(gameState.game1.bestTime) : '-';
            
            // Update Game 2
            document.getElementById('game2MainBest').textContent = gameState.game2.bestScore;
            document.getElementById('game2MainTime').textContent = gameState.game2.bestTime ? formatTime(gameState.game2.bestTime) : '-';
            
            // Update Game 3
            document.getElementById('game3MainBest').textContent = gameState.game3.bestScore;
            document.getElementById('game3MainTime').textContent = gameState.game3.bestTime ? formatTime(gameState.game3.bestTime) : '-';
            
            // Update main page high score summary
            updateMainPageStats();
        }

        function updateMainPageStats() {
            // Update individual game high scores in the summary section
            document.getElementById('mainHighScore1').textContent = gameState.game1.bestScore;
            document.getElementById('mainHighTime1').textContent = gameState.game1.bestTime ? formatTime(gameState.game1.bestTime) : '-';
            document.getElementById('mainPlayCount1').textContent = gameState.game1.playCount;
            
            document.getElementById('mainHighScore2').textContent = gameState.game2.bestScore;
            document.getElementById('mainHighTime2').textContent = gameState.game2.bestTime ? formatTime(gameState.game2.bestTime) : '-';
            document.getElementById('mainPlayCount2').textContent = gameState.game2.playCount;
            
            document.getElementById('mainHighScore3').textContent = gameState.game3.bestScore;
            document.getElementById('mainHighTime3').textContent = gameState.game3.bestTime ? formatTime(gameState.game3.bestTime) : '-';
            document.getElementById('mainPlayCount3').textContent = gameState.game3.playCount;
            
            // Update overall stats
            const totalAllTimeScore = gameState.stats.totalAllTimeScore + gameState.totalScore;
            document.getElementById('mainTotalScore').textContent = totalAllTimeScore;
            document.getElementById('mainTotalBadges').textContent = gameState.badges.length;
        }

        function addBadge(badge) {
            if (!gameState.badges.includes(badge)) {
                gameState.badges.push(badge);
                gameState.stats.totalBadges = gameState.badges.length;
                
                const badgesContainer = document.getElementById('badges');
                const badgeElement = document.createElement('div');
                badgeElement.className = 'badge bg-yellow-400 text-yellow-900 px-3 py-1 rounded-full text-sm font-semibold';
                badgeElement.textContent = badge;
                badgesContainer.appendChild(badgeElement);
                
                // Play special sound for badge
                setTimeout(() => playCompleteSound(), 500);
                saveGameData();
            }
        }

        function updateStatsDisplay() {
            // Game 1 stats
            document.getElementById('game1BestScore').textContent = gameState.game1.bestScore;
            document.getElementById('game1BestTime').textContent = gameState.game1.bestTime ? formatTime(gameState.game1.bestTime) : '-';
            document.getElementById('game1PlayCount').textContent = gameState.game1.playCount + ' ‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
            
            // Game 2 stats
            document.getElementById('game2BestScore').textContent = gameState.game2.bestScore;
            document.getElementById('game2BestTime').textContent = gameState.game2.bestTime ? formatTime(gameState.game2.bestTime) : '-';
            document.getElementById('game2PlayCount').textContent = gameState.game2.playCount + ' ‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
            
            // Game 3 stats
            document.getElementById('game3BestScore').textContent = gameState.game3.bestScore;
            document.getElementById('game3BestTime').textContent = gameState.game3.bestTime ? formatTime(gameState.game3.bestTime) : '-';
            document.getElementById('game3PlayCount').textContent = gameState.game3.playCount + ' ‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
            
            // Overall stats
            document.getElementById('totalAllTimeScore').textContent = gameState.stats.totalAllTimeScore;
            document.getElementById('totalBadges').textContent = gameState.badges.length + ' ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•';
        }

        // Data persistence
        function saveGameData() {
            try {
                localStorage.setItem('cyberLearningGameState', JSON.stringify(gameState));
            } catch (e) {
                console.log('Could not save game data');
            }
        }

        function loadGameData() {
            try {
                const saved = localStorage.getItem('cyberLearningGameState');
                if (saved) {
                    const savedState = JSON.parse(saved);
                    // Merge saved data with current state, preserving structure
                    gameState.game1.bestScore = savedState.game1?.bestScore || 0;
                    gameState.game1.bestTime = savedState.game1?.bestTime || null;
                    gameState.game1.playCount = savedState.game1?.playCount || 0;
                    
                    gameState.game2.bestScore = savedState.game2?.bestScore || 0;
                    gameState.game2.bestTime = savedState.game2?.bestTime || null;
                    gameState.game2.playCount = savedState.game2?.playCount || 0;
                    
                    gameState.game3.bestScore = savedState.game3?.bestScore || 0;
                    gameState.game3.bestTime = savedState.game3?.bestTime || null;
                    gameState.game3.playCount = savedState.game3?.playCount || 0;
                    
                    gameState.stats.totalAllTimeScore = savedState.stats?.totalAllTimeScore || 0;
                    gameState.badges = savedState.badges || [];
                    
                    // Restore badges display
                    gameState.badges.forEach(badge => {
                        const badgesContainer = document.getElementById('badges');
                        const badgeElement = document.createElement('div');
                        badgeElement.className = 'badge bg-yellow-400 text-yellow-900 px-3 py-1 rounded-full text-sm font-semibold';
                        badgeElement.textContent = badge;
                        badgesContainer.appendChild(badgeElement);
                    });
                }
            } catch (e) {
                console.log('Could not load game data');
            }
        }

        // Initialize the game
        updateTotalScore();
        loadGameData();
        updateMainPageBestScores();
        updateMainPageStats();
        
        // Initialize all game displays
        updateGame1Display();
        updateGame2Display();
        updateGame3Display();
        
        // Initialize TTS
        initTTS();
        
        // Load voices when available
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = () => {
                // Voices loaded, TTS ready
                console.log('TTS voices loaded');
            };
        }
        
        // Save data periodically and on page unload
        setInterval(saveGameData, 30000); // Save every 30 seconds
        window.addEventListener('beforeunload', saveGameData);
        window.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'hidden') {
                saveGameData();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9768a006370b731c',t:'MTc1NjQzNDYxMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
