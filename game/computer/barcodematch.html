<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>‡πÄ‡∏Å‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@zxing/library@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Kanit', sans-serif; }
        .scanner-container { position: relative; width: 100%; max-width: 400px; height: 300px; }
        #video { width: 100%; height: 100%; object-fit: cover; border-radius: 12px; }
        .scanner-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 200px; height: 200px; border: 2px solid #10b981; border-radius: 12px; }
        .scanner-corner { position: absolute; width: 20px; height: 20px; border: 3px solid #10b981; }
        .scanner-corner.top-left { top: -2px; left: -2px; border-right: none; border-bottom: none; }
        .scanner-corner.top-right { top: -2px; right: -2px; border-left: none; border-bottom: none; }
        .scanner-corner.bottom-left { bottom: -2px; left: -2px; border-right: none; border-top: none; }
        .scanner-corner.bottom-right { bottom: -2px; right: -2px; border-left: none; border-top: none; }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .bounce-in { animation: bounceIn 0.6s ease-out; }
        @keyframes bounceIn { 0% { transform: scale(0.3); opacity: 0; } 50% { transform: scale(1.05); } 70% { transform: scale(0.9); } 100% { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-indigo-600">üñ•Ô∏è ‡πÄ‡∏Å‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="showScreen('game')" class="px-4 py-2 text-indigo-600 hover:text-indigo-800 font-medium">‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°</button>
                    <button onclick="showScreen('leaderboard')" class="px-4 py-2 text-indigo-600 hover:text-indigo-800 font-medium">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
                    <button onclick="showScreen('admin')" class="px-4 py-2 text-indigo-600 hover:text-indigo-800 font-medium">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Game Screen -->
    <div id="gameScreen" class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <!-- Game Status -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center space-x-4">
                        <div class="text-lg font-semibold">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà: <span id="currentQuestion" class="text-indigo-600">1</span>/<span id="totalQuestions" class="text-indigo-600">10</span></div>
                        <div class="text-lg font-semibold">‡πÄ‡∏ß‡∏•‡∏≤: <span id="timer" class="text-red-500">00:00</span></div>
                    </div>
                    <div class="flex space-x-2">
                        <button id="testCameraBtn" onclick="testCamera()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
                        <button id="startGameBtn" onclick="startGame()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg font-medium">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
                        <button id="resetGameBtn" onclick="resetGame()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg font-medium" style="display: none;">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
                    </div>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div id="progressBar" class="bg-indigo-600 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>

            <!-- Game Content -->
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Question Panel -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">üí° ‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ</h2>
                    <div id="questionCard" class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 text-center">
                        <p id="questionText" class="text-lg text-gray-700 leading-relaxed">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</p>
                    </div>
                    <div id="playerNameInput" class="mt-4" style="display: none;">
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô:</label>
                        <input type="text" id="playerName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" onkeypress="if(event.key==='Enter') startGame()">
                    </div>
                </div>

                <!-- Scanner Panel -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">üì± ‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î</h2>
                    <div class="scanner-container mx-auto mb-4">
                        <video id="video" style="display: none;"></video>
                        <div id="scannerPlaceholder" class="w-full h-full bg-gray-100 rounded-lg flex items-center justify-center">
                            <div class="text-center">
                                <div class="text-4xl mb-2">üì∑</div>
                                <p class="text-gray-500">‡∏Å‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</p>
                            </div>
                        </div>
                        <div id="cameraStatus" class="w-full h-full bg-gray-100 rounded-lg flex items-center justify-center" style="display: none;">
                            <div class="text-center">
                                <div id="cameraStatusIcon" class="text-4xl mb-2">‚è≥</div>
                                <p id="cameraStatusText" class="text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á...</p>
                            </div>
                        </div>
                        <div id="scannerOverlay" class="scanner-overlay" style="display: none;">
                            <div class="scanner-corner top-left"></div>
                            <div class="scanner-corner top-right"></div>
                            <div class="scanner-corner bottom-left"></div>
                            <div class="scanner-corner bottom-right"></div>
                        </div>
                    </div>
                    <div id="scanResult" class="text-center" style="display: none;">
                        <div id="resultIcon" class="text-4xl mb-2"></div>
                        <div id="resultText" class="text-lg font-semibold"></div>
                    </div>
                    <button id="manualInputBtn" onclick="toggleManualInput()" class="w-full bg-gray-500 hover:bg-gray-600 text-white py-2 rounded-lg font-medium mt-4" style="display: none;">‡∏õ‡πâ‡∏≠‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á</button>
                    <div id="manualInput" class="mt-4" style="display: none;">
                        <input type="text" id="manualBarcode" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î" onkeypress="if(event.key==='Enter') checkManualBarcode()">
                        <button onclick="checkManualBarcode()" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white py-2 rounded-lg font-medium mt-2">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaderboard Screen -->
    <div id="leaderboardScreen" class="container mx-auto px-4 py-8" style="display: none;">
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">üèÜ ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h2>
                <div id="leaderboardList" class="space-y-4">
                    <!-- Leaderboard entries will be populated here -->
                </div>
                <button onclick="clearLeaderboard()" class="w-full bg-red-500 hover:bg-red-600 text-white py-2 rounded-lg font-medium mt-6">‡∏•‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
            </div>
        </div>
    </div>

    <!-- Admin Screen -->
    <div id="adminScreen" class="container mx-auto px-4 py-8" style="display: none;">
        <div class="max-w-6xl mx-auto">
            <!-- Admin Login -->
            <div id="adminLogin" class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</h2>
                <div class="max-w-md mx-auto">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</label>
                        <input type="text" id="adminUsername" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="admin">
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô:</label>
                        <input type="password" id="adminPassword" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <button onclick="adminLogin()" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white py-2 rounded-lg font-medium">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                </div>
            </div>

            <!-- Admin Panel -->
            <div id="adminPanel" style="display: none;">
                <!-- Game Settings -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡∏°</h3>
                    <div class="grid md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏≥‡∏Å‡∏±‡∏î (‡∏ô‡∏≤‡∏ó‡∏µ):</label>
                            <input type="number" id="gameTimeLimit" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" value="10" min="1" max="60">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏≠‡∏ö:</label>
                            <input type="number" id="questionsPerRound" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" value="10" min="1" max="15">
                        </div>
                        <div class="flex items-end">
                            <button onclick="saveGameSettings()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg font-medium">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
                        </div>
                    </div>
                </div>

                <!-- Equipment Management -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üñ•Ô∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h3>
                    
                    <!-- Add Equipment Form -->
                    <div class="bg-gray-50 rounded-lg p-4 mb-6">
                        <h4 class="font-semibold text-gray-700 mb-3">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏´‡∏°‡πà</h4>
                        <div class="grid md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå:</label>
                                <input type="text" id="equipmentName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ:</label>
                                <input type="text" id="equipmentHint" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£...">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î:</label>
                                <input type="text" id="equipmentBarcode" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î">
                            </div>
                        </div>
                        <button onclick="addEquipment()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium mt-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</button>
                    </div>

                    <!-- Equipment List -->
                    <div id="equipmentList" class="space-y-3">
                        <!-- Equipment items will be populated here -->
                    </div>
                </div>

                <button onclick="adminLogout()" class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg font-medium">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        </div>
    </div>

    <!-- Game Complete Modal -->
    <div id="gameCompleteModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" style="display: none;">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md mx-4 bounce-in">
            <div class="text-center">
                <div class="text-6xl mb-4">üéâ</div>
                <h3 class="text-2xl font-bold text-gray-800 mb-4">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢!</h3>
                <p class="text-gray-600 mb-2">‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏î‡πâ:</p>
                <p id="finalTime" class="text-3xl font-bold text-indigo-600 mb-6">00:00</p>
                <button onclick="closeGameCompleteModal()" class="bg-indigo-500 hover:bg-indigo-600 text-white px-8 py-3 rounded-lg font-medium">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-4 mt-8">
        <div class="container mx-auto px-4 text-center">
            <p class="text-sm">¬© developed by Tle Narongphisit | CTTC19 @ CPD</p>
        </div>
    </footer>

    <script>
        // Game State
        let gameState = {
            isPlaying: false,
            currentQuestionIndex: 0,
            startTime: null,
            timer: null,
            questions: [],
            timeLimit: 10 * 60, // 10 minutes in seconds
            questionsPerRound: 10
        };

        // Default equipment data
        let equipmentData = [
            { name: '‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î', hint: '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå', barcode: 'KB001' },
            { name: '‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠', hint: '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏à‡∏≠‡πÇ‡∏ó‡∏£‡∏ó‡∏±‡∏®‡∏ô‡πå ‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡πÄ‡∏´‡πá‡∏ô', barcode: 'MON001' },
            { name: '‡πÄ‡∏°‡∏≤‡∏™‡πå', hint: '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏•‡∏≤‡∏Å‡πÅ‡∏•‡∏∞‡∏Ñ‡∏•‡∏¥‡∏Å ‡∏°‡∏µ‡∏•‡∏π‡∏Å‡∏Å‡∏•‡∏¥‡πâ‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏Ñ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå', barcode: 'MS001' },
            { name: '‡∏•‡∏≥‡πÇ‡∏û‡∏á', hint: '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏û‡∏•‡∏á ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î ‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå', barcode: 'SPK001' },
            { name: '‡∏Æ‡∏≤‡∏£‡πå‡∏î‡∏î‡∏¥‡∏™‡∏Å‡πå', hint: '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ ‡πÅ‡∏•‡∏∞‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå', barcode: 'HDD001' },
            { name: '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå', hint: '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©', barcode: 'PRT001' },
            { name: '‡∏´‡∏π‡∏ü‡∏±‡∏á', hint: '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡∏™‡∏ß‡∏°‡πÉ‡∏™‡πà‡∏´‡∏π ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏£‡∏ö‡∏Å‡∏ß‡∏ô‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô', barcode: 'HP001' },
            { name: '‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô', hint: '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏û‡∏π‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå', barcode: 'MIC001' },
            { name: '‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏Ñ‡∏°', hint: '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡πÉ‡∏ä‡πâ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏Ñ‡∏≠‡∏•‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÜ', barcode: 'CAM001' },
            { name: '‡πÅ‡∏ü‡∏•‡∏ä‡πÑ‡∏î‡∏£‡∏ü‡πå', hint: '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡πÄ‡∏™‡∏µ‡∏¢‡∏ö‡∏û‡∏≠‡∏£‡πå‡∏ï USB ‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏¢‡πâ‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå', barcode: 'USB001' },
            { name: '‡πÅ‡∏õ‡πâ‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç', hint: '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÅ‡∏ï‡πà‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ ‡∏ä‡πà‡∏ß‡∏¢‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÑ‡∏î‡πâ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô', barcode: 'NUM001' },
            { name: '‡∏à‡∏≠‡∏¢‡∏™‡∏ï‡∏¥‡πä‡∏Å', hint: '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏° ‡∏°‡∏µ‡∏Å‡πâ‡∏≤‡∏ô‡πÇ‡∏¢‡∏Å‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î ‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡πÉ‡∏ô‡πÄ‡∏Å‡∏°', barcode: 'JOY001' },
            { name: '‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå', hint: '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡∏†‡∏≤‡∏û‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå', barcode: 'SCN001' },
            { name: '‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏•‡πá‡∏ï‡∏ß‡∏≤‡∏î‡∏£‡∏π‡∏õ', hint: '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ß‡∏≤‡∏î‡∏£‡∏π‡∏õ‡∏ö‡∏ô‡πÅ‡∏ú‡πà‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö ‡πÅ‡∏•‡πâ‡∏ß‡∏†‡∏≤‡∏û‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå', barcode: 'TAB001' },
            { name: '‡∏ã‡∏µ‡∏î‡∏µ‡∏£‡∏≠‡∏°', hint: '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ú‡πà‡∏ô‡∏Å‡∏•‡∏°‡πÜ ‡πÄ‡∏á‡∏≤‡πÜ ‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏° ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏•‡∏á‡πÑ‡∏ß‡πâ', barcode: 'CD001' }
        ];

        // Scanner
        let codeReader = null;
        let isScanning = false;
        let cameraPermissionGranted = false;
        let cameraTestStream = null;

        // Sound effects
        function playSound(type) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            if (type === 'success') {
                // Success sound - ascending notes
                const frequencies = [523.25, 659.25, 783.99]; // C5, E5, G5
                frequencies.forEach((freq, index) => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(freq, audioContext.currentTime + index * 0.1);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime + index * 0.1);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + index * 0.1 + 0.3);
                    
                    oscillator.start(audioContext.currentTime + index * 0.1);
                    oscillator.stop(audioContext.currentTime + index * 0.1 + 0.3);
                });
            } else if (type === 'error') {
                // Error sound - descending buzz
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.5);
                oscillator.type = 'sawtooth';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.5);
            } else if (type === 'complete') {
                // Game complete sound - victory fanfare
                const notes = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
                notes.forEach((freq, index) => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(freq, audioContext.currentTime + index * 0.15);
                    gainNode.gain.setValueAtTime(0.4, audioContext.currentTime + index * 0.15);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + index * 0.15 + 0.4);
                    
                    oscillator.start(audioContext.currentTime + index * 0.15);
                    oscillator.stop(audioContext.currentTime + index * 0.15 + 0.4);
                });
            } else if (type === 'start') {
                // Start game sound - upward sweep
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(220, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(440, audioContext.currentTime + 0.3);
                
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.3);
            }
        }

        // Load data from localStorage
        function loadData() {
            const savedEquipment = localStorage.getItem('equipmentData');
            if (savedEquipment) {
                equipmentData = JSON.parse(savedEquipment);
            }
            
            const savedTimeLimit = localStorage.getItem('gameTimeLimit');
            if (savedTimeLimit) {
                gameState.timeLimit = parseInt(savedTimeLimit) * 60;
                document.getElementById('gameTimeLimit').value = parseInt(savedTimeLimit);
            }
            
            const savedQuestionsPerRound = localStorage.getItem('questionsPerRound');
            if (savedQuestionsPerRound) {
                gameState.questionsPerRound = parseInt(savedQuestionsPerRound);
                document.getElementById('questionsPerRound').value = parseInt(savedQuestionsPerRound);
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('equipmentData', JSON.stringify(equipmentData));
        }

        // Screen management
        function showScreen(screenName) {
            const screens = ['gameScreen', 'leaderboardScreen', 'adminScreen'];
            screens.forEach(screen => {
                document.getElementById(screen).style.display = 'none';
            });
            document.getElementById(screenName + 'Screen').style.display = 'block';
            
            if (screenName === 'leaderboard') {
                loadLeaderboard();
            } else if (screenName === 'admin') {
                loadEquipmentList();
            }
        }

        // Camera test function
        async function testCamera() {
            const testBtn = document.getElementById('testCameraBtn');
            const statusDiv = document.getElementById('cameraStatus');
            const statusIcon = document.getElementById('cameraStatusIcon');
            const statusText = document.getElementById('cameraStatusText');
            const placeholderDiv = document.getElementById('scannerPlaceholder');
            
            // Show loading state
            testBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...';
            testBtn.disabled = true;
            placeholderDiv.style.display = 'none';
            statusDiv.style.display = 'flex';
            statusIcon.textContent = '‚è≥';
            statusText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏ä‡πâ‡∏Å‡∏•‡πâ‡∏≠‡∏á...';
            
            try {
                // Request camera permission
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    } 
                });
                
                cameraTestStream = stream;
                cameraPermissionGranted = true;
                
                // Show success status
                statusIcon.textContent = '‚úÖ';
                statusText.textContent = '‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô! ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ';
                statusDiv.className = 'w-full h-full bg-green-50 rounded-lg flex items-center justify-center border-2 border-green-200';
                
                // Show camera preview for 3 seconds
                const video = document.getElementById('video');
                video.srcObject = stream;
                video.style.display = 'block';
                statusDiv.style.display = 'none';
                
                setTimeout(() => {
                    // Stop test stream
                    if (cameraTestStream) {
                        cameraTestStream.getTracks().forEach(track => track.stop());
                        cameraTestStream = null;
                    }
                    
                    // Reset display
                    video.style.display = 'none';
                    video.srcObject = null;
                    statusDiv.style.display = 'flex';
                    
                    setTimeout(() => {
                        statusDiv.style.display = 'none';
                        placeholderDiv.style.display = 'flex';
                        placeholderDiv.innerHTML = `
                            <div class="text-center">
                                <div class="text-4xl mb-2">‚úÖ</div>
                                <p class="text-green-600 font-medium">‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
                                <p class="text-gray-500 text-sm mt-1">‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>
                            </div>
                        `;
                    }, 1000);
                }, 3000);
                
            } catch (error) {
                console.error('Camera access error:', error);
                cameraPermissionGranted = false;
                
                // Show error status
                statusIcon.textContent = '‚ùå';
                let errorMessage = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ';
                
                if (error.name === 'NotAllowedError') {
                    errorMessage = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á';
                } else if (error.name === 'NotFoundError') {
                    errorMessage = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå';
                } else if (error.name === 'NotSupportedError') {
                    errorMessage = '‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á';
                }
                
                statusText.textContent = errorMessage + ' - ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡πÅ‡∏ó‡∏ô';
                statusDiv.className = 'w-full h-full bg-red-50 rounded-lg flex items-center justify-center border-2 border-red-200';
                
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                    placeholderDiv.style.display = 'flex';
                    placeholderDiv.innerHTML = `
                        <div class="text-center">
                            <div class="text-4xl mb-2">‚ùå</div>
                            <p class="text-red-600 font-medium">‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
                            <p class="text-gray-500 text-sm mt-1">‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á</p>
                        </div>
                    `;
                }, 3000);
            } finally {
                // Reset button
                testBtn.textContent = '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á';
                testBtn.disabled = false;
            }
        }

        // Game functions
        async function startGame() {
            const playerName = document.getElementById('playerName').value.trim();
            if (!playerName) {
                document.getElementById('playerNameInput').style.display = 'block';
                document.getElementById('playerName').focus();
                return;
            }

            // Show loading state
            const startBtn = document.getElementById('startGameBtn');
            startBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°...';
            startBtn.disabled = true;

            // Check camera permission if not already granted
            if (!cameraPermissionGranted) {
                try {
                    startBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏•‡πâ‡∏≠‡∏á...';
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { 
                            facingMode: 'environment',
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        } 
                    });
                    
                    // Stop the test stream immediately
                    stream.getTracks().forEach(track => track.stop());
                    cameraPermissionGranted = true;
                    
                } catch (error) {
                    console.warn('Camera permission denied, will use manual input:', error);
                    cameraPermissionGranted = false;
                    
                    // Show warning but continue with game
                    if (error.name === 'NotAllowedError') {
                        alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ ‡πÄ‡∏Å‡∏°‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡πÅ‡∏ó‡∏ô\n\n‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Å‡∏•‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö');
                    }
                }
            }

            // Play start game sound
            playSound('start');

            setTimeout(() => {
                gameState.isPlaying = true;
                gameState.currentQuestionIndex = 0;
                gameState.startTime = Date.now();
                gameState.questions = [...equipmentData].sort(() => Math.random() - 0.5).slice(0, gameState.questionsPerRound);
                isProcessingAnswer = false; // Reset processing flag

                document.getElementById('startGameBtn').style.display = 'none';
                document.getElementById('testCameraBtn').style.display = 'none';
                document.getElementById('resetGameBtn').style.display = 'inline-block';
                document.getElementById('manualInputBtn').style.display = 'block';
                document.getElementById('playerNameInput').style.display = 'none';

                // Reset button state
                startBtn.textContent = '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°';
                startBtn.disabled = false;

                updateGameDisplay();
                startTimer();
                startScanner();
                showNextQuestion();
            }, 500);
        }

        function resetGame() {
            gameState.isPlaying = false;
            gameState.currentQuestionIndex = 0;
            gameState.startTime = null;
            isProcessingAnswer = false; // Reset processing flag
            
            if (gameState.timer) {
                clearInterval(gameState.timer);
                gameState.timer = null;
            }

            document.getElementById('startGameBtn').style.display = 'inline-block';
            document.getElementById('testCameraBtn').style.display = 'inline-block';
            document.getElementById('resetGameBtn').style.display = 'none';
            document.getElementById('manualInputBtn').style.display = 'none';
            document.getElementById('playerNameInput').style.display = 'none';
            document.getElementById('manualInput').style.display = 'none';
            document.getElementById('scanResult').style.display = 'none';

            document.getElementById('questionText').textContent = '‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô';
            document.getElementById('timer').textContent = '00:00';
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('currentQuestion').textContent = '1';
            document.getElementById('playerName').value = '';

            // Reset question card style
            document.getElementById('questionCard').className = 'bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 text-center';

            // Reset scanner placeholder based on camera status
            const placeholderDiv = document.getElementById('scannerPlaceholder');
            if (cameraPermissionGranted) {
                placeholderDiv.innerHTML = `
                    <div class="text-center">
                        <div class="text-4xl mb-2">‚úÖ</div>
                        <p class="text-green-600 font-medium">‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
                        <p class="text-gray-500 text-sm mt-1">‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>
                    </div>
                `;
            } else {
                placeholderDiv.innerHTML = `
                    <div class="text-center">
                        <div class="text-4xl mb-2">üì∑</div>
                        <p class="text-gray-500">‡∏Å‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</p>
                    </div>
                `;
            }

            stopScanner();
        }

        function showNextQuestion() {
            if (gameState.currentQuestionIndex >= gameState.questions.length) {
                completeGame();
                return;
            }

            const question = gameState.questions[gameState.currentQuestionIndex];
            const questionCard = document.getElementById('questionCard');
            
            // Update display immediately to show correct question number
            updateGameDisplay();
            
            // Show transition message first (only for questions after the first one)
            if (gameState.currentQuestionIndex > 0) {
                questionCard.className = 'bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 text-center bounce-in border-2 border-blue-300';
                document.getElementById('questionText').innerHTML = `
                    <div class="text-blue-600 font-bold text-xl mb-2">üìù ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</div>
                    <div class="text-blue-700">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ...</div>
                `;
                
                setTimeout(() => {
                    document.getElementById('questionText').textContent = question.hint;
                    questionCard.className = 'bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 text-center fade-in';
                    if (isScanning) {
                        showScanningStatus();
                    }
                }, 1500);
            } else {
                document.getElementById('questionText').textContent = question.hint;
                questionCard.className = 'bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 text-center fade-in';
                if (isScanning) {
                    showScanningStatus();
                }
            }
            
            // Hide previous result and manual input
            document.getElementById('manualInput').style.display = 'none';
            document.getElementById('scanResult').style.display = 'none';
        }

        function updateGameDisplay() {
            document.getElementById('currentQuestion').textContent = gameState.currentQuestionIndex + 1;
            document.getElementById('totalQuestions').textContent = gameState.questions.length;
            
            const progress = ((gameState.currentQuestionIndex) / gameState.questions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function startTimer() {
            gameState.timer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - gameState.startTime) / 1000);
                const remaining = gameState.timeLimit - elapsed;
                
                if (remaining <= 0) {
                    completeGame(true); // Time's up
                    return;
                }
                
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('timer').textContent = 
                    String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
            }, 1000);
        }

        function completeGame(timeUp = false) {
            gameState.isPlaying = false;
            isProcessingAnswer = false; // Reset processing flag
            
            if (gameState.timer) {
                clearInterval(gameState.timer);
                gameState.timer = null;
            }
            
            stopScanner();
            
            if (!timeUp) {
                // Play completion sound
                playSound('complete');
                
                const totalTime = Math.floor((Date.now() - gameState.startTime) / 1000);
                const playerName = document.getElementById('playerName').value.trim();
                
                // Save to leaderboard
                saveScore(playerName, totalTime);
                
                // Show completion modal
                const minutes = Math.floor(totalTime / 60);
                const seconds = totalTime % 60;
                document.getElementById('finalTime').textContent = 
                    String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
                document.getElementById('gameCompleteModal').style.display = 'flex';
            } else {
                alert('‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤! ‡∏•‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
                resetGame();
            }
        }

        function closeGameCompleteModal() {
            document.getElementById('gameCompleteModal').style.display = 'none';
            resetGame();
        }

        // Scanner functions
        function startScanner() {
            // If camera permission not granted, show manual input immediately
            if (!cameraPermissionGranted) {
                document.getElementById('manualInputBtn').click();
                return;
            }
            
            if (!codeReader) {
                codeReader = new ZXing.BrowserMultiFormatReader();
            }
            
            document.getElementById('scannerPlaceholder').style.display = 'none';
            document.getElementById('cameraStatus').style.display = 'none';
            document.getElementById('video').style.display = 'block';
            document.getElementById('scannerOverlay').style.display = 'block';
            
            // Show scanning status
            showScanningStatus();
            
            codeReader.decodeFromVideoDevice(null, 'video', (result, err) => {
                if (result && gameState.isPlaying) {
                    checkBarcode(result.text);
                } else if (gameState.isPlaying) {
                    // Show scanning status when no barcode is detected
                    showScanningStatus();
                }
            }).catch(error => {
                console.error('Camera error:', error);
                cameraPermissionGranted = false;
                
                // Show manual input if camera fails
                document.getElementById('manualInputBtn').click();
                
                let errorMessage = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ';
                if (error.name === 'NotAllowedError') {
                    errorMessage = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á';
                }
                alert(errorMessage + ' ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á');
            });
            
            isScanning = true;
        }

        function showScanningStatus() {
            const resultDiv = document.getElementById('scanResult');
            const resultIcon = document.getElementById('resultIcon');
            const resultText = document.getElementById('resultText');
            
            resultIcon.textContent = 'üîç';
            resultText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î...';
            resultText.className = 'text-lg font-semibold text-blue-600';
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'text-center pulse';
        }

        function stopScanner() {
            if (codeReader && isScanning) {
                codeReader.reset();
                isScanning = false;
            }
            
            // Stop any test stream
            if (cameraTestStream) {
                cameraTestStream.getTracks().forEach(track => track.stop());
                cameraTestStream = null;
            }
            
            document.getElementById('scannerPlaceholder').style.display = 'flex';
            document.getElementById('cameraStatus').style.display = 'none';
            document.getElementById('video').style.display = 'none';
            document.getElementById('scannerOverlay').style.display = 'none';
        }

        function toggleManualInput() {
            const manualInput = document.getElementById('manualInput');
            manualInput.style.display = manualInput.style.display === 'none' ? 'block' : 'none';
        }

        function checkManualBarcode() {
            const barcode = document.getElementById('manualBarcode').value.trim();
            if (barcode) {
                checkBarcode(barcode);
                document.getElementById('manualBarcode').value = '';
            }
        }

        // Add flag to prevent multiple scans during transition
        let isProcessingAnswer = false;

        function checkBarcode(scannedCode) {
            if (!gameState.isPlaying || isProcessingAnswer) return;
            
            const currentQuestion = gameState.questions[gameState.currentQuestionIndex];
            const isCorrect = currentQuestion.barcode === scannedCode;
            
            // Set processing flag to prevent multiple scans
            isProcessingAnswer = true;
            
            const resultDiv = document.getElementById('scanResult');
            const resultIcon = document.getElementById('resultIcon');
            const resultText = document.getElementById('resultText');
            const questionCard = document.getElementById('questionCard');
            
            if (isCorrect) {
                // Play success sound
                playSound('success');
                
                // Show success result
                resultIcon.textContent = '‚úÖ';
                resultText.textContent = '‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ' + currentQuestion.name;
                resultText.className = 'text-lg font-semibold text-green-600';
                
                // Update question card to show success
                questionCard.className = 'bg-gradient-to-r from-green-50 to-green-100 rounded-lg p-6 text-center bounce-in border-2 border-green-300';
                document.getElementById('questionText').innerHTML = `
                    <div class="text-green-600 font-bold text-xl mb-2">‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!</div>
                    <div class="text-green-700">${currentQuestion.name}</div>
                `;
                
                setTimeout(() => {
                    gameState.currentQuestionIndex++;
                    isProcessingAnswer = false; // Reset flag before showing next question
                    showNextQuestion();
                }, 3000); // Reduced from 5000 to 3000ms
            } else {
                // Play error sound
                playSound('error');
                
                // Show error result
                resultIcon.textContent = '‚ùå';
                resultText.textContent = '‡∏ú‡∏¥‡∏î! ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
                resultText.className = 'text-lg font-semibold text-red-600';
                
                // Update question card to show error
                questionCard.className = 'bg-gradient-to-r from-red-50 to-red-100 rounded-lg p-6 text-center bounce-in border-2 border-red-300';
                document.getElementById('questionText').innerHTML = `
                    <div class="text-red-600 font-bold text-xl mb-2">‚ùå ‡∏ú‡∏¥‡∏î!</div>
                    <div class="text-red-700">‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
                    <div class="text-sm text-gray-600 mt-2">${currentQuestion.hint}</div>
                `;
                
                // Reset to normal after 3 seconds
                setTimeout(() => {
                    questionCard.className = 'bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 text-center fade-in';
                    document.getElementById('questionText').textContent = currentQuestion.hint;
                    isProcessingAnswer = false; // Reset flag
                    if (isScanning) {
                        showScanningStatus();
                    }
                }, 3000); // Reduced from 5000 to 3000ms
            }
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'text-center bounce-in';
        }

        // Leaderboard functions
        function saveScore(playerName, time) {
            let leaderboard = JSON.parse(localStorage.getItem('leaderboard') || '[]');
            leaderboard.push({ name: playerName, time: time, date: new Date().toLocaleDateString('th-TH') });
            leaderboard.sort((a, b) => a.time - b.time);
            leaderboard = leaderboard.slice(0, 10); // Keep top 10
            localStorage.setItem('leaderboard', JSON.stringify(leaderboard));
        }

        function loadLeaderboard() {
            const leaderboard = JSON.parse(localStorage.getItem('leaderboard') || '[]');
            const listDiv = document.getElementById('leaderboardList');
            
            if (leaderboard.length === 0) {
                listDiv.innerHTML = '<div class="text-center text-gray-500 py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>';
                return;
            }
            
            listDiv.innerHTML = leaderboard.map((score, index) => {
                const minutes = Math.floor(score.time / 60);
                const seconds = score.time % 60;
                const timeStr = String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
                
                const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
                
                return `
                    <div class="flex items-center justify-between p-4 bg-gradient-to-r ${index < 3 ? 'from-yellow-50 to-orange-50 border-2 border-yellow-200' : 'from-gray-50 to-gray-100'} rounded-lg">
                        <div class="flex items-center space-x-4">
                            <span class="text-2xl">${medal}</span>
                            <div>
                                <div class="font-semibold text-gray-800">${score.name}</div>
                                <div class="text-sm text-gray-500">${score.date}</div>
                            </div>
                        </div>
                        <div class="text-xl font-bold text-indigo-600">${timeStr}</div>
                    </div>
                `;
            }).join('');
        }

        function clearLeaderboard() {
            const password = prompt('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:');
            if (password === 'Tle019') {
                if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) {
                    localStorage.removeItem('leaderboard');
                    loadLeaderboard();
                    alert('‡∏•‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                }
            } else if (password !== null) {
                alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
            }
        }

        // Admin functions
        function adminLogin() {
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            
            if (username === 'admin' && password === 'Tle019') {
                document.getElementById('adminLogin').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                loadEquipmentList();
            } else {
                alert('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
            }
        }

        function adminLogout() {
            document.getElementById('adminLogin').style.display = 'block';
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('adminUsername').value = '';
            document.getElementById('adminPassword').value = '';
        }

        function addEquipment() {
            const name = document.getElementById('equipmentName').value.trim();
            const hint = document.getElementById('equipmentHint').value.trim();
            const barcode = document.getElementById('equipmentBarcode').value.trim();
            
            if (!name || !hint || !barcode) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }
            
            // Check for duplicate barcode
            if (equipmentData.some(item => item.barcode === barcode)) {
                alert('‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß');
                return;
            }
            
            equipmentData.push({ name, hint, barcode });
            saveData();
            loadEquipmentList();
            
            // Clear form
            document.getElementById('equipmentName').value = '';
            document.getElementById('equipmentHint').value = '';
            document.getElementById('equipmentBarcode').value = '';
            
            alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }

        function deleteEquipment(index) {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ?')) {
                equipmentData.splice(index, 1);
                saveData();
                loadEquipmentList();
            }
        }

        function loadEquipmentList() {
            const listDiv = document.getElementById('equipmentList');
            
            if (equipmentData.length === 0) {
                listDiv.innerHTML = '<div class="text-center text-gray-500 py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</div>';
                return;
            }
            
            listDiv.innerHTML = equipmentData.map((item, index) => `
                <div class="bg-gray-50 rounded-lg p-4 flex items-center justify-between">
                    <div class="flex-1">
                        <div class="font-semibold text-gray-800">${item.name}</div>
                        <div class="text-sm text-gray-600 mt-1">${item.hint}</div>
                        <div class="text-xs text-gray-500 mt-1">‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î: ${item.barcode}</div>
                    </div>
                    <button onclick="deleteEquipment(${index})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">‡∏•‡∏ö</button>
                </div>
            `).join('');
        }

        function saveGameSettings() {
            const timeLimit = document.getElementById('gameTimeLimit').value;
            const questionsPerRound = document.getElementById('questionsPerRound').value;
            
            gameState.timeLimit = parseInt(timeLimit) * 60;
            gameState.questionsPerRound = parseInt(questionsPerRound);
            
            localStorage.setItem('gameTimeLimit', timeLimit);
            localStorage.setItem('questionsPerRound', questionsPerRound);
            
            alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            loadEquipmentList();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97cc83ab700e74d4',t:'MTc1NzQ4MjAyNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
