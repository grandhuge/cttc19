<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ศูนย์การเรียนรู้คอมพิวเตอร์แบบเกม - โซน 3: คลิกพิชิตโลก</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Kanit', sans-serif;
        }
        
        .game-card {
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        .draggable {
            cursor: grab;
            transition: all 0.2s ease;
            user-select: none;
        }
        
        .draggable:active {
            cursor: grabbing;
            transform: scale(1.05);
        }
        
        .draggable.dragging {
            opacity: 0.5;
            transform: rotate(5deg) scale(1.1);
            z-index: 1000;
        }
        
        .drop-zone {
            border: 3px dashed #cbd5e0;
            transition: all 0.3s ease;
            min-height: 120px;
        }
        
        .drop-zone.drag-over {
            border-color: #48bb78;
            background-color: #f0fff4;
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(72, 187, 120, 0.3);
        }
        
        .drop-zone.filled {
            border-color: #10b981;
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
        }
        
        .maze-path {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
        }
        
        .maze-wall {
            background: linear-gradient(45deg, #2d3748, #4a5568);
            border: 1px solid #1a202c;
        }
        
        .player {
            width: 18px;
            height: 18px;
            background: linear-gradient(45deg, #4299e1, #3182ce);
            border: 2px solid #2b77cb;
            border-radius: 50%;
            position: absolute;
            transition: all 0.15s ease;
            z-index: 10;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .maze-goal {
            background: linear-gradient(45deg, #f56565, #e53e3e);
            border: 2px solid #c53030;
            animation: goalPulse 2s infinite;
        }
        
        @keyframes goalPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(245, 101, 101, 0.7); }
            50% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(245, 101, 101, 0); }
        }
        
        .target {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            position: absolute;
            cursor: pointer;
            animation: targetFloat 2s ease-in-out infinite;
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            border: 3px solid #fff;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.2s ease;
        }
        
        .target:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        @keyframes targetFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }
        
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translateY(0); }
            40%, 43% { transform: translateY(-10px); }
            70% { transform: translateY(-5px); }
        }
        
        .bounce {
            animation: bounce 0.6s ease;
        }
        
        .score-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            animation: scoreShow 1.5s ease;
            pointer-events: none;
        }
        
        @keyframes scoreShow {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5) rotate(-10deg); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2) rotate(5deg); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1) rotate(0deg); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8) rotate(0deg); }
        }
        
        .timer-warning {
            animation: timerBlink 0.8s infinite;
        }
        
        @keyframes timerBlink {
            0%, 50% { color: #ef4444; transform: scale(1); }
            51%, 100% { color: #fbbf24; transform: scale(1.05); }
        }
        
        .combo-effect {
            animation: comboGlow 1s ease;
        }
        
        @keyframes comboGlow {
            0% { transform: scale(1); box-shadow: 0 0 0 rgba(34, 197, 94, 0.7); }
            50% { transform: scale(1.15); box-shadow: 0 0 25px rgba(34, 197, 94, 0.7); }
            100% { transform: scale(1); box-shadow: 0 0 0 rgba(34, 197, 94, 0.7); }
        }
        
        .perfect-match {
            animation: perfectGlow 1.2s ease;
        }
        
        @keyframes perfectGlow {
            0% { background: linear-gradient(45deg, #10b981, #34d399); }
            33% { background: linear-gradient(45deg, #fbbf24, #f59e0b); }
            66% { background: linear-gradient(45deg, #8b5cf6, #a78bfa); }
            100% { background: linear-gradient(45deg, #10b981, #34d399); }
        }
        
        .stats-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 2px solid #cbd5e0;
            transition: all 0.3s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border-color: #a0aec0;
        }
        
        .record-badge {
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            animation: recordShine 3s infinite;
        }
        
        @keyframes recordShine {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.9; transform: scale(1.02); }
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #34d399);
            transition: width 0.3s ease;
        }
        
        .difficulty-indicator {
            display: inline-flex;
            align-items: center;
            gap: 2px;
        }
        
        .difficulty-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #cbd5e0;
        }
        
        .difficulty-dot.active {
            background: #fbbf24;
        }
        
        .game-instructions {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border: 2px solid #bfdbfe;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }
        
        .hit-effect {
            position: absolute;
            pointer-events: none;
            color: #10b981;
            font-weight: bold;
            font-size: 18px;
            animation: hitFloat 1s ease-out forwards;
        }
        
        @keyframes hitFloat {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-30px) scale(1.2); }
        }
        
        .miss-effect {
            position: absolute;
            pointer-events: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(239,68,68,0.6) 0%, rgba(239,68,68,0) 70%);
            animation: missExpand 0.5s ease-out forwards;
        }
        
        @keyframes missExpand {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(1); opacity: 0; }
        }
        
        .level-complete {
            background: linear-gradient(45deg, #10b981, #34d399);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            animation: levelCompleteShow 2s ease;
        }
        
        @keyframes levelCompleteShow {
            0% { opacity: 0; transform: scale(0.5) rotate(-10deg); }
            50% { opacity: 1; transform: scale(1.1) rotate(5deg); }
            100% { opacity: 1; transform: scale(1) rotate(0deg); }
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(-10px); }
            20% { opacity: 1; transform: translateY(0); }
            80% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-10px); }
        }
        
        /* Sound and Visual Effects Animations */
        @keyframes soundWaveExpand {
            0% { 
                transform: translate(-50%, -50%) scale(0);
                opacity: 1;
            }
            100% { 
                transform: translate(-50%, -50%) scale(8);
                opacity: 0;
            }
        }
        
        @keyframes screenShake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
            20%, 40%, 60%, 80% { transform: translateX(2px); }
        }
        
        @keyframes comboParticleFloat {
            0% { 
                transform: translate(-50%, -50%) rotate(0deg) scale(0);
                opacity: 1;
            }
            50% {
                transform: translate(-50%, -50%) rotate(180deg) scale(1.2);
                opacity: 0.8;
            }
            100% { 
                transform: translate(-50%, -50%) rotate(360deg) scale(0) translateY(-100px);
                opacity: 0;
            }
        }
        
        @keyframes fireworkExplode {
            0% { 
                transform: scale(0) rotate(0deg);
                opacity: 1;
            }
            20% {
                transform: scale(1.5) rotate(90deg);
                opacity: 1;
            }
            100% { 
                transform: scale(0.5) rotate(360deg);
                opacity: 0;
            }
        }
        
        @keyframes rippleEffect {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }
        
        @keyframes buttonPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes glowPulse {
            0%, 100% { 
                box-shadow: 0 0 5px rgba(59, 130, 246, 0.5);
            }
            50% { 
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.8), 0 0 30px rgba(59, 130, 246, 0.6);
            }
        }
        
        @keyframes wiggle {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-3deg); }
            75% { transform: rotate(3deg); }
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* Interactive Button Effects */
        .interactive-btn {
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        
        .interactive-btn:hover {
            animation: buttonPulse 0.6s ease infinite;
        }
        
        .interactive-btn:active {
            transform: scale(0.95);
        }
        
        .game-card:hover {
            animation: glowPulse 2s ease infinite;
        }
        
        .mascot-wiggle {
            animation: wiggle 2s ease-in-out infinite;
        }
        
        .heartbeat-effect {
            animation: heartbeat 1.5s ease-in-out infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-400 via-pink-500 to-red-500 min-h-screen">
    <!-- Header -->
    <div class="bg-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center space-x-4">
                    <img src="https://cttc19.onrender.com/game/img/logo.png" alt="CTTC19 Logo" class="w-16 h-16 object-contain" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <div class="text-4xl hidden">🎮</div>
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold text-gray-800">ศูนย์การเรียนรู้คอมพิวเตอร์แบบเกม</h1>
                        <p class="text-gray-600 text-sm md:text-base">สำหรับนักเรียนระดับประถมศึกษา</p>
                        <p class="text-blue-600 font-semibold text-xs md:text-sm">โซน 3: คลิกพิชิตโลก (Mouse Adventure - Level 3)</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2 md:space-x-4 flex-wrap justify-center md:justify-end">
                    <div class="text-center">
                        <div class="text-xl md:text-2xl font-bold text-blue-600" id="totalScore">0</div>
                        <div class="text-xs md:text-sm text-gray-600">คะแนนรวม</div>
                    </div>
                    <div class="text-center">
                        <div class="text-xl md:text-2xl" id="badges">🏆</div>
                        <div class="text-xs md:text-sm text-gray-600">เหรียญ</div>
                    </div>
                    <div class="text-center hidden md:block">
                        <div class="text-lg font-bold text-green-600" id="headerGame1Best">0</div>
                        <div class="text-xs text-gray-600">🧲 สูงสุด</div>
                    </div>
                    <div class="text-center hidden md:block">
                        <div class="text-lg font-bold text-purple-600" id="headerGame2Best">0</div>
                        <div class="text-xs text-gray-600">🌀 สูงสุด</div>
                    </div>
                    <div class="text-center hidden md:block">
                        <div class="text-lg font-bold text-red-600" id="headerGame3Best">0</div>
                        <div class="text-xs text-gray-600">⏱️ สูงสุด</div>
                    </div>
                    <button onclick="showStats()" class="interactive-btn bg-purple-500 hover:bg-purple-600 text-white px-3 md:px-4 py-2 rounded-lg transition-colors flex items-center space-x-1 md:space-x-2 text-sm md:text-base">
                        <span>📊</span>
                        <span class="hidden md:inline">สถิติ</span>
                        <span class="md:hidden">สถิติ</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mascot Introduction -->
    <div class="container mx-auto px-4 py-6">
        <div class="bg-gradient-to-r from-blue-100 to-purple-100 rounded-2xl p-6 text-center shadow-lg">
            <div class="flex flex-col md:flex-row items-center justify-center gap-6">
                <img src="https://cttc19.onrender.com/game/img/mascot.gif" alt="CTTC Mascot" class="w-24 h-24 object-contain mascot-wiggle" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <div class="text-6xl hidden mascot-wiggle">🤖</div>
                <div class="text-center md:text-left">
                    <h2 class="text-2xl font-bold text-blue-800 mb-2">สวัสดีครับ! ผมคือ CTTC Bot</h2>
                    <p class="text-blue-700 text-lg">ยินดีต้อนรับสู่โซน 3: คลิกพิชิตโลก!</p>
                    <p class="text-blue-600 text-sm mt-2">เลือกเกมที่ต้องการเล่น แล้วฝึกฝนทักษะการใช้เมาส์ขั้นสูงกันเถอะ</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Selection -->
    <div class="container mx-auto px-4 py-8">
        <div class="grid md:grid-cols-3 gap-8">
            <!-- Game 1: Drag & Drop -->
            <div class="game-card interactive-btn rounded-2xl p-6 text-white cursor-pointer" onclick="startGame(1)">
                <div class="text-6xl mb-4 text-center heartbeat-effect">🧲</div>
                <h3 class="text-2xl font-bold mb-2">เกมลากไอเทม</h3>
                <p class="text-lg opacity-90 mb-3">ลากอุปกรณ์คอมพิวเตอร์ไปยังตำแหน่งที่ถูกต้อง</p>
                <div class="bg-white bg-opacity-20 rounded-lg p-3 mb-4">
                    <h4 class="font-bold text-sm mb-2">🎯 เป้าหมาย:</h4>
                    <ul class="text-xs space-y-1">
                        <li>• ฝึกการลากและวางด้วยเมาส์</li>
                        <li>• เรียนรู้ชื่อและตำแหน่งอุปกรณ์</li>
                        <li>• พัฒนาการประสานงานมือ-ตา</li>
                    </ul>
                </div>
                <div class="flex justify-between items-center">
                    <div class="difficulty-indicator">
                        <span class="text-sm mr-2">ระดับ:</span>
                        <div class="difficulty-dot active"></div>
                        <div class="difficulty-dot active"></div>
                        <div class="difficulty-dot"></div>
                    </div>
                    <span class="text-2xl">→</span>
                </div>
            </div>

            <!-- Game 2: Maze -->
            <div class="game-card interactive-btn rounded-2xl p-6 text-white cursor-pointer" onclick="startGame(2)">
                <div class="text-6xl mb-4 text-center heartbeat-effect">🌀</div>
                <h3 class="text-2xl font-bold mb-2">เขาวงกตเมาส์</h3>
                <p class="text-lg opacity-90 mb-3">ใช้เมาส์นำทางหาทางออกจากเขาวงกต</p>
                <div class="bg-white bg-opacity-20 rounded-lg p-3 mb-4">
                    <h4 class="font-bold text-sm mb-2">🎯 เป้าหมาย:</h4>
                    <ul class="text-xs space-y-1">
                        <li>• ฝึกการควบคุมเมาส์อย่างแม่นยำ</li>
                        <li>• พัฒนาทักษะการแก้ปัญหา</li>
                        <li>• เสริมสร้างความอดทนและสมาธิ</li>
                    </ul>
                </div>
                <div class="flex justify-between items-center">
                    <div class="difficulty-indicator">
                        <span class="text-sm mr-2">ระดับ:</span>
                        <div class="difficulty-dot active"></div>
                        <div class="difficulty-dot active"></div>
                        <div class="difficulty-dot active"></div>
                    </div>
                    <span class="text-2xl">→</span>
                </div>
            </div>

            <!-- Game 3: Speed Click -->
            <div class="game-card interactive-btn rounded-2xl p-6 text-white cursor-pointer" onclick="startGame(3)">
                <div class="text-6xl mb-4 text-center heartbeat-effect">⏱️</div>
                <h3 class="text-2xl font-bold mb-2">แข่งความเร็ว</h3>
                <p class="text-lg opacity-90 mb-3">คลิกเป้าหมายให้เร็วและแม่นยำ</p>
                <div class="bg-white bg-opacity-20 rounded-lg p-3 mb-4">
                    <h4 class="font-bold text-sm mb-2">🎯 เป้าหมาย:</h4>
                    <ul class="text-xs space-y-1">
                        <li>• ฝึกความเร็วในการคลิกเมาส์</li>
                        <li>• พัฒนาความแม่นยำและสมาธิ</li>
                        <li>• เสริมสร้างปฏิกิริยาตอบสนอง</li>
                    </ul>
                </div>
                <div class="flex justify-between items-center">
                    <div class="difficulty-indicator">
                        <span class="text-sm mr-2">ระดับ:</span>
                        <div class="difficulty-dot active"></div>
                        <div class="difficulty-dot active"></div>
                        <div class="difficulty-dot active"></div>
                    </div>
                    <span class="text-2xl">→</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Area -->
    <div id="statsArea" class="hidden container mx-auto px-4 pb-8">
        <div class="bg-white rounded-2xl shadow-2xl p-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold text-gray-800">📊 สถิติการเล่น</h2>
                <button onclick="hideStats()" class="interactive-btn bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors">
                    กลับเมนู
                </button>
            </div>
            
            <div class="grid md:grid-cols-3 gap-6">
                <!-- Game 1 Stats -->
                <div class="stats-card rounded-xl p-6">
                    <div class="text-center mb-4">
                        <div class="text-4xl mb-2">🧲</div>
                        <h3 class="text-xl font-bold text-gray-800">เกมลากไอเทม</h3>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">คะแนนสูงสุด:</span>
                            <span class="font-bold text-blue-600" id="game1HighScore">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">รอบที่ทำสถิติ:</span>
                            <span class="font-bold text-orange-600" id="game1BestRound">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">เวลาเร็วสุด:</span>
                            <span class="font-bold text-green-600" id="game1BestTime">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">เล่นทั้งหมด:</span>
                            <span class="font-bold text-purple-600" id="game1PlayCount">0</span>
                        </div>
                        <div class="mt-3">
                            <div class="text-sm text-gray-600 mb-1">ความแม่นยำ</div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="game1Accuracy" style="width: 0%"></div>
                            </div>
                            <div class="text-xs text-gray-500 mt-1" id="game1AccuracyText">0%</div>
                        </div>
                    </div>
                </div>

                <!-- Game 2 Stats -->
                <div class="stats-card rounded-xl p-6">
                    <div class="text-center mb-4">
                        <div class="text-4xl mb-2">🌀</div>
                        <h3 class="text-xl font-bold text-gray-800">เขาวงกตเมาส์</h3>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">คะแนนสูงสุด:</span>
                            <span class="font-bold text-blue-600" id="game2HighScore">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">รอบที่ทำสถิติ:</span>
                            <span class="font-bold text-orange-600" id="game2BestRound">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">เวลาเร็วสุด:</span>
                            <span class="font-bold text-green-600" id="game2BestTime">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">เล่นทั้งหมด:</span>
                            <span class="font-bold text-purple-600" id="game2PlayCount">0</span>
                        </div>
                        <div class="mt-3">
                            <div class="text-sm text-gray-600 mb-1">อัตราสำเร็จ</div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="game2Success" style="width: 0%"></div>
                            </div>
                            <div class="text-xs text-gray-500 mt-1" id="game2SuccessText">0%</div>
                        </div>
                    </div>
                </div>

                <!-- Game 3 Stats -->
                <div class="stats-card rounded-xl p-6">
                    <div class="text-center mb-4">
                        <div class="text-4xl mb-2">⏱️</div>
                        <h3 class="text-xl font-bold text-gray-800">แข่งความเร็ว</h3>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">คะแนนสูงสุด:</span>
                            <span class="font-bold text-blue-600" id="game3HighScore">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">รอบที่ทำสถิติ:</span>
                            <span class="font-bold text-orange-600" id="game3BestRound">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">คลิกถูกสูงสุด:</span>
                            <span class="font-bold text-green-600" id="game3BestHits">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">เล่นทั้งหมด:</span>
                            <span class="font-bold text-purple-600" id="game3PlayCount">0</span>
                        </div>
                        <div class="mt-3">
                            <div class="text-sm text-gray-600 mb-1">ความแม่นยำ</div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="game3Accuracy" style="width: 0%"></div>
                            </div>
                            <div class="text-xs text-gray-500 mt-1" id="game3AccuracyText">0%</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Overall Stats -->
            <div class="mt-8 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">🏆 สถิติรวม</h3>
                <div class="grid md:grid-cols-4 gap-4 text-center">
                    <div>
                        <div class="text-3xl font-bold text-blue-600" id="totalGamesPlayed">0</div>
                        <div class="text-sm text-gray-600">เกมที่เล่น</div>
                    </div>
                    <div>
                        <div class="text-3xl font-bold text-green-600" id="totalBadges">0</div>
                        <div class="text-sm text-gray-600">เหรียญที่ได้</div>
                    </div>
                    <div>
                        <div class="text-3xl font-bold text-purple-600" id="totalPlayTime">0</div>
                        <div class="text-sm text-gray-600">นาทีที่เล่น</div>
                    </div>
                    <div>
                        <div class="text-3xl font-bold text-orange-600" id="averageScore">0</div>
                        <div class="text-sm text-gray-600">คะแนนเฉลี่ย</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Summary Area -->
    <div id="gameSummaryArea" class="hidden container mx-auto px-4 pb-8">
        <div class="bg-white rounded-2xl shadow-2xl p-8">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4" id="summaryGameIcon">🎮</div>
                <h2 class="text-3xl font-bold text-gray-800 mb-2" id="summaryGameTitle">สรุปผลการเล่น</h2>
                <div class="text-lg text-gray-600" id="summaryGameSubtitle">รอบที่เพิ่งเล่นจบ</div>
            </div>
            
            <div class="grid md:grid-cols-2 gap-8 mb-8">
                <!-- Score Summary -->
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-6">
                    <h3 class="text-xl font-bold text-blue-800 mb-4 text-center">📊 คะแนนรอบนี้</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700">คะแนนพื้นฐาน:</span>
                            <span class="font-bold text-blue-600" id="summaryBaseScore">0</span>
                        </div>
                        <div class="flex justify-between items-center" id="summaryBonusRow" style="display: none;">
                            <span class="text-gray-700">โบนัส:</span>
                            <span class="font-bold text-green-600" id="summaryBonusScore">0</span>
                        </div>
                        <div class="flex justify-between items-center" id="summaryComboRow" style="display: none;">
                            <span class="text-gray-700">คอมโบสูงสุด:</span>
                            <span class="font-bold text-orange-600" id="summaryMaxCombo">0</span>
                        </div>
                        <hr class="border-gray-300">
                        <div class="flex justify-between items-center text-lg">
                            <span class="font-bold text-gray-800">คะแนนรวม:</span>
                            <span class="font-bold text-purple-600 text-2xl" id="summaryTotalScore">0</span>
                        </div>
                    </div>
                </div>
                
                <!-- Performance Summary -->
                <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-6">
                    <h3 class="text-xl font-bold text-green-800 mb-4 text-center">⏱️ สถิติการเล่น</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700">เวลาที่ใช้:</span>
                            <span class="font-bold text-green-600" id="summaryTime">00:00</span>
                        </div>
                        <div class="flex justify-between items-center" id="summaryAccuracyRow">
                            <span class="text-gray-700">ความแม่นยำ:</span>
                            <span class="font-bold text-blue-600" id="summaryAccuracy">100%</span>
                        </div>
                        <div class="flex justify-between items-center" id="summaryAttemptsRow">
                            <span class="text-gray-700">จำนวนครั้งที่ลง:</span>
                            <span class="font-bold text-purple-600" id="summaryAttempts">0</span>
                        </div>
                        <div class="flex justify-between items-center" id="summarySpecialRow">
                            <span class="text-gray-700" id="summarySpecialLabel">พิเศษ:</span>
                            <span class="font-bold text-orange-600" id="summarySpecialValue">-</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Achievements -->
            <div id="summaryAchievements" class="bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-xl p-6 mb-8" style="display: none;">
                <h3 class="text-xl font-bold text-yellow-800 mb-4 text-center">🏆 ความสำเร็จใหม่</h3>
                <div class="flex justify-center flex-wrap gap-4" id="summaryBadgesList">
                    <!-- New badges will be shown here -->
                </div>
            </div>
            
            <!-- Records -->
            <div id="summaryRecords" class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-6 mb-8" style="display: none;">
                <h3 class="text-xl font-bold text-purple-800 mb-4 text-center">🌟 สถิติใหม่</h3>
                <div class="text-center" id="summaryRecordsList">
                    <!-- New records will be shown here -->
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 flex-wrap gap-4">
                <button onclick="playAgain()" class="interactive-btn bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-lg transition-colors text-lg font-bold flex items-center space-x-2">
                    <span>🔄</span>
                    <span>เล่นอีกครั้ง</span>
                </button>
                <button onclick="backToMenuFromSummary()" class="interactive-btn bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-lg transition-colors text-lg font-bold flex items-center space-x-2">
                    <span>🏠</span>
                    <span>กลับหน้าแรก</span>
                </button>
                <button onclick="showStatsFromSummary()" class="interactive-btn bg-purple-500 hover:bg-purple-600 text-white px-8 py-3 rounded-lg transition-colors text-lg font-bold flex items-center space-x-2">
                    <span>📊</span>
                    <span>ดูสถิติ</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Game Area -->
    <div id="gameArea" class="hidden container mx-auto px-4 pb-8">
        <div class="bg-white rounded-2xl shadow-2xl p-8">
            <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
                <h2 id="gameTitle" class="text-3xl font-bold text-gray-800"></h2>
                <div class="flex items-center space-x-4 flex-wrap">
                    <div class="text-center">
                        <div class="text-xl font-bold text-blue-600" id="gameScore">0</div>
                        <div class="text-sm text-gray-600">คะแนน</div>
                    </div>
                    <div class="text-center">
                        <div class="text-xl font-bold text-green-600" id="gameTimer">00:00</div>
                        <div class="text-sm text-gray-600">เวลา</div>
                    </div>
                    <div class="text-center" id="comboDisplay" style="display: none;">
                        <div class="text-xl font-bold text-orange-600" id="comboCount">0</div>
                        <div class="text-sm text-gray-600">คอมโบ</div>
                    </div>
                    <button onclick="backToMenu()" class="interactive-btn bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors">
                        กลับเมนู
                    </button>
                </div>
            </div>
            
            <!-- Game 1: Drag & Drop Area -->
            <div id="game1Area" class="hidden">
                <div class="game-instructions">
                    <h4 class="font-bold text-blue-800 mb-2">📋 วิธีเล่น:</h4>
                    <p class="text-blue-700 mb-2">ช่วยน้องมิกิ 👧 จัดโต๊ะคอมพิวเตอร์ให้เรียบร้อย! ลากอุปกรณ์ไปวางในตำแหน่งที่ถูกต้องตามการใช้งานจริง</p>
                    <div class="bg-blue-50 rounded-lg p-3 mt-3">
                        <h5 class="font-semibold text-blue-800 text-sm mb-2">💡 เคล็ดลับ:</h5>
                        <ul class="text-blue-700 text-sm space-y-1">
                            <li>• จอมอนิเตอร์ควรอยู่ตรงกลางด้านหลัง</li>
                            <li>• คีย์บอร์ดและเมาส์อยู่ด้านหน้าใกล้ผู้ใช้</li>
                            <li>• ลำโพงและเครื่องพิมพ์อยู่ข้างๆ</li>
                            <li>• กล้องเว็บแคมติดตั้งบนจอมอนิเตอร์</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Character Introduction -->
                <div class="bg-gradient-to-r from-pink-100 to-purple-100 rounded-xl p-4 mb-6 text-center">
                    <div class="text-6xl mb-2">👧</div>
                    <h3 class="text-xl font-bold text-purple-800">น้องมิกิ</h3>
                    <p class="text-purple-600 text-sm">"ช่วยฉันจัดโต๊ะคอมพิวเตอร์หน่อยนะ! วางอุปกรณ์ให้ถูกตำแหน่งด้วย"</p>
                </div>
                
                <div class="grid lg:grid-cols-3 gap-6">
                    <!-- Items to drag -->
                    <div class="lg:col-span-1">
                        <h4 class="text-lg font-semibold mb-4 text-gray-700 text-center">🎒 อุปกรณ์ที่ต้องจัด</h4>
                        <div id="dragItems" class="grid grid-cols-2 gap-3">
                            <!-- Items will be generated here -->
                        </div>
                    </div>
                    
                    <!-- Computer Desk Layout -->
                    <div class="lg:col-span-2">
                        <h4 class="text-lg font-semibold mb-4 text-gray-700 text-center">🖥️ โต๊ะคอมพิวเตอร์ของน้องมิกิ</h4>
                        <div class="relative bg-gradient-to-br from-amber-100 to-amber-200 rounded-2xl p-6 border-4 border-amber-300" style="min-height: 400px;">
                            
                            <!-- Desk Surface -->
                            <div class="absolute inset-4 bg-gradient-to-br from-amber-50 to-amber-100 rounded-xl border-2 border-amber-200"></div>
                            
                            <!-- Monitor Area (Back Center) -->
                            <div id="monitor-zone" class="drop-zone absolute top-6 left-1/2 transform -translate-x-1/2 w-32 h-24 bg-gray-100 border-2 border-dashed border-gray-400 rounded-lg flex flex-col items-center justify-center text-xs text-gray-500" data-id="monitor">
                                <div class="text-2xl opacity-50">🖥️</div>
                                <div class="text-center mt-1">จอมอนิเตอร์</div>
                            </div>
                            
                            <!-- Keyboard Area (Front Center) -->
                            <div id="keyboard-zone" class="drop-zone absolute bottom-16 left-1/2 transform -translate-x-1/2 w-28 h-12 bg-gray-100 border-2 border-dashed border-gray-400 rounded-lg flex flex-col items-center justify-center text-xs text-gray-500" data-id="keyboard">
                                <div class="text-lg opacity-50">⌨️</div>
                                <div class="text-center">คีย์บอร์ด</div>
                            </div>
                            
                            <!-- Mouse Area (Right of Keyboard) -->
                            <div id="mouse-zone" class="drop-zone absolute bottom-16 right-12 w-16 h-12 bg-gray-100 border-2 border-dashed border-gray-400 rounded-lg flex flex-col items-center justify-center text-xs text-gray-500" data-id="mouse">
                                <div class="text-lg opacity-50">🖱️</div>
                                <div class="text-center">เมาส์</div>
                            </div>
                            
                            <!-- Speaker Area (Left Side) -->
                            <div id="speaker-zone" class="drop-zone absolute top-20 left-6 w-20 h-16 bg-gray-100 border-2 border-dashed border-gray-400 rounded-lg flex flex-col items-center justify-center text-xs text-gray-500" data-id="speaker">
                                <div class="text-lg opacity-50">🔊</div>
                                <div class="text-center">ลำโพง</div>
                            </div>
                            
                            <!-- Printer Area (Right Side) -->
                            <div id="printer-zone" class="drop-zone absolute top-20 right-6 w-20 h-20 bg-gray-100 border-2 border-dashed border-gray-400 rounded-lg flex flex-col items-center justify-center text-xs text-gray-500" data-id="printer">
                                <div class="text-lg opacity-50">🖨️</div>
                                <div class="text-center">เครื่องพิมพ์</div>
                            </div>
                            
                            <!-- Webcam Area (Top of Monitor) -->
                            <div id="webcam-zone" class="drop-zone absolute top-2 left-1/2 transform -translate-x-1/2 w-16 h-8 bg-gray-100 border-2 border-dashed border-gray-400 rounded-lg flex flex-col items-center justify-center text-xs text-gray-500" data-id="webcam">
                                <div class="text-sm opacity-50">📹</div>
                                <div class="text-center text-xs">กล้อง</div>
                            </div>
                            
                            <!-- Character (Miki) sitting at desk -->
                            <div class="absolute bottom-4 left-8 text-4xl animate-bounce" style="animation-duration: 3s;">
                                👧
                            </div>
                            
                            <!-- Desk Chair -->
                            <div class="absolute bottom-0 left-6 text-3xl">
                                🪑
                            </div>
                            
                            <!-- Decorative elements -->
                            <div class="absolute top-4 right-4 text-2xl">🌸</div>
                            <div class="absolute bottom-6 right-16 text-xl">📚</div>
                            <div class="absolute top-12 left-2 text-lg">🌱</div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 text-center">
                    <div class="mb-4">
                        <div class="text-sm text-gray-600 mb-2">ความคืบหน้า</div>
                        <div class="progress-bar max-w-md mx-auto">
                            <div class="progress-fill" id="game1Progress" style="width: 0%"></div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1" id="game1ProgressText">0/6 รายการ</div>
                    </div>
                    <button onclick="resetGame1()" class="interactive-btn bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors">
                        เริ่มใหม่
                    </button>
                </div>
            </div>

            <!-- Game 2: Maze Area -->
            <div id="game2Area" class="hidden">
                <div class="game-instructions">
                    <h4 class="font-bold text-purple-800 mb-2">🗺️ วิธีเล่น:</h4>
                    <p class="text-purple-700 mb-2">เลื่อนเมาส์เพื่อควบคุมหุ่นยนต์ 🤖 ไปยังธง 🚩 โดยไม่ชนกำแพงสีเทา หาทางที่สั้นที่สุด!</p>
                    <div class="bg-purple-50 rounded-lg p-3 mt-3">
                        <h5 class="font-semibold text-purple-800 text-sm mb-2">💡 เคล็ดลับ:</h5>
                        <ul class="text-purple-700 text-sm space-y-1">
                            <li>• คลิกที่หุ่นยนต์ 🤖 เพื่อเริ่มเกม</li>
                            <li>• เลื่อนเมาส์ช้าๆ เพื่อความแม่นยำ</li>
                            <li>• หากชนกำแพง เกมจะเริ่มใหม่อัตโนมัติ</li>
                            <li>• หาเส้นทางที่สั้นที่สุดเพื่อได้คะแนนโบนัส</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Difficulty Selection -->
                <div class="mb-4 text-center">
                    <h4 class="text-lg font-semibold mb-3 text-gray-700">🎚️ เลือกระดับความยาก</h4>
                    <div class="flex justify-center space-x-4 flex-wrap gap-2">
                        <button onclick="setMazeDifficulty('easy')" id="easyBtn" class="interactive-btn bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors font-bold text-sm">
                            😊 ง่าย
                        </button>
                        <button onclick="setMazeDifficulty('medium')" id="mediumBtn" class="interactive-btn bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition-colors font-bold text-sm">
                            😐 ปานกลาง
                        </button>
                        <button onclick="setMazeDifficulty('hard')" id="hardBtn" class="interactive-btn bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors font-bold text-sm">
                            😤 ยาก
                        </button>
                    </div>
                    <div class="mt-2 text-sm text-gray-600" id="difficultyDescription">
                        เลือกระดับความยากที่เหมาะกับคุณ
                    </div>
                </div>
                <div class="text-center mb-4">
                    <div class="flex justify-center items-center space-x-6 mb-4">
                        <div class="flex items-center space-x-2">
                            <div class="w-4 h-4 bg-blue-500 rounded-full border-2 border-blue-700"></div>
                            <span class="text-sm text-gray-600">หุ่นยนต์</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-4 h-4 bg-red-500 rounded-full border-2 border-red-700"></div>
                            <span class="text-sm text-gray-600">เป้าหมาย</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-4 h-4 bg-gray-700"></div>
                            <span class="text-sm text-gray-600">กำแพง</span>
                        </div>
                    </div>
                </div>
                <div id="mazeContainer" class="mx-auto bg-gray-100 border-4 border-gray-400 relative rounded-lg overflow-hidden max-w-full" style="width: min(600px, 90vw); height: min(400px, 60vw);">
                    <!-- Maze will be generated here -->
                </div>
                <div class="mt-6 text-center">
                    <button onclick="resetGame2()" class="interactive-btn bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg transition-colors">
                        เริ่มใหม่
                    </button>
                </div>
            </div>

            <!-- Game 3: Speed Click Area -->
            <div id="game3Area" class="hidden">
                <div class="game-instructions">
                    <h4 class="font-bold text-red-800 mb-2">⚡ วิธีเล่น:</h4>
                    <p class="text-red-700 mb-2">คลิกเป้าหมายสีสันสดใส ⭐ ให้เร็วที่สุด! หลีกเลี่ยงการคลิกพื้นที่ว่าง คลิกต่อเนื่องเพื่อสร้างคอมโบ!</p>
                    <div class="bg-red-50 rounded-lg p-3 mt-3">
                        <h5 class="font-semibold text-red-800 text-sm mb-2">💡 เคล็ดลับ:</h5>
                        <ul class="text-red-700 text-sm space-y-1">
                            <li>• กดปุ่ม "เริ่มเกม" เพื่อเริ่มจับเวลา</li>
                            <li>• คลิกเฉพาะเป้าหมายที่เคลื่อนไหว</li>
                            <li>• หลีกเลี่ยงการคลิกพื้นที่ว่าง (จะหักคะแนน)</li>
                            <li>• คลิกต่อเนื่องเพื่อสร้างคอมโบและได้คะแนนพิเศษ</li>
                        </ul>
                    </div>
                </div>
                <div class="text-center mb-4">
                    <div class="flex justify-center items-center space-x-8 mb-4 flex-wrap gap-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-red-600" id="timeLeft">30</div>
                            <div class="text-sm text-gray-600">วินาที</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-600" id="hits">0</div>
                            <div class="text-sm text-gray-600">คลิกถูก</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-orange-600" id="misses">0</div>
                            <div class="text-sm text-gray-600">คลิกพลาด</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-purple-600" id="accuracy">100%</div>
                            <div class="text-sm text-gray-600">ความแม่นยำ</div>
                        </div>
                    </div>
                </div>
                <div id="clickGameArea" class="relative mx-auto bg-gradient-to-br from-blue-100 to-purple-100 border-4 border-blue-300 rounded-xl overflow-hidden max-w-full" style="width: min(600px, 90vw); height: min(400px, 60vw);">
                    <!-- Targets will appear here -->
                </div>
                <div class="mt-6 text-center">
                    <button id="startSpeedGame" onclick="startSpeedGame()" class="interactive-btn bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg transition-colors text-lg font-bold">
                        🚀 เริ่มเกม!
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6 mt-12">
        <div class="container mx-auto px-4 text-center">
            <div class="flex flex-col md:flex-row items-center justify-center gap-4">
                <img src="https://cttc19.onrender.com/game/img/logo.png" alt="CTTC19 Logo" class="w-8 h-8 object-contain" onerror="this.style.display='none';">
                <p class="text-sm text-gray-300">
                    © developed by Tle Narongphisit | CTTC19 @ CPD
                </p>
            </div>
            <div class="mt-2 text-xs text-gray-400">
                ศูนย์การเรียนรู้คอมพิวเตอร์แบบเกม - โซน 3: คลิกพิชิตโลก
            </div>
        </div>
    </footer>

    <script>
        let totalScore = 0;
        let gameScore = 0;
        let badges = [];
        let currentGame = 0;
        
        // Timer Variables
        let gameStartTime = 0;
        let gameTimer = null;
        let gameTimeElapsed = 0;
        
        // Combo System
        let comboCount = 0;
        let comboTimer = null;
        
        // Stats System with enhanced tracking
        let gameStats = {
            game1: { 
                highScore: 0, 
                bestTime: 0, 
                playCount: 0, 
                totalScore: 0, 
                bestScoreRound: 0,
                totalAttempts: 0,
                successfulMatches: 0
            },
            game2: { 
                highScore: 0, 
                bestTime: 0, 
                playCount: 0, 
                totalScore: 0, 
                bestScoreRound: 0,
                completions: 0,
                totalAttempts: 0
            },
            game3: { 
                highScore: 0, 
                bestHits: 0, 
                playCount: 0, 
                totalScore: 0, 
                bestScoreRound: 0,
                bestHitsRound: 0,
                totalHits: 0,
                totalMisses: 0
            },
            totalPlayTime: 0
        };
        
        // Game 1 Variables
        let draggedItem = null;
        let correctMatches = 0;
        let totalItems = 6;
        let game1Attempts = 0;
        
        // Game 2 Variables
        let playerPos = {x: 20, y: 20};
        let maze = [];
        let gameWon = false;
        let mazeAttempts = 0;
        let mazeDifficulty = 'medium';
        let mazeSize = { width: 30, height: 20 };
        
        // Game 3 Variables
        let speedGameActive = false;
        let timeLeft = 30;
        let hits = 0;
        let misses = 0;
        let speedGameTimer = null;
        let targetTimer = null;
        let currentTargets = [];
        
        // Game Summary Variables
        let currentGameSummary = {
            gameNumber: 0,
            baseScore: 0,
            bonusScore: 0,
            totalScore: 0,
            timeElapsed: 0,
            maxCombo: 0,
            newBadges: [],
            newRecords: [],
            gameSpecificData: {}
        };
        
        // Enhanced computer items with more variety
        const computerItems = [
            {id: 'mouse', name: 'เมาส์', emoji: '🖱️', description: 'ใช้สำหรับคลิกและเลื่อน'},
            {id: 'keyboard', name: 'คีย์บอร์ด', emoji: '⌨️', description: 'ใช้สำหรับพิมพ์ข้อความ'},
            {id: 'monitor', name: 'จอมอนิเตอร์', emoji: '🖥️', description: 'แสดงภาพและข้อมูล'},
            {id: 'speaker', name: 'ลำโพง', emoji: '🔊', description: 'เล่นเสียงและเพลง'},
            {id: 'printer', name: 'เครื่องพิมพ์', emoji: '🖨️', description: 'พิมพ์เอกสารและรูปภาพ'},
            {id: 'webcam', name: 'กล้องเว็บแคม', emoji: '📹', description: 'ถ่ายวิดีโอและรูปภาพ'}
        ];

        // Enhanced sound and visual feedback system
        function createAudioContext() {
            try {
                return new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                return null;
            }
        }
        
        let audioContext = null;
        
        function initAudio() {
            if (!audioContext) {
                audioContext = createAudioContext();
            }
        }
        
        function playTone(frequency, duration, type = 'sine', volume = 0.1) {
            initAudio();
            if (!audioContext) return;
            
            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            } catch (e) {
                console.log('Audio playback failed');
            }
        }
        
        function playSuccessSound() {
            // Success chord progression
            playTone(523.25, 0.15, 'sine', 0.08); // C5
            setTimeout(() => playTone(659.25, 0.15, 'sine', 0.08), 50); // E5
            setTimeout(() => playTone(783.99, 0.2, 'sine', 0.08), 100); // G5
            
            // Visual feedback
            createSoundWave('success');
        }
        
        function playErrorSound() {
            // Error sound - descending tone
            playTone(220, 0.1, 'sawtooth', 0.06);
            setTimeout(() => playTone(196, 0.15, 'sawtooth', 0.06), 80);
            setTimeout(() => playTone(174.61, 0.2, 'sawtooth', 0.06), 150);
            
            // Visual feedback
            createSoundWave('error');
            createScreenShake();
        }
        
        function playComboSound() {
            // Combo sound - ascending arpeggio
            const frequencies = [261.63, 329.63, 392, 523.25, 659.25]; // C-E-G-C-E
            frequencies.forEach((freq, index) => {
                setTimeout(() => playTone(freq, 0.12, 'triangle', 0.07), index * 40);
            });
            
            // Visual feedback
            createSoundWave('combo');
            createComboParticles();
        }
        
        function playPerfectSound() {
            // Perfect sound - triumphant fanfare
            playTone(523.25, 0.3, 'sine', 0.1); // C5
            setTimeout(() => playTone(659.25, 0.3, 'sine', 0.1), 100); // E5
            setTimeout(() => playTone(783.99, 0.3, 'sine', 0.1), 200); // G5
            setTimeout(() => playTone(1046.5, 0.4, 'sine', 0.12), 300); // C6
            
            // Visual feedback
            createSoundWave('perfect');
            createFireworks();
        }
        
        function playClickSound() {
            // Button click sound
            playTone(800, 0.08, 'square', 0.04);
            setTimeout(() => playTone(1000, 0.06, 'square', 0.03), 30);
        }
        
        function playHoverSound() {
            // Subtle hover sound
            playTone(600, 0.05, 'sine', 0.02);
        }
        
        function playStartSound() {
            // Game start fanfare
            playTone(392, 0.15, 'triangle', 0.08);
            setTimeout(() => playTone(523.25, 0.15, 'triangle', 0.08), 100);
            setTimeout(() => playTone(659.25, 0.2, 'triangle', 0.08), 200);
        }
        
        // Visual Effects Functions
        function createSoundWave(type) {
            const wave = document.createElement('div');
            wave.className = `sound-wave sound-wave-${type}`;
            wave.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                width: 20px;
                height: 20px;
                border-radius: 50%;
                pointer-events: none;
                z-index: 9999;
                transform: translate(-50%, -50%);
                animation: soundWaveExpand 0.6s ease-out forwards;
            `;
            
            const colors = {
                success: 'rgba(34, 197, 94, 0.6)',
                error: 'rgba(239, 68, 68, 0.6)',
                combo: 'rgba(251, 191, 36, 0.6)',
                perfect: 'rgba(168, 85, 247, 0.6)'
            };
            
            wave.style.backgroundColor = colors[type] || colors.success;
            document.body.appendChild(wave);
            
            setTimeout(() => {
                if (wave.parentNode) wave.remove();
            }, 600);
        }
        
        function createScreenShake() {
            document.body.style.animation = 'screenShake 0.3s ease-in-out';
            setTimeout(() => {
                document.body.style.animation = '';
            }, 300);
        }
        
        function createComboParticles() {
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'combo-particle';
                    particle.innerHTML = ['✨', '⭐', '💫', '🌟'][Math.floor(Math.random() * 4)];
                    particle.style.cssText = `
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        font-size: 20px;
                        pointer-events: none;
                        z-index: 9999;
                        animation: comboParticleFloat 1s ease-out forwards;
                        transform: translate(-50%, -50%) rotate(${Math.random() * 360}deg);
                    `;
                    
                    document.body.appendChild(particle);
                    
                    setTimeout(() => {
                        if (particle.parentNode) particle.remove();
                    }, 1000);
                }, i * 50);
            }
        }
        
        function createFireworks() {
            for (let i = 0; i < 12; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    firework.innerHTML = ['🎆', '🎇', '✨', '💥'][Math.floor(Math.random() * 4)];
                    firework.style.cssText = `
                        position: fixed;
                        top: ${20 + Math.random() * 60}%;
                        left: ${20 + Math.random() * 60}%;
                        font-size: ${20 + Math.random() * 15}px;
                        pointer-events: none;
                        z-index: 9999;
                        animation: fireworkExplode 1.5s ease-out forwards;
                    `;
                    
                    document.body.appendChild(firework);
                    
                    setTimeout(() => {
                        if (firework.parentNode) firework.remove();
                    }, 1500);
                }, i * 100);
            }
        }
        
        function createButtonRipple(element, event) {
            const ripple = document.createElement('div');
            const rect = element.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = event.clientX - rect.left - size / 2;
            const y = event.clientY - rect.top - size / 2;
            
            ripple.style.cssText = `
                position: absolute;
                width: ${size}px;
                height: ${size}px;
                left: ${x}px;
                top: ${y}px;
                background: rgba(255, 255, 255, 0.3);
                border-radius: 50%;
                pointer-events: none;
                animation: rippleEffect 0.6s ease-out forwards;
            `;
            
            element.style.position = 'relative';
            element.style.overflow = 'hidden';
            element.appendChild(ripple);
            
            setTimeout(() => {
                if (ripple.parentNode) ripple.remove();
            }, 600);
        }

        function startGame(gameNum) {
            // Play start sound and visual effect
            playStartSound();
            createSoundWave('success');
            
            currentGame = gameNum;
            document.getElementById('gameArea').classList.remove('hidden');
            document.getElementById('statsArea').classList.add('hidden');
            document.getElementById('gameSummaryArea').classList.add('hidden');
            gameScore = 0;
            comboCount = 0;
            updateGameScore();
            // Don't start timer immediately - wait for user action
            // Reset timer display
            document.getElementById('gameTimer').textContent = '00:00';
            
            // Initialize game summary
            currentGameSummary = {
                gameNumber: gameNum,
                baseScore: 0,
                bonusScore: 0,
                totalScore: 0,
                timeElapsed: 0,
                maxCombo: 0,
                newBadges: [],
                newRecords: [],
                gameSpecificData: {}
            };
            
            // Hide all game areas
            document.getElementById('game1Area').classList.add('hidden');
            document.getElementById('game2Area').classList.add('hidden');
            document.getElementById('game3Area').classList.add('hidden');
            
            // Show/hide combo display based on game
            const comboDisplay = document.getElementById('comboDisplay');
            if (gameNum === 1 || gameNum === 3) {
                comboDisplay.style.display = 'block';
            } else {
                comboDisplay.style.display = 'none';
            }
            
            switch(gameNum) {
                case 1:
                    document.getElementById('gameTitle').textContent = '🧲 เกมลากไอเทมเข้าตำแหน่ง';
                    document.getElementById('game1Area').classList.remove('hidden');
                    initGame1();
                    break;
                case 2:
                    document.getElementById('gameTitle').textContent = '🌀 เกมเขาวงกตเมาส์';
                    document.getElementById('game2Area').classList.remove('hidden');
                    initGame2();
                    break;
                case 3:
                    document.getElementById('gameTitle').textContent = '⏱️ เกมแข่งความเร็ว';
                    document.getElementById('game3Area').classList.remove('hidden');
                    initGame3();
                    break;
            }
        }
        
        function startGameTimer() {
            gameStartTime = Date.now();
            gameTimer = setInterval(() => {
                gameTimeElapsed = Math.floor((Date.now() - gameStartTime) / 1000);
                const minutes = Math.floor(gameTimeElapsed / 60);
                const seconds = gameTimeElapsed % 60;
                document.getElementById('gameTimer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (gameTimeElapsed > 120) {
                    document.getElementById('gameTimer').classList.add('timer-warning');
                }
            }, 1000);
        }
        
        function stopGameTimer() {
            if (gameTimer) {
                clearInterval(gameTimer);
                gameTimer = null;
            }
            document.getElementById('gameTimer').classList.remove('timer-warning');
        }
        
        function updateCombo() {
            comboCount++;
            document.getElementById('comboCount').textContent = comboCount;
            
            // Track max combo for summary
            if (comboCount > currentGameSummary.maxCombo) {
                currentGameSummary.maxCombo = comboCount;
            }
            
            if (comboCount >= 3) {
                playComboSound();
                const comboDisplay = document.getElementById('comboDisplay');
                comboDisplay.classList.add('combo-effect');
                setTimeout(() => comboDisplay.classList.remove('combo-effect'), 800);
                
                const bonusPoints = comboCount * 2;
                gameScore += bonusPoints;
                currentGameSummary.bonusScore += bonusPoints;
                updateGameScore();
                showScorePopup(`🔥 คอมโบ x${comboCount}! +${bonusPoints} คะแนน!`, 'combo');
            }
            
            if (comboTimer) clearTimeout(comboTimer);
            comboTimer = setTimeout(() => {
                comboCount = 0;
                document.getElementById('comboCount').textContent = comboCount;
            }, 3000);
        }
        
        function resetCombo() {
            comboCount = 0;
            document.getElementById('comboCount').textContent = comboCount;
            if (comboTimer) {
                clearTimeout(comboTimer);
                comboTimer = null;
            }
        }
        
        function saveGameStats(gameNum, score, time, extraData = {}) {
            const gameKey = `game${gameNum}`;
            const stats = gameStats[gameKey];
            
            stats.playCount++;
            stats.totalScore += score;
            
            let finalScore = score;
            let timeBonus = 0;
            
            // Time bonus calculation
            if (gameNum === 1) {
                if (time < 60) {
                    timeBonus = Math.max(0, 60 - time);
                    finalScore += timeBonus;
                    currentGameSummary.bonusScore += timeBonus;
                    showScorePopup(`⏰ โบนัสเวลา +${timeBonus} คะแนน!`, 'combo');
                }
            } else if (gameNum === 2) {
                if (time < 90) {
                    timeBonus = Math.max(0, Math.floor((90 - time) / 2));
                    finalScore += timeBonus;
                    currentGameSummary.bonusScore += timeBonus;
                    showScorePopup(`⏰ โบนัสเวลา +${timeBonus} คะแนน!`, 'combo');
                }
            }
            
            // Update high score
            if (finalScore > stats.highScore) {
                stats.highScore = finalScore;
                stats.bestScoreTime = time;
                stats.bestScoreRound = stats.playCount;
                currentGameSummary.newRecords.push('🏆 คะแนนสูงสุดใหม่!');
                showScorePopup('🏆 สถิติใหม่! คะแนนสูงสุด!', 'record');
            }
            
            // Update best time
            if (gameNum <= 2) {
                if (stats.bestTime === 0 || time < stats.bestTime) {
                    stats.bestTime = time;
                    currentGameSummary.newRecords.push('⚡ เวลาเร็วสุดใหม่!');
                    showScorePopup('⚡ เร็วสุดใหม่!', 'record');
                }
            }
            
            // Game-specific stats
            if (gameNum === 1) {
                stats.totalAttempts += game1Attempts;
                stats.successfulMatches += correctMatches;
                currentGameSummary.gameSpecificData = {
                    attempts: game1Attempts,
                    correctMatches: correctMatches
                };
            } else if (gameNum === 2) {
                stats.totalAttempts += mazeAttempts;
                if (gameWon) stats.completions++;
                currentGameSummary.gameSpecificData = {
                    attempts: mazeAttempts,
                    completed: gameWon
                };
            } else if (gameNum === 3) {
                if (extraData.hits > stats.bestHits) {
                    stats.bestHits = extraData.hits;
                    stats.bestHitsRound = stats.playCount;
                    currentGameSummary.newRecords.push('🎯 คลิกถูกสูงสุดใหม่!');
                }
                stats.totalHits += extraData.hits || 0;
                stats.totalMisses += extraData.misses || 0;
                currentGameSummary.gameSpecificData = {
                    hits: extraData.hits || 0,
                    misses: extraData.misses || 0
                };
            }
            
            gameStats.totalPlayTime += Math.floor(time / 60);
            
            // Update summary data
            currentGameSummary.baseScore = score - currentGameSummary.bonusScore;
            currentGameSummary.totalScore = finalScore;
            currentGameSummary.timeElapsed = time;
            
            gameScore = finalScore;
            updateGameScore();
            
            saveStatsToStorage();
            updateStatsDisplay();
            updateHeaderStats();
            
            // Show summary after a short delay
            setTimeout(() => {
                showGameSummary();
            }, 2000);
        }
        
        function saveStatsToStorage() {
            try {
                localStorage.setItem('computerLearningStats', JSON.stringify(gameStats));
            } catch (e) {
                console.log('Failed to save stats');
            }
        }
        
        function loadStatsFromStorage() {
            try {
                const saved = localStorage.getItem('computerLearningStats');
                if (saved) {
                    const loadedStats = JSON.parse(saved);
                    // Merge with default structure to handle new properties
                    Object.keys(gameStats).forEach(key => {
                        if (loadedStats[key]) {
                            gameStats[key] = { ...gameStats[key], ...loadedStats[key] };
                        }
                    });
                }
            } catch (e) {
                console.log('Failed to load stats');
            }
            updateStatsDisplay();
        }
        
        function updateStatsDisplay() {
            // Game 1 stats
            document.getElementById('game1HighScore').textContent = gameStats.game1.highScore;
            document.getElementById('game1BestRound').textContent = 
                gameStats.game1.bestScoreRound ? `รอบที่ ${gameStats.game1.bestScoreRound}` : '-';
            document.getElementById('game1BestTime').textContent = 
                gameStats.game1.bestTime > 0 ? formatTime(gameStats.game1.bestTime) : '-';
            document.getElementById('game1PlayCount').textContent = gameStats.game1.playCount;
            
            // Game 1 accuracy
            const game1Accuracy = gameStats.game1.totalAttempts > 0 ? 
                Math.round((gameStats.game1.successfulMatches / gameStats.game1.totalAttempts) * 100) : 0;
            document.getElementById('game1Accuracy').style.width = `${game1Accuracy}%`;
            document.getElementById('game1AccuracyText').textContent = `${game1Accuracy}%`;
            
            // Game 2 stats
            document.getElementById('game2HighScore').textContent = gameStats.game2.highScore;
            document.getElementById('game2BestRound').textContent = 
                gameStats.game2.bestScoreRound ? `รอบที่ ${gameStats.game2.bestScoreRound}` : '-';
            document.getElementById('game2BestTime').textContent = 
                gameStats.game2.bestTime > 0 ? formatTime(gameStats.game2.bestTime) : '-';
            document.getElementById('game2PlayCount').textContent = gameStats.game2.playCount;
            
            // Game 2 success rate
            const game2Success = gameStats.game2.totalAttempts > 0 ? 
                Math.round((gameStats.game2.completions / gameStats.game2.totalAttempts) * 100) : 0;
            document.getElementById('game2Success').style.width = `${game2Success}%`;
            document.getElementById('game2SuccessText').textContent = `${game2Success}%`;
            
            // Game 3 stats
            document.getElementById('game3HighScore').textContent = gameStats.game3.highScore;
            document.getElementById('game3BestRound').textContent = 
                gameStats.game3.bestHitsRound ? `รอบที่ ${gameStats.game3.bestHitsRound}` : '-';
            document.getElementById('game3BestHits').textContent = gameStats.game3.bestHits;
            document.getElementById('game3PlayCount').textContent = gameStats.game3.playCount;
            
            // Game 3 accuracy
            const totalClicks = gameStats.game3.totalHits + gameStats.game3.totalMisses;
            const game3Accuracy = totalClicks > 0 ? 
                Math.round((gameStats.game3.totalHits / totalClicks) * 100) : 0;
            document.getElementById('game3Accuracy').style.width = `${game3Accuracy}%`;
            document.getElementById('game3AccuracyText').textContent = `${game3Accuracy}%`;
            
            // Overall stats
            const totalGames = gameStats.game1.playCount + gameStats.game2.playCount + gameStats.game3.playCount;
            const totalScoreAll = gameStats.game1.totalScore + gameStats.game2.totalScore + gameStats.game3.totalScore;
            
            document.getElementById('totalGamesPlayed').textContent = totalGames;
            document.getElementById('totalBadges').textContent = badges.length;
            document.getElementById('totalPlayTime').textContent = gameStats.totalPlayTime;
            document.getElementById('averageScore').textContent = 
                totalGames > 0 ? Math.round(totalScoreAll / totalGames) : 0;
        }
        
        function updateHeaderStats() {
            document.getElementById('headerGame1Best').textContent = gameStats.game1.highScore;
            document.getElementById('headerGame2Best').textContent = gameStats.game2.highScore;
            document.getElementById('headerGame3Best').textContent = gameStats.game3.highScore;
        }
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        function showStats() {
            playClickSound();
            document.getElementById('statsArea').classList.remove('hidden');
            document.getElementById('gameArea').classList.add('hidden');
            updateStatsDisplay();
        }
        
        function hideStats() {
            playClickSound();
            document.getElementById('statsArea').classList.add('hidden');
        }

        function backToMenu() {
            playClickSound();
            document.getElementById('gameArea').classList.add('hidden');
            document.getElementById('gameSummaryArea').classList.add('hidden');
            stopGameTimer();
            if (speedGameActive) {
                stopSpeedGame();
            }
            resetCombo();
            
            // Clean up any remaining targets
            currentTargets.forEach(target => {
                if (target.parentNode) target.remove();
            });
            currentTargets = [];
        }

        function updateTotalScore() {
            totalScore += gameScore;
            document.getElementById('totalScore').textContent = totalScore;
        }

        function updateGameScore() {
            document.getElementById('gameScore').textContent = gameScore;
        }

        function addBadge(badge) {
            if (!badges.includes(badge)) {
                badges.push(badge);
                currentGameSummary.newBadges.push(badge);
                document.getElementById('badges').textContent = badges.join('');
                showScorePopup(`ได้เหรียญ ${badge}!`, 'success');
            }
        }
        
        function showGameSummary() {
            // Hide game area and show summary
            document.getElementById('gameArea').classList.add('hidden');
            document.getElementById('gameSummaryArea').classList.remove('hidden');
            
            // Set game-specific info
            const gameIcons = ['🎮', '🧲', '🌀', '⏱️'];
            const gameTitles = ['', 'เกมลากไอเทม', 'เขาวงกตเมาส์', 'แข่งความเร็ว'];
            
            document.getElementById('summaryGameIcon').textContent = gameIcons[currentGameSummary.gameNumber];
            document.getElementById('summaryGameTitle').textContent = `สรุปผล${gameTitles[currentGameSummary.gameNumber]}`;
            document.getElementById('summaryGameSubtitle').textContent = `รอบที่ ${gameStats[`game${currentGameSummary.gameNumber}`].playCount}`;
            
            // Set scores
            document.getElementById('summaryBaseScore').textContent = currentGameSummary.baseScore;
            document.getElementById('summaryTotalScore').textContent = currentGameSummary.totalScore;
            
            // Show/hide bonus row
            if (currentGameSummary.bonusScore > 0) {
                document.getElementById('summaryBonusRow').style.display = 'flex';
                document.getElementById('summaryBonusScore').textContent = `+${currentGameSummary.bonusScore}`;
            } else {
                document.getElementById('summaryBonusRow').style.display = 'none';
            }
            
            // Show/hide combo row
            if (currentGameSummary.maxCombo > 0) {
                document.getElementById('summaryComboRow').style.display = 'flex';
                document.getElementById('summaryMaxCombo').textContent = `x${currentGameSummary.maxCombo}`;
            } else {
                document.getElementById('summaryComboRow').style.display = 'none';
            }
            
            // Set time
            const minutes = Math.floor(currentGameSummary.timeElapsed / 60);
            const seconds = currentGameSummary.timeElapsed % 60;
            document.getElementById('summaryTime').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Set game-specific data
            const gameData = currentGameSummary.gameSpecificData;
            
            // Reset accuracy row display
            document.getElementById('summaryAccuracyRow').style.display = 'flex';
            
            if (currentGameSummary.gameNumber === 1) {
                // Drag & Drop game
                const accuracy = gameData.attempts > 0 ? Math.round((gameData.correctMatches / gameData.attempts) * 100) : 100;
                document.getElementById('summaryAccuracy').textContent = `${accuracy}%`;
                document.getElementById('summaryAttempts').textContent = gameData.attempts;
                document.getElementById('summarySpecialLabel').textContent = 'จับคู่ถูก:';
                document.getElementById('summarySpecialValue').textContent = `${gameData.correctMatches}/${totalItems}`;
            } else if (currentGameSummary.gameNumber === 2) {
                // Maze game
                document.getElementById('summaryAccuracyRow').style.display = 'none';
                document.getElementById('summaryAttempts').textContent = gameData.attempts;
                document.getElementById('summarySpecialLabel').textContent = 'สถานะ:';
                document.getElementById('summarySpecialValue').textContent = gameData.completed ? 'ผ่านด่าน ✅' : 'ยังไม่ผ่าน ❌';
            } else if (currentGameSummary.gameNumber === 3) {
                // Speed Click game
                const totalClicks = gameData.hits + gameData.misses;
                const accuracy = totalClicks > 0 ? Math.round((gameData.hits / totalClicks) * 100) : 100;
                document.getElementById('summaryAccuracy').textContent = `${accuracy}%`;
                document.getElementById('summaryAttempts').textContent = totalClicks;
                document.getElementById('summarySpecialLabel').textContent = 'คลิกถูก:';
                document.getElementById('summarySpecialValue').textContent = `${gameData.hits}/${totalClicks}`;
            }
            
            // Show achievements if any
            if (currentGameSummary.newBadges.length > 0) {
                document.getElementById('summaryAchievements').style.display = 'block';
                const badgesList = document.getElementById('summaryBadgesList');
                badgesList.innerHTML = '';
                currentGameSummary.newBadges.forEach(badge => {
                    const badgeDiv = document.createElement('div');
                    badgeDiv.className = 'bg-yellow-200 text-yellow-800 px-4 py-2 rounded-full text-2xl font-bold';
                    badgeDiv.textContent = badge;
                    badgesList.appendChild(badgeDiv);
                });
            } else {
                document.getElementById('summaryAchievements').style.display = 'none';
            }
            
            // Show records if any
            if (currentGameSummary.newRecords.length > 0) {
                document.getElementById('summaryRecords').style.display = 'block';
                const recordsList = document.getElementById('summaryRecordsList');
                recordsList.innerHTML = '';
                currentGameSummary.newRecords.forEach(record => {
                    const recordDiv = document.createElement('div');
                    recordDiv.className = 'bg-purple-200 text-purple-800 px-4 py-2 rounded-lg mb-2 font-bold';
                    recordDiv.textContent = record;
                    recordsList.appendChild(recordDiv);
                });
            } else {
                document.getElementById('summaryRecords').style.display = 'none';
            }
        }
        
        function playAgain() {
            playClickSound();
            startGame(currentGameSummary.gameNumber);
        }
        
        function backToMenuFromSummary() {
            playClickSound();
            document.getElementById('gameSummaryArea').classList.add('hidden');
            updateTotalScore();
        }
        
        function showStatsFromSummary() {
            playClickSound();
            document.getElementById('gameSummaryArea').classList.add('hidden');
            showStats();
        }

        function showScorePopup(text, type = 'score') {
            const popup = document.createElement('div');
            let bgColor = 'blue';
            
            switch(type) {
                case 'success': bgColor = 'green'; break;
                case 'combo': bgColor = 'orange'; break;
                case 'record': bgColor = 'purple'; break;
                case 'error': bgColor = 'red'; break;
                default: bgColor = 'blue';
            }
            
            popup.className = `score-popup bg-${bgColor}-500 text-white px-6 py-3 rounded-lg text-xl font-bold shadow-2xl`;
            popup.textContent = text;
            
            // Position popup outside game area for speed game
            if (currentGame === 3 && speedGameActive) {
                popup.style.position = 'fixed';
                popup.style.top = '20%';
                popup.style.left = '50%';
                popup.style.transform = 'translateX(-50%)';
                popup.style.zIndex = '10000';
            }
            
            document.body.appendChild(popup);
            
            if (type === 'record') {
                popup.classList.add('record-badge');
            }
            
            setTimeout(() => {
                if (popup.parentNode) popup.remove();
            }, type === 'record' ? 2500 : 1500);
        }

        // Game 1: Enhanced Drag & Drop
        function initGame1() {
            correctMatches = 0;
            game1Attempts = 0;
            const dragContainer = document.getElementById('dragItems');
            
            dragContainer.innerHTML = '';
            
            updateGame1Progress();
            
            const shuffledItems = [...computerItems].sort(() => Math.random() - 0.5);
            
            // Create draggable items with enhanced styling
            shuffledItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'draggable bg-gradient-to-br from-blue-100 to-blue-200 border-2 border-blue-300 rounded-lg p-3 text-center cursor-grab hover:from-blue-200 hover:to-blue-300 transition-all duration-200 shadow-md';
                div.draggable = true;
                div.dataset.id = item.id;
                div.innerHTML = `
                    <div class="text-3xl mb-1">${item.emoji}</div>
                    <div class="font-semibold text-gray-700 text-xs">${item.name}</div>
                    <div class="text-xs text-gray-500 mt-1">${item.description}</div>
                `;
                
                div.addEventListener('dragstart', handleDragStart);
                div.addEventListener('dragend', handleDragEnd);
                
                dragContainer.appendChild(div);
            });
            
            // Initialize drop zones (they are already in HTML)
            const dropZones = document.querySelectorAll('.drop-zone');
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('drop', handleDrop);
                zone.addEventListener('dragenter', handleDragEnter);
                zone.addEventListener('dragleave', handleDragLeave);
                
                // Reset zone to initial state
                const itemId = zone.dataset.id;
                const item = computerItems.find(i => i.id === itemId);
                if (item) {
                    zone.className = 'drop-zone absolute bg-gray-100 border-2 border-dashed border-gray-400 rounded-lg flex flex-col items-center justify-center text-xs text-gray-500';
                    // Restore original position classes
                    if (itemId === 'monitor') {
                        zone.className += ' top-6 left-1/2 transform -translate-x-1/2 w-32 h-24';
                    } else if (itemId === 'keyboard') {
                        zone.className += ' bottom-16 left-1/2 transform -translate-x-1/2 w-28 h-12';
                    } else if (itemId === 'mouse') {
                        zone.className += ' bottom-16 right-12 w-16 h-12';
                    } else if (itemId === 'speaker') {
                        zone.className += ' top-20 left-6 w-20 h-16';
                    } else if (itemId === 'printer') {
                        zone.className += ' top-20 right-6 w-20 h-20';
                    } else if (itemId === 'webcam') {
                        zone.className += ' top-2 left-1/2 transform -translate-x-1/2 w-16 h-8';
                    }
                    
                    zone.innerHTML = `
                        <div class="text-${itemId === 'webcam' ? 'sm' : 'lg'} opacity-50">${item.emoji}</div>
                        <div class="text-center ${itemId === 'webcam' ? 'text-xs' : ''}">${itemId === 'webcam' ? 'กล้อง' : item.name}</div>
                    `;
                }
            });
        }

        function updateGame1Progress() {
            const progress = (correctMatches / totalItems) * 100;
            document.getElementById('game1Progress').style.width = `${progress}%`;
            document.getElementById('game1ProgressText').textContent = `${correctMatches}/${totalItems} รายการ`;
        }

        function handleDragStart(e) {
            draggedItem = e.target;
            e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDragEnter(e) {
            if (e.target.classList.contains('drop-zone')) {
                e.target.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            if (e.target.classList.contains('drop-zone')) {
                e.target.classList.remove('drag-over');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            e.target.classList.remove('drag-over');
            
            // Start timer on first action
            if (!gameTimer) {
                startGameTimer();
            }
            
            game1Attempts++;
            
            if (draggedItem && e.target.dataset.id === draggedItem.dataset.id) {
                // Correct match
                playSuccessSound();
                updateCombo();
                
                // Get the item info for proper display
                const itemId = e.target.dataset.id;
                const item = computerItems.find(i => i.id === itemId);
                
                // Update the drop zone with the item
                e.target.innerHTML = `
                    <div class="text-${itemId === 'webcam' ? 'sm' : 'lg'}">${item.emoji}</div>
                    <div class="text-center font-bold text-green-700 ${itemId === 'webcam' ? 'text-xs' : 'text-sm'}">${item.name}</div>
                    <div class="text-xs text-green-600 mt-1">✓ ถูกต้อง!</div>
                `;
                
                // Update styling to show success
                const baseClasses = 'drop-zone filled absolute bg-gradient-to-br from-green-100 to-green-200 border-2 border-green-400 rounded-lg flex flex-col items-center justify-center bounce perfect-match';
                
                // Add position-specific classes
                if (itemId === 'monitor') {
                    e.target.className = baseClasses + ' top-6 left-1/2 transform -translate-x-1/2 w-32 h-24 text-xs';
                } else if (itemId === 'keyboard') {
                    e.target.className = baseClasses + ' bottom-16 left-1/2 transform -translate-x-1/2 w-28 h-12 text-xs';
                } else if (itemId === 'mouse') {
                    e.target.className = baseClasses + ' bottom-16 right-12 w-16 h-12 text-xs';
                } else if (itemId === 'speaker') {
                    e.target.className = baseClasses + ' top-20 left-6 w-20 h-16 text-xs';
                } else if (itemId === 'printer') {
                    e.target.className = baseClasses + ' top-20 right-6 w-20 h-20 text-xs';
                } else if (itemId === 'webcam') {
                    e.target.className = baseClasses + ' top-2 left-1/2 transform -translate-x-1/2 w-16 h-8 text-xs';
                }
                
                draggedItem.remove();
                
                correctMatches++;
                gameScore += 15;
                updateGameScore();
                updateGame1Progress();
                showScorePopup('+15 คะแนน!');
                
                setTimeout(() => {
                    e.target.classList.remove('bounce', 'perfect-match');
                }, 1200);
                
                if (correctMatches === totalItems) {
                    stopGameTimer();
                    playPerfectSound();
                    
                    // Show Miki's celebration
                    setTimeout(() => {
                        showScorePopup('น้องมิกิ: "ขอบคุณมากเลย! โต๊ะเรียบร้อยแล้ว!" 👧✨', 'success');
                        updateTotalScore();
                        addBadge('🏆');
                        
                        saveGameStats(1, gameScore, gameTimeElapsed);
                        
                        if (gameTimeElapsed < 30) {
                            addBadge('⚡');
                            showScorePopup('โบนัสความเร็วสุดยอด! ⚡', 'combo');
                        }
                        
                        if (game1Attempts === totalItems) {
                            addBadge('🎯');
                            showScorePopup('ความแม่นยำสมบูรณ์แบบ! 🎯', 'combo');
                        }
                    }, 500);
                }
            } else {
                // Wrong match
                playErrorSound();
                showScorePopup('น้องมิกิ: "อุ๊ปส์! ลองดูตำแหน่งใหม่นะ" 😅', 'error');
                resetCombo();
                
                if (draggedItem) {
                    draggedItem.style.animation = 'bounce 0.6s ease';
                    draggedItem.style.filter = 'hue-rotate(180deg)';
                    setTimeout(() => {
                        draggedItem.style.animation = '';
                        draggedItem.style.filter = '';
                    }, 600);
                }
            }
        }

        function resetGame1() {
            initGame1();
            gameScore = 0;
            updateGameScore();
            resetCombo();
        }

        // Game 2: Enhanced Maze
        let mazeGameStarted = false;
        let lastValidPos = {x: 20, y: 20};
        
        function setMazeDifficulty(difficulty) {
            mazeDifficulty = difficulty;
            
            // Update button styles
            document.getElementById('easyBtn').className = 'interactive-btn bg-gray-300 text-gray-700 px-4 py-2 rounded-lg transition-colors font-bold text-sm';
            document.getElementById('mediumBtn').className = 'interactive-btn bg-gray-300 text-gray-700 px-4 py-2 rounded-lg transition-colors font-bold text-sm';
            document.getElementById('hardBtn').className = 'interactive-btn bg-gray-300 text-gray-700 px-4 py-2 rounded-lg transition-colors font-bold text-sm';
            
            // Highlight selected difficulty
            switch(difficulty) {
                case 'easy':
                    document.getElementById('easyBtn').className = 'interactive-btn bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors font-bold text-sm';
                    document.getElementById('difficultyDescription').textContent = '😊 เขาวงกตขนาดเล็ก ทางเดินกว้าง เหมาะสำหรับผู้เริ่มต้น';
                    mazeSize = { width: 25, height: 15 };
                    break;
                case 'medium':
                    document.getElementById('mediumBtn').className = 'interactive-btn bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition-colors font-bold text-sm';
                    document.getElementById('difficultyDescription').textContent = '😐 เขาวงกตขนาดกลาง ความซับซ้อนปานกลาง';
                    mazeSize = { width: 30, height: 20 };
                    break;
                case 'hard':
                    document.getElementById('hardBtn').className = 'interactive-btn bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors font-bold text-sm';
                    document.getElementById('difficultyDescription').textContent = '😤 เขาวงกตขนาดใหญ่ ทางเดินแคบ ท้าทายสุดๆ!';
                    mazeSize = { width: 35, height: 25 };
                    break;
            }
            
            // Regenerate maze with new difficulty
            initGame2();
            playClickSound();
        }
        
        function initGame2() {
            gameWon = false;
            mazeAttempts = 0;
            mazeGameStarted = false;
            playerPos = {x: 20, y: 20};
            lastValidPos = {x: 20, y: 20};
            
            const container = document.getElementById('mazeContainer');
            container.innerHTML = '';
            
            // Adjust container size based on difficulty
            const cellSize = mazeDifficulty === 'hard' ? 16 : 20;
            const containerWidth = mazeSize.width * cellSize;
            const containerHeight = mazeSize.height * cellSize;
            
            container.style.width = containerWidth + 'px';
            container.style.height = containerHeight + 'px';
            
            // Create realistic maze using recursive backtracking algorithm
            maze = [];
            for (let y = 0; y < mazeSize.height; y++) {
                maze[y] = [];
                for (let x = 0; x < mazeSize.width; x++) {
                    maze[y][x] = 1; // Start with all walls
                }
            }
            
            // Generate maze paths using modified recursive backtracking
            function carvePath(x, y) {
                maze[y][x] = 0; // Mark as path
                
                // Directions: up, right, down, left
                const directions = [
                    [0, -2], [2, 0], [0, 2], [-2, 0]
                ];
                
                // Shuffle directions for randomness
                for (let i = directions.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [directions[i], directions[j]] = [directions[j], directions[i]];
                }
                
                for (const [dx, dy] of directions) {
                    const nx = x + dx;
                    const ny = y + dy;
                    
                    if (nx > 0 && nx < mazeSize.width - 1 && ny > 0 && ny < mazeSize.height - 1 && maze[ny][nx] === 1) {
                        // Carve the wall between current and next cell
                        maze[y + dy/2][x + dx/2] = 0;
                        carvePath(nx, ny);
                    }
                }
            }
            
            // Start carving from position (1,1)
            carvePath(1, 1);
            
            // Ensure borders are walls
            for (let x = 0; x < mazeSize.width; x++) {
                maze[0][x] = 1;
                maze[mazeSize.height - 1][x] = 1;
            }
            for (let y = 0; y < mazeSize.height; y++) {
                maze[y][0] = 1;
                maze[y][mazeSize.width - 1] = 1;
            }
            
            // Ensure start and end positions are clear
            maze[1][1] = 0; // Start position
            maze[mazeSize.height - 2][mazeSize.width - 2] = 0; // End position
            
            // Create additional connections to ensure solvability
            maze[mazeSize.height - 2][mazeSize.width - 3] = 0;
            maze[mazeSize.height - 3][mazeSize.width - 2] = 0;
            
            // Add difficulty-based maze modifications
            if (mazeDifficulty === 'easy') {
                // Add more openings for easy mode
                for (let i = 0; i < 8; i++) {
                    const x = 2 + Math.floor(Math.random() * (mazeSize.width - 4));
                    const y = 2 + Math.floor(Math.random() * (mazeSize.height - 4));
                    if (Math.random() > 0.3) maze[y][x] = 0;
                }
            } else if (mazeDifficulty === 'hard') {
                // Remove some paths for hard mode (but ensure solvability)
                for (let i = 0; i < 5; i++) {
                    const x = 3 + Math.floor(Math.random() * (mazeSize.width - 6));
                    const y = 3 + Math.floor(Math.random() * (mazeSize.height - 6));
                    if (Math.random() > 0.7 && maze[y][x] === 0) {
                        // Only block if it doesn't disconnect the maze
                        maze[y][x] = 1;
                    }
                }
            }
            
            // Draw maze with enhanced graphics
            for (let y = 0; y < mazeSize.height; y++) {
                for (let x = 0; x < mazeSize.width; x++) {
                    const cell = document.createElement('div');
                    cell.className = maze[y][x] ? 'maze-wall' : 'maze-path';
                    cell.style.position = 'absolute';
                    cell.style.left = x * cellSize + 'px';
                    cell.style.top = y * cellSize + 'px';
                    cell.style.width = cellSize + 'px';
                    cell.style.height = cellSize + 'px';
                    container.appendChild(cell);
                }
            }
            
            // Add player with enhanced styling
            const player = document.createElement('div');
            player.className = 'player';
            player.id = 'mazePlayer';
            player.style.left = cellSize + 'px';
            player.style.top = cellSize + 'px';
            player.innerHTML = '🤖';
            player.style.fontSize = (cellSize - 4) + 'px';
            player.style.textAlign = 'center';
            player.style.lineHeight = (cellSize - 2) + 'px';
            player.style.width = (cellSize - 2) + 'px';
            player.style.height = (cellSize - 2) + 'px';
            player.style.cursor = 'pointer';
            player.style.border = '2px solid #3b82f6';
            player.style.borderRadius = '50%';
            player.style.background = 'linear-gradient(45deg, #60a5fa, #3b82f6)';
            player.onclick = startMazeGame;
            container.appendChild(player);
            
            // Update player position variables
            playerPos = {x: cellSize, y: cellSize};
            
            // Add goal with enhanced styling
            const goal = document.createElement('div');
            goal.className = 'maze-goal';
            goal.style.position = 'absolute';
            goal.style.left = (mazeSize.width - 2) * cellSize + 'px';
            goal.style.top = (mazeSize.height - 2) * cellSize + 'px';
            goal.style.width = cellSize + 'px';
            goal.style.height = cellSize + 'px';
            goal.innerHTML = '🚩';
            goal.style.fontSize = (cellSize - 4) + 'px';
            goal.style.textAlign = 'center';
            goal.style.lineHeight = cellSize + 'px';
            goal.style.borderRadius = '50%';
            container.appendChild(goal);
            
            // Add instruction overlay
            const instruction = document.createElement('div');
            instruction.id = 'mazeInstruction';
            instruction.className = 'bg-blue-500 text-white px-4 py-2 rounded-lg text-sm font-bold';
            instruction.innerHTML = '👆 คลิกที่หุ่นยนต์ 🤖 เพื่อเริ่มเกม แล้วเลื่อนเมาส์เพื่อควบคุม';
            instruction.style.position = 'absolute';
            instruction.style.left = '50%';
            instruction.style.top = '50%';
            instruction.style.transform = 'translate(-50%, -50%)';
            instruction.style.zIndex = '50';
            instruction.style.textAlign = 'center';
            instruction.style.maxWidth = '300px';
            instruction.style.pointerEvents = 'none';
            container.appendChild(instruction);
        }
        
        function startMazeGame() {
            mazeGameStarted = true;
            
            // Start timer when maze game begins
            if (!gameTimer) {
                startGameTimer();
            }
            
            const container = document.getElementById('mazeContainer');
            const instruction = document.getElementById('mazeInstruction');
            const player = document.getElementById('mazePlayer');
            
            if (instruction) instruction.remove();
            
            // Remove click handler from player and add visual feedback
            if (player) {
                player.onclick = null;
                player.style.cursor = 'default';
                player.style.boxShadow = '0 0 15px rgba(59, 130, 246, 0.8)';
                player.style.animation = 'glowPulse 2s ease infinite';
            }
            
            container.addEventListener('mousemove', handleMazeMouseMove);
            container.addEventListener('mouseleave', handleMazeMouseLeave);
            
            // Play start sound
            playStartSound();
            
            // Show brief popup that disappears quickly
            const popup = document.createElement('div');
            popup.className = 'bg-green-500 text-white px-4 py-2 rounded-lg text-sm font-bold';
            popup.innerHTML = '🚀 เริ่มเกมแล้ว! เลื่อนเมาส์เพื่อควบคุมหุ่นยนต์';
            popup.style.position = 'absolute';
            popup.style.left = '50%';
            popup.style.top = '20%';
            popup.style.transform = 'translateX(-50%)';
            popup.style.zIndex = '200';
            popup.style.textAlign = 'center';
            popup.style.maxWidth = '300px';
            popup.style.animation = 'fadeInOut 2s ease forwards';
            popup.style.pointerEvents = 'none';
            container.appendChild(popup);
            
            // Remove popup after 2 seconds
            setTimeout(() => {
                if (popup.parentNode) popup.remove();
            }, 2000);
        }

        function handleMazeMouseMove(e) {
            if (gameWon || !mazeGameStarted) return;
            
            const rect = e.currentTarget.getBoundingClientRect();
            const cellSize = mazeDifficulty === 'hard' ? 16 : 20;
            const newX = Math.floor((e.clientX - rect.left) / cellSize) * cellSize;
            const newY = Math.floor((e.clientY - rect.top) / cellSize) * cellSize;
            
            const containerWidth = mazeSize.width * cellSize;
            const containerHeight = mazeSize.height * cellSize;
            
            if (newX < 0 || newX >= containerWidth || newY < 0 || newY >= containerHeight) return;
            
            const gridX = Math.floor(newX / cellSize);
            const gridY = Math.floor(newY / cellSize);
            
            if (maze[gridY] && maze[gridY][gridX] === 0) {
                // Valid move
                const oldX = playerPos.x;
                const oldY = playerPos.y;
                
                playerPos.x = newX;
                playerPos.y = newY;
                
                const player = document.getElementById('mazePlayer');
                player.style.left = playerPos.x + 'px';
                player.style.top = playerPos.y + 'px';
                
                // Count attempts (significant moves)
                const distance = Math.abs(newX - oldX) + Math.abs(newY - oldY);
                if (distance >= cellSize) {
                    mazeAttempts++;
                }
                
                // Check if reached goal
                const goalX = (mazeSize.width - 2) * cellSize;
                const goalY = (mazeSize.height - 2) * cellSize;
                
                if (newX >= goalX && newY >= goalY) {
                    gameWon = true;
                    stopGameTimer();
                    playPerfectSound();
                    
                    // Base score varies by difficulty
                    let baseScore = 100;
                    if (mazeDifficulty === 'easy') baseScore = 75;
                    else if (mazeDifficulty === 'hard') baseScore = 150;
                    
                    gameScore += baseScore;
                    
                    // Efficiency bonus based on difficulty
                    let maxAttempts = 50;
                    if (mazeDifficulty === 'easy') maxAttempts = 30;
                    else if (mazeDifficulty === 'hard') maxAttempts = 80;
                    
                    if (mazeAttempts < maxAttempts) {
                        const efficiencyBonus = Math.max(0, maxAttempts - mazeAttempts);
                        gameScore += efficiencyBonus;
                        showScorePopup(`🎯 โบนัสเส้นทางสั้น! +${efficiencyBonus} คะแนน!`, 'combo');
                    }
                    
                    updateGameScore();
                    showScorePopup('ยอดเยี่ยม! หาทางออกได้! 🎉', 'success');
                    updateTotalScore();
                    addBadge('🌟');
                    
                    saveGameStats(2, gameScore, gameTimeElapsed);
                    
                    // Difficulty-based achievements
                    if (mazeDifficulty === 'easy' && gameTimeElapsed < 20) {
                        addBadge('🚀');
                        showScorePopup('นักสำรวจเร็วจี๋! 🚀', 'combo');
                    } else if (mazeDifficulty === 'medium' && gameTimeElapsed < 40) {
                        addBadge('🚀');
                        showScorePopup('นักสำรวจเร็วจี๋! 🚀', 'combo');
                    } else if (mazeDifficulty === 'hard' && gameTimeElapsed < 60) {
                        addBadge('🚀');
                        showScorePopup('นักสำรวจเร็วจี๋! 🚀', 'combo');
                    }
                    
                    if (mazeAttempts < maxAttempts * 0.6) {
                        addBadge('🧭');
                        showScorePopup('นักนำทางมืออาชีพ! 🧭', 'combo');
                    }
                    
                    // Special achievement for hard mode
                    if (mazeDifficulty === 'hard') {
                        addBadge('💎');
                        showScorePopup('เซียนเขาวงกต! 💎', 'combo');
                    }
                }
            } else {
                // Hit wall - restart the game automatically
                playErrorSound();
                showScorePopup('ชนกำแพง! เริ่มเกมใหม่', 'error');
                
                // Visual feedback for hitting wall
                const player = document.getElementById('mazePlayer');
                player.style.filter = 'hue-rotate(180deg)';
                player.style.transform = 'scale(0.8)';
                
                setTimeout(() => {
                    // Reset game automatically using resetGame2()
                    resetGame2();
                }, 800);
            }
        }

        function handleMazeMouseLeave(e) {
            // Optional: pause or provide feedback when mouse leaves maze area
        }

        function resetGame2() {
            initGame2();
            gameScore = 0;
            updateGameScore();
            mazeGameStarted = false;
        }

        // Game 3: Enhanced Speed Click
        function initGame3() {
            hits = 0;
            misses = 0;
            timeLeft = 30;
            speedGameActive = false;
            currentTargets = [];
            
            document.getElementById('hits').textContent = hits;
            document.getElementById('misses').textContent = misses;
            document.getElementById('timeLeft').textContent = timeLeft;
            document.getElementById('accuracy').textContent = '100%';
            document.getElementById('startSpeedGame').style.display = 'block';
            
            const gameArea = document.getElementById('clickGameArea');
            gameArea.innerHTML = '';
            gameArea.addEventListener('click', handleMissClick);
        }

        function startSpeedGame() {
            speedGameActive = true;
            document.getElementById('startSpeedGame').style.display = 'none';
            resetCombo();
            
            // Start timer when speed game begins
            if (!gameTimer) {
                startGameTimer();
            }
            
            speedGameTimer = setInterval(() => {
                timeLeft--;
                document.getElementById('timeLeft').textContent = timeLeft;
                
                if (timeLeft <= 5) {
                    document.getElementById('timeLeft').classList.add('timer-warning');
                }
                
                if (timeLeft <= 0) {
                    stopSpeedGame();
                }
            }, 1000);
            
            spawnTarget();
        }

        function stopSpeedGame() {
            speedGameActive = false;
            stopGameTimer();
            clearInterval(speedGameTimer);
            clearTimeout(targetTimer);
            document.getElementById('timeLeft').classList.remove('timer-warning');
            
            // Clean up targets
            currentTargets.forEach(target => {
                if (target.parentNode) target.remove();
            });
            currentTargets = [];
            
            const gameArea = document.getElementById('clickGameArea');
            gameArea.innerHTML = '';
            
            // Calculate final score
            const baseScore = hits * 5 - misses * 2;
            const comboBonus = comboCount * 3;
            const finalScore = Math.max(0, baseScore + comboBonus);
            gameScore = finalScore;
            updateGameScore();
            updateTotalScore();
            
            // Save stats
            saveGameStats(3, gameScore, 30, { hits: hits, misses: misses });
            
            let message = `เกมจบ! คลิกถูก: ${hits} คลิกพลาด: ${misses}`;
            
            if (hits >= 30) {
                playPerfectSound();
                addBadge('🥇');
                message += ' ได้เหรียญทอง!';
            } else if (hits >= 25) {
                playSuccessSound();
                addBadge('🥈');
                message += ' ได้เหรียญเงิน!';
            } else if (hits >= 20) {
                playSuccessSound();
                addBadge('🥉');
                message += ' ได้เหรียญทองแดง!';
            }
            
            // Accuracy bonus
            const totalClicks = hits + misses;
            const accuracy = totalClicks > 0 ? (hits / totalClicks) * 100 : 0;
            if (accuracy >= 95) {
                addBadge('🎯');
                showScorePopup('แม่นยำสุดยอด! 🎯', 'combo');
            }
            
            // Perfect game bonus
            if (misses === 0 && hits > 0) {
                addBadge('💎');
                showScorePopup('เกมสมบูรณ์แบบ! 💎', 'combo');
            }
            
            showScorePopup(message, 'success');
            document.getElementById('startSpeedGame').style.display = 'block';
        }

        function spawnTarget() {
            if (!speedGameActive) return;
            
            const gameArea = document.getElementById('clickGameArea');
            const target = document.createElement('div');
            target.className = 'target';
            
            // Random position with padding
            const maxX = 550; // 600 - 50 for padding
            const maxY = 350; // 400 - 50 for padding
            const x = 25 + Math.random() * maxX;
            const y = 25 + Math.random() * maxY;
            
            target.style.left = x + 'px';
            target.style.top = y + 'px';
            
            // Random target types for variety
            const targetTypes = ['⭐', '💫', '✨', '🌟', '💥'];
            target.innerHTML = targetTypes[Math.floor(Math.random() * targetTypes.length)];
            
            target.addEventListener('click', handleTargetClick);
            gameArea.appendChild(target);
            currentTargets.push(target);
            
            // Remove target after 1.5-2.5 seconds
            const lifetime = 1500 + Math.random() * 1000;
            setTimeout(() => {
                if (target.parentNode) {
                    target.remove();
                    const index = currentTargets.indexOf(target);
                    if (index > -1) currentTargets.splice(index, 1);
                }
            }, lifetime);
            
            // Spawn next target
            const spawnDelay = 600 + Math.random() * 800;
            targetTimer = setTimeout(spawnTarget, spawnDelay);
        }

        function handleTargetClick(e) {
            e.stopPropagation();
            hits++;
            document.getElementById('hits').textContent = hits;
            
            playSuccessSound();
            updateCombo();
            
            // Create hit effect
            const hitEffect = document.createElement('div');
            hitEffect.className = 'hit-effect';
            hitEffect.textContent = '+5';
            hitEffect.style.left = e.target.style.left;
            hitEffect.style.top = e.target.style.top;
            document.getElementById('clickGameArea').appendChild(hitEffect);
            
            setTimeout(() => {
                if (hitEffect.parentNode) hitEffect.remove();
            }, 1000);
            
            // Visual feedback
            e.target.style.background = 'linear-gradient(45deg, #48bb78, #68d391)';
            e.target.innerHTML = '💥';
            e.target.style.transform = 'scale(1.5)';
            
            setTimeout(() => {
                if (e.target.parentNode) {
                    e.target.remove();
                    const index = currentTargets.indexOf(e.target);
                    if (index > -1) currentTargets.splice(index, 1);
                }
            }, 200);
            
            updateAccuracy();
            showScorePopup('+5 คะแนน!');
        }

        function handleMissClick(e) {
            if (e.target.classList.contains('target')) return;
            
            if (speedGameActive) {
                misses++;
                document.getElementById('misses').textContent = misses;
                
                playErrorSound();
                resetCombo();
                
                // Create miss effect
                const rect = document.getElementById('clickGameArea').getBoundingClientRect();
                const missEffect = document.createElement('div');
                missEffect.className = 'miss-effect';
                missEffect.style.left = (e.clientX - rect.left - 30) + 'px';
                missEffect.style.top = (e.clientY - rect.top - 30) + 'px';
                document.getElementById('clickGameArea').appendChild(missEffect);
                
                setTimeout(() => {
                    if (missEffect.parentNode) missEffect.remove();
                }, 500);
                
                updateAccuracy();
                showScorePopup('-2 คะแนน!', 'error');
            }
        }

        function updateAccuracy() {
            const totalClicks = hits + misses;
            const accuracy = totalClicks > 0 ? Math.round((hits / totalClicks) * 100) : 100;
            document.getElementById('accuracy').textContent = `${accuracy}%`;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateGameScore();
            loadStatsFromStorage();
            updateHeaderStats();
            
            // Set default difficulty to medium when page loads
            if (typeof setMazeDifficulty === 'function') {
                setMazeDifficulty('medium');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97693cc47410731c',t:'MTc1NjQ0MTAzMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
