<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- (v9) Generic Title -->
    <title>The Lucky Claw - ‡∏ï‡∏π‡πâ‡∏Ñ‡∏µ‡∏ö‡∏™‡∏∏‡πà‡∏°‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</title>
    <!-- ‡πÇ‡∏´‡∏•‡∏î Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ‡πÇ‡∏´‡∏•‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå (v3) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- (FIX) ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ Confetti ‡πÄ‡∏õ‡πá‡∏ô canvas-confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    
    <style>
        /* (v3/v9) ‡πÉ‡∏ä‡πâ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å */
        body {
            font-family: 'Sarabun', 'Inter', sans-serif;
            /* (v9) Darker Arcade Vibe Background */
            background-color: #111;
            background-image: linear-gradient(to bottom, #1a1a2e, #111), 
                              radial-gradient(circle, #333 1px, transparent 1px);
            background-size: 100% 100%, 15px 15px;
            overflow: hidden;
            user-select: none;
        }

        h1, h2, h3, .font-game {
            font-family: 'Bungee', cursive;
        }

        /* (v6) FSM State Management */
        .screen {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            visibility: hidden;
        }
        
        .screen.active {
            display: flex;
            opacity: 1;
            visibility: visible;
        }
        
        /* (v9) Arcade Setup Screen */
        #setup-screen {
            background: #111;
            border: 4px solid #ff00de;
            box-shadow: 0 0 20px #ff00de, inset 0 0 15px #ff00de;
            color: #eee;
            text-shadow: 0 0 5px #ff00de;
        }
        #setup-screen label, #setup-screen p {
            color: #eee;
            text-shadow: none;
        }
        #setup-screen textarea {
            background: #222;
            color: #0f0; /* Green terminal text */
            border-color: #555;
            font-family: monospace;
        }
        #setup-screen #start-game-btn {
            background-color: #f9a602;
            color: #333;
            text-shadow: none;
        }
         #setup-screen #start-game-btn:disabled {
            background-color: #555;
            opacity: 0.7;
        }

        /* (v3) Arcade Machine Styling */
        #game-machine {
            width: 90vw;
            max-width: 500px;
            height: 70vh;
            max-height: 600px;
            background: linear-gradient(to bottom, #87CEEB 20%, #f0f8ff 20%);
            border: 10px solid #333;
            border-bottom-width: 20px;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2), inset 0 0 20px rgba(0,0,0,0.1), 0 0 40px rgba(255, 0, 150, 0.3);
        }

        /* (v3) Flashing Lights */
        #machine-title {
            animation: flashingLights 2s infinite;
        }
        @keyframes flashingLights {
            0%, 100% { text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px #ff00de, 0 0 20px #ff00de; }
            50% { text-shadow: none; }
        }

        /* (v3/v4) Ball Jiggle */
        #pit {
            position: absolute; bottom: 0; left: 0; right: 0;
            height: 30%; background: rgba(0,0,0,0.05); padding: 1rem;
            display: flex; flex-wrap: wrap; justify-content: center; align-items: center;
            gap: 8px; transition: all 0.3s ease;
        }
        .ball {
            border-radius: 50%;
            flex-shrink: 0; box-shadow: inset -2px -2px 5px rgba(0,0,0,0.2);
            /* (v3) Jiggle animation */
            animation: jiggle 3s infinite ease-in-out;
            animation-delay: var(--delay, 0s);
            /* (v9) Transition for grab */
            transition: all 0.3s ease, transform 0.1s ease;
            position: relative;
        }
        
        /* (v17) FIX: Added translateX(-50%) to all steps to keep alignment */
        @keyframes jiggle {
            0%, 100% { transform: translateX(-50%) translate(0, 0) rotate(0deg); }
            25% { transform: translateX(-50%) translate(1px, -1px) rotate(2deg); }
            50% { transform: translateX(-50%) translate(-1px, 1px) rotate(-1deg); }
            75% { transform: translateX(-50%) translate(0, 1px) rotate(0deg); }
        }

        /* (v4/v6) Claw Animation States */
        #claw-rig {
            position: absolute; top: 0; left: 50%; width: 100px; height: 100%;
            transform: translateX(-50%); transition: left 0.1s linear;
            /* (v9) To hold the grabbed ball */
            z-index: 10;
        }
        #claw-arm {
            position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            width: 8px; height: 40px; background: #aaa; border: 2px solid #555;
            transition: height 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); /* (v4) Fast drop */
        }
        #claw {
            position: absolute;
            /* (v15) FIX: Changed from fixed 'top: 40px' to relative 'top: 100%' */
            top: 100%; /* Position at the bottom of the parent arm */
            left: 50%; width: 40px; height: 20px;
            transform: translateX(-50%); transition: all 0.3s ease;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23444'%3E%3Cpath d='M10.748 11.396a1 1 0 0 1-1.496-1.318l3-3.428a1 1 0 0 1 1.496 1.318l-3 3.428ZM14.748 9.968a1 1 0 0 1-1.318 1.496l-3-2.625a1 1 0 1 1 1.318-1.496l3 2.625Z'/%3E%3Cpath d='M4.43 14.71a1 1 0 0 1 0-1.414l5-5a1 1 0 0 1 1.414 0l1.793 1.793a.5.5 0 0 0 .707 0l2.5-2.5a.5.5 0 0 0 0-.707l-2.5-2.5a.5.5 0 0 0-.707 0L11.22 5.793a1 1 0 0 1-1.414 0l-5-5a1 1 0 0 1 0-1.414l.177-.177a1 1 0 0 1 1.414 0L10 2.828l2.828-2.828a1 1 0 0 1 1.414 0l2.5 2.5a1 1 0 0 1 0 1.414l-2.5 2.5a1 1 0 0 1-1.414 0L10 3.828 6.465 7.364a.5.5 0 0 0 0 .707l3.757 3.757a1 1 0 0 1 0 1.414l-5.613 5.613a1 1 0 0 1-1.414 0l-3.3-3.3a1 1 0 0 1 0-1.414l4.134-4.133ZM19.57 14.71a1 1 0 0 0 0-1.414l-5-5a1 1 0 0 0-1.414 0l-1.793 1.793a.5.5 0 0 1-.707 0l-2.5-2.5a.5.5 0 0 1 0-.707l2.5-2.5a.5.5 0 0 1 .707 0l1.414 1.414a1 1 0 0 0 1.414 0l5-5a1 1 0 0 0 0-1.414l-.177-.177a1 1 0 0 0-1.414 0L16 2.828l-2.828-2.828a1 1 0 0 0-1.414 0l-2.5 2.5a1 1 0 0 0 0 1.414l2.5 2.5a1 1 0 0 0 1.414 0L16 3.828l3.535 3.536a.5.5 0 0 1 0 .707l-3.757 3.757a1 1 0 0 0 0 1.414l5.613 5.613a1 1 0 0 0 1.414 0l3.3-3.3a1 1 0 0 0 0-1.414l-4.134-4.133Z'/%3E%3C/svg%3E");
            background-size: 80%; background-repeat: no-repeat; background-position: center;
            /* (v9) To hold the ball */
            position: relative;
        }

        /* (v4) Claw States */
        #claw-rig.is-dropping #claw-arm { height: 260px; }
        #claw-rig.is-squeezing #claw { transform: translateX(-50%) scale(0.7); }
        #claw-rig.is-lifting #claw-arm { height: 40px; }
        /* (v4/v17) Jiggle of Fate */
        #claw-rig.is-lifting #claw { animation: jiggle 0.5s infinite; }
        #claw-rig.is-failing #claw { transform: translateX(-50%) scale(1); } /* (v4) Performative Fail */
        #claw-rig.is-moving-chute { left: 10%; transition: left 1s ease-in-out; }
        
        /* (v9) Styling for the grabbed ball */
        #claw .ball {
            position: absolute;
            top: 5px; /* Tucked under the claw */
            left: 50%;
            transform: translateX(-50%);
            z-index: -1;
            margin: 0;
        }
        
        /* (v9) Chute styling */
        #chute {
             position: absolute; bottom: 0; left: 0; w-1/4; h-1/3;
             background: #333; border-r-4 border-t-4 border-gray-500 rounded-tr-lg;
             z-index: 5;
        }
        #chute-hole {
            width: 80%; height: 80%; margin: 10%;
            background: #111; border-radius: 5px;
            overflow: hidden; position: relative;
        }
        /* (v9) Ball falling into chute */
        #chute-hole .ball {
            position: absolute;
            left: 50%;
            top: 0;
            transform: translateX(-50%);
            animation: fallInChute 0.5s linear forwards;
        }
        @keyframes fallInChute {
            from { top: 0; }
            to { top: 100%; }
        }


        /* (v4) Screen Shake */
        .screen-shake {
            animation: screenShake 0.3s 1 linear;
        }
        @keyframes screenShake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-3px, 0, 0); }
            40%, 60% { transform: translate3d(3px, 0, 0); }
        }

        /* (v3) Arcade Button */
        .arcade-button {
            background: #d90429; color: white;
            border-radius: 50%;
            width: 100px; height: 100px;
            font-family: 'Bungee', cursive;
            border: 4px solid #fff;
            border-bottom: 10px solid #a3001c;
            box-shadow: 0 5px 10px rgba(0,0,0,0.2), inset 0 -5px 0 #a3001c;
            transition: all 0.1s ease-out;
        }
        /* (v4) Button Press */
        .arcade-button:active, .arcade-button.is-pressing {
            transform: scale(0.95) translateY(5px);
            border-bottom-width: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2), inset 0 -2px 0 #a3001c;
        }

        /* (v3) D-Pad Controls */
        .d-pad-button {
            background: #444; color: white;
            width: 70px; height: 70px;
            border-radius: 50%;
            border: 2px solid #666;
            border-bottom: 6px solid #222;
            transition: all 0.1s ease-out;
        }
        .d-pad-button:active, .d-pad-button.is-pressing {
            transform: scale(0.95) translateY(3px);
            border-bottom-width: 2px;
        }
        .d-pad-button:disabled {
            opacity: 0.5; cursor: not-allowed;
            transform: none; border-bottom-width: 6px;
        }
        
        /* (v11) Shuffle Button Style */
        .aux-button {
            background: #3b82f6; /* Blue */
            color: white;
            width: 60px; height: 60px;
            border-radius: 50%;
            border: 2px solid #60a5fa;
            border-bottom: 6px solid #1e3a8a;
            transition: all 0.1s ease-out;
            padding: 10px; /* For SVG icon */
        }
        .aux-button:active, .aux-button.is-pressing {
            transform: scale(0.95) translateY(3px);
            border-bottom-width: 2px;
        }
        .aux-button:disabled {
            opacity: 0.5; cursor: not-allowed;
            transform: none; border-bottom-width: 6px;
        }

        .arcade-button:disabled {
            opacity: 0.5; cursor: not-allowed;
            transform: none; border-bottom-width: 10px;
        }

        /* (v11) Pit Shake Animation */
        @keyframes pitShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
        }
        #pit.is-shaking {
            animation: pitShake 0.3s cubic-bezier(.36,.07,.19,.97) both;
        }

        /* (v3) Winner Ticket Modal */
        #result-card {
            background-color: #fffbe8;
            border: 2px dashed #e6c800;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transform: scale(0);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        #result-card.show {
            transform: scale(1);
        }

        /* (v8) How-to-Play & Settings Modals */
        .modal {
            display: none;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .modal.active {
            display: flex;
            opacity: 1;
            visibility: visible;
        }
        
        /* (v7) Toggle Switch */
        .toggle-bg:after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.2s;
        }
        input:checked + .toggle-bg:after {
            transform: translateX(20px);
        }
        input:checked + .toggle-bg {
            background-color: #22c55e;
        }
        
        /* (FIX) ‡∏•‡∏ö #confetti-canvas CSS ‡∏≠‡∏≠‡∏Å */
        
        /* (v21) New UX Styles */
        #game-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Bungee', cursive;
            font-size: 2.5rem;
            z-index: 20;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            pointer-events: none; /* Allows clicks through */
        }
        #game-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        #preview-tooltip {
            position: absolute;
            bottom: 32%; /* Just above the pit */
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 4px 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            z-index: 15;
            display: none;
            opacity: 0;
            transition: opacity 0.2s;
            white-space: nowrap;
            max-width: 90%;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        #preview-tooltip.show {
            display: block;
            opacity: 1;
        }
        
    </style>
</head>
<body class="flex items-center justify-center h-screen w-screen flex-col font-sans text-gray-800">

    <!-- (v19) New UI Buttons -->
    <div class="fixed top-4 left-4 z-50 flex gap-2">
        <button id="history-btn" class="text-white p-2 rounded-full hover:bg-white/20 transition disabled:opacity-25" title="‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•" disabled
                aria-label="‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•" data-i18n-key="aria.history">
            <!-- History Icon (clipboard-check) -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                <path d="m9 14 2 2 4-4"></path>
            </svg>
        </button>
        <button id="remaining-btn" class="text-white p-2 rounded-full hover:bg-white/20 transition disabled:opacity-25" title="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠" disabled
                aria-label="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠" data-i18n-key="aria.remaining">
            <!-- Remaining Icon (list) -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="8" y1="6" x2="21" y2="6"></line>
                <line x1="8" y1="12" x2="21" y2="12"></line>
                <line x1="8" y1="18" x2="21" y2="18"></line>
                <line x1="3" y1="6" x2="3.01" y2="6"></line>
                <line x1="3" y1="12" x2="3.01" y2="12"></line>
                <line x1="3" y1="18" x2="3.01" y2="18"></line>
            </svg>
        </button>
    </div>

    <!-- (v13) Mute Button -->
    <button id="mute-btn" class="fixed top-4 right-16 z-50 text-white p-2 rounded-full hover:bg-white/20 transition" 
            aria-label="‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á" data-i18n-key="aria.toggleMute">
        <!-- Unmuted Icon -->
        <svg id="icon-unmuted" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
        <!-- Muted Icon (hidden by default) -->
        <svg id="icon-muted" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>
    </button>
    <!-- (v7/v8) Settings Button -->
    <button id="settings-btn" class="fixed top-4 right-4 z-50 text-white p-2 rounded-full hover:bg-white/20 transition"
            aria-label="‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤" data-i18n-key="aria.settings">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
    </button>

    <!-- ===== ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ó‡∏µ‡πà 1: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (STATE_SETUP) ===== -->
    <div id="setup-screen" class="screen active flex-col items-center justify-center p-8 rounded-lg shadow-xl text-center">
        <!-- (v9/v20) Generic Microcopy -->
        <h1 class="text-3xl font-bold text-yellow-400 mb-2 font-game" data-i18n-key="title.main">The Lucky Claw!</h1>
        <p class="text-gray-300 mb-6" data-i18n-key="subtitle.main">‡∏ï‡∏π‡πâ‡∏Ñ‡∏µ‡∏ö‡∏™‡∏∏‡πà‡∏°‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</p>
        
        <label for="name-input" class="text-lg font-semibold mb-2 text-green-400" data-i18n-key="label.input">‡∏Å‡∏£‡∏≠‡∏Å '‡∏Ç‡∏≠‡∏á' ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡πà‡∏°:</label>
        
        <textarea id="name-input" rows="8" class="w-80 p-3 border-2 rounded-lg transition" data-i18n-key="placeholder.input" placeholder="‡πÄ‡∏ä‡πà‡∏ô:&#10;‡∏™‡∏µ‡πÅ‡∏î‡∏á&#10;‡πÑ‡∏≠‡πÄ‡∏ó‡∏° A&#10;‡∏ú‡∏π‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ 1&#10;‡πÑ‡∏õ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ó‡∏∞‡πÄ‡∏•..."></textarea>
        <!-- (v9/v20) Generic Microcopy -->
        <p id="name-counter" class="text-sm text-gray-400 mt-2 h-5" data-i18n-key="counter.items" data-count="0">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏∏‡πà‡∏°!</p>
        
        <p id="setup-error" class="text-red-500 text-sm mt-2 mb-4 h-5"></p>
        
        <!-- (v7) Loading State -->
        <p id="loading-text" class="text-blue-500 font-semibold my-4" data-i18n-key="status.loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏π‡πâ‡πÄ‡∏Å‡∏°...</p>
        
        <button id="start-game-btn" disabled class="w-80 font-game text-xl hover:bg-yellow-500 font-bold py-3 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105 mt-4 disabled:opacity-50 disabled:cursor-not-allowed">
            <!-- (v8/v9/v20) Microcopy -->
            <span data-i18n-key="button.startGame">ü™ô ‡∏´‡∏¢‡∏≠‡∏î‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç!</span>
        </button>
    </div>

    <!-- ===== ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ó‡∏µ‡πà 2: ‡πÄ‡∏Å‡∏° (STATE_IDLE, MOVING, GRABBING, DROPPING) ===== -->
    <div id="game-screen" class="screen flex-col items-center justify-center">
        <!-- ‡∏ï‡∏π‡πâ‡πÄ‡∏Å‡∏° -->
        <div id="game-machine">
            <!-- (v3) Title -->
            <h2 id="machine-title" class="font-game text-3xl text-center text-white py-1" style="text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px #ff00de;">
                LUCKY CLAW
            </h2>
            
            <!-- ‡∏ï‡∏±‡∏ß‡∏Ñ‡∏µ‡∏ö -->
            <div id="claw-rig" style="left: 50%;">
                <div id="claw-arm">
                    <!-- (v15) FIX: Moved claw inside arm for relative positioning -->
                    <div id="claw">
                        <!-- (v9) ‡∏•‡∏π‡∏Å‡∏ö‡∏≠‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏µ‡∏ö‡∏à‡∏∞‡∏°‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
                    </div>
                </div>
            </div>

            <!-- ‡∏ö‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏ö‡∏≠‡∏• -->
            <div id="pit">
                <!-- ‡∏•‡∏π‡∏Å‡∏ö‡∏≠‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢ JavaScript -->
            </div>

            <!-- (v9) ‡∏ä‡πà‡∏≠‡∏á‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏Ç‡∏≠‡∏á (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï) -->
            <div id="chute">
                <div id="chute-hole">
                    <!-- (v9) ‡∏•‡∏π‡∏Å‡∏ö‡∏≠‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏µ‡∏ö‡πÑ‡∏î‡πâ‡∏à‡∏∞‡∏ï‡∏Å‡∏•‡∏á‡∏°‡∏≤‡πÉ‡∏ô‡∏ô‡∏µ‡πâ -->
                </div>
            </div>
            
            <!-- (v21) New UX Elements -->
            <div id="preview-tooltip"></div>
            <div id="game-overlay" data-i18n-key="status.working">WORKING...</div>
        </div>

        <!-- ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° (v3/v4/v11) -->
        <div id="controls" class="mt-8 flex gap-4 items-center">
            <button id="control-left-btn" class="d-pad-button flex items-center justify-center text-2xl font-bold" 
                    aria-label="‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ã‡πâ‡∏≤‡∏¢" data-i18n-key="aria.moveLeft">
                &larr;
            </button>
            
            <!-- (v11) Shuffle Button -->
            <button id="control-shuffle-btn" class="aux-button flex items-center justify-center" title="‡∏Å‡∏ß‡∏ô‡∏•‡∏π‡∏Å‡∏ö‡∏≠‡∏•"
                    aria-label="‡∏Å‡∏ß‡∏ô‡∏•‡∏π‡∏Å‡∏ö‡∏≠‡∏•" data-i18n-key="aria.shuffle">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M10.5 1C7.73 1 5.31 2.36 3.8 4.38L.79 1.38L0 2.17l4.17 4.17l.7-.7l-2.7-2.7C3.51 1.63 6.69 0 10.5 0C16.02 0 20.5 4.48 20.5 10c0 2.34-.8 4.49-2.17 6.19l.71.71C20.21 15.25 21.5 12.81 21.5 10C21.5 4.98 16.52 1 10.5 1zM10.5 19c-2.34 0-4.49-.8-6.19-2.17l-.71.71C5.25 18.79 7.69 20 10.5 20c5.02 0 9-4.98 9-10c0-1.2-.24-2.35-.67-3.4l-.78.78C18.37 9.19 18.5 10 18.5 10c0 4.41-3.59 8-8 8z"/>
                </svg>
            </button>

            <button id="control-grab-btn" class="arcade-button flex items-center justify-center text-xl text-center leading-tight"
                    aria-label="‡∏Ñ‡∏µ‡∏ö" data-i18n-key="button.grab">
                ‡∏Ñ‡∏µ‡∏ö!
            </button>
            <button id="control-right-btn" class="d-pad-button flex items-center justify-center text-2xl font-bold"
                    aria-label="‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏ß‡∏≤" data-i18n-key="aria.moveRight">
                &rarr;
            </button>
        </div>
    </div>

    <!-- ===== ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ó‡∏µ‡πà 3: ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (STATE_SHOW_RESULT) ===== -->
    <!-- (v20) A11y: Add modal attributes -->
    <div id="result-modal" class="screen modal fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 z-10"
         role="dialog" aria-modal="true" tabindex="-1" data-i18n-key="aria.resultsModal">
        <!-- (v3) Winner Ticket -->
        <div class="bg-white rounded-xl shadow-2xl p-8 text-center max-w-sm w-full" id="result-card">
            <!-- (v8) Microcopy -->
            <h2 class="text-4xl font-extrabold text-yellow-500 mb-4 font-game" data-i18n-key="title.jackpot">üèÜ JACKPOT! üèÜ</h2>
            <!-- (v9) Generic Microcopy -->
            <p class="text-lg text-gray-700 mb-2" data-i18n-key="subtitle.youGot">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏µ‡∏ö‡πÑ‡∏î‡πâ...</p>
            <div class="my-6 p-4 bg-blue-100 border-2 border-blue-300 rounded-lg">
                <span id="winner-name" class="text-4xl font-extrabold text-blue-700 break-words"></span>
            </div>
            
            <p id="remaining-count" class="text-sm text-gray-500 mb-6"></p>

            <!-- (v10) New Buttons -->
            <button id="accept-prize-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg text-lg shadow-lg transition-transform transform hover:scale-105 mb-3"
                    data-i18n-key="button.accept">
                ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• (‡∏ô‡∏≥‡∏≠‡∏≠‡∏Å)
            </button>
            <button id="cancel-prize-btn" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-6 rounded-lg text-lg shadow-lg transition-transform transform hover:scale-105 mb-3"
                    data-i18n-key="button.cancel">
                ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å (‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ)
            </button>
            <button id="start-over-btn" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg text-lg shadow-lg transition-transform transform hover:scale-105"
                    data-i18n-key="button.startOver">
                ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </button>
        </div>
    </div>
    
    <!-- ===== (v8) Modal: ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô ===== -->
    <div id="how-to-play-modal" class="modal fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 z-20"
         role="dialog" aria-modal="true" tabindex="-1" data-i18n-key="aria.howToPlayModal">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full text-center">
            <h2 class="text-2xl font-bold font-game text-blue-600 mb-4" data-i18n-key="title.howToPlay">‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</h2>
            <ul class="text-left space-y-3 text-gray-700">
                <li data-i18n-key="help.1">1. üéÆ **‡∏Å‡∏î‡∏Ñ‡πâ‡∏≤‡∏á** (‡∏õ‡∏∏‡πà‡∏°/‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î ‚óÄÔ∏è‚ñ∂Ô∏è) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡∏Ñ‡∏µ‡∏ö</li>
                <li data-i18n-key="help.2">2. üî¥ ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° **"‡∏Ñ‡∏µ‡∏ö!"** (‡∏´‡∏£‡∏∑‡∏≠ Spacebar) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏∏‡πà‡∏°</li>
                <li data-i18n-key="help.3">3. üîµ ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° **"‡∏Å‡∏ß‡∏ô"** (‡∏´‡∏£‡∏∑‡∏≠ 'S') ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏•‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ö‡∏≠‡∏•</li>
            </ul>
            <button id="close-how-to-play-btn" class="mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg"
                    data-i18n-key="button.gotIt" aria-label="‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô">
                ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß!
            </button>
        </div>
    </div>

    <!-- ===== (v7) Modal: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ===== -->
    <div id="settings-modal" class="modal fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 z-20"
         role="dialog" aria-modal="true" tabindex="-1" data-i18n-key="aria.settingsModal">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full">
            <h2 class="text-2xl font-bold font-game text-gray-800 mb-6 text-center" data-i18n-key="title.settings">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h2>
            <div class="space-y-4">
                <!-- (v8) Accessibility - Reduce Motion -->
                <div class="flex items-center justify-between">
                    <label for="toggle-reduce-motion" class="text-gray-700" data-i18n-key="label.reduceMotion">‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß (‡∏õ‡∏¥‡∏î‡∏™‡∏±‡πà‡∏ô, Confetti)</label>
                    <input type="checkbox" id="toggle-reduce-motion" class="hidden"/>
                    <label for="toggle-reduce-motion" class="relative w-10 h-6 bg-gray-300 rounded-full cursor-pointer toggle-bg"></label>
                </div>
                <!-- (v7) Sound Toggles -->
                <div class="flex items-center justify-between">
                    <label for="toggle-sound-bgm" class="text-gray-700" data-i18n-key="label.bgm">‡πÄ‡∏û‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á (BGM)</label>
                    <!-- (v14) Removed 'checked' by default -->
                    <input type="checkbox" id="toggle-sound-bgm" class="hidden"/>
                    <label for="toggle-sound-bgm" class="relative w-10 h-6 bg-gray-300 rounded-full cursor-pointer toggle-bg"></label>
                </div>
                <div class="flex items-center justify-between">
                    <label for="toggle-sound-sfx" class="text-gray-700" data-i18n-key="label.sfx">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå (SFX)</label>
                    <input type="checkbox" id="toggle-sound-sfx" class="hidden" checked/>
                    <label for="toggle-sound-sfx" class="relative w-10 h-6 bg-gray-300 rounded-full cursor-pointer toggle-bg"></label>
                </div>
            </div>
            <button id="close-settings-btn" class="mt-8 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg"
                    data-i18n-key="button.close" aria-label="‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤">
                ‡∏õ‡∏¥‡∏î
            </button>
        </div>
    </div>

    <!-- ===== (v19) Modal: ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• ===== -->
    <div id="history-modal" class="modal fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 z-20"
         role="dialog" aria-modal="true" tabindex="-1" data-i18n-key="aria.historyModal">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full flex flex-col">
            <h2 class="text-2xl font-bold font-game text-gray-800 mb-4 text-center" data-i18n-key="title.history">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</h2>
            <div id="history-list-content" class="text-left space-y-2 text-gray-700 overflow-y-auto max-h-60 border p-3 rounded-md bg-gray-50">
                <!-- Content will be injected by JS -->
            </div>
            <button id="close-history-btn" class="mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg"
                    data-i18n-key="button.close" aria-label="‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥">
                ‡∏õ‡∏¥‡∏î
            </button>
        </div>
    </div>

    <!-- ===== (v19) Modal: ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ===== -->
    <div id="remaining-modal" class="modal fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 z-20"
         role="dialog" aria-modal="true" tabindex="-1" data-i18n-key="aria.remainingModal">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full flex flex-col">
            <h2 class="text-2xl font-bold font-game text-gray-800 mb-4 text-center" data-i18n-key="title.remaining">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</h2>
            <div id="remaining-list-content" class="text-left space-y-2 text-gray-700 overflow-y-auto max-h-60 border p-3 rounded-md bg-gray-50">
                <!-- Content will be injected by JS -->
            </div>
            <button id="close-remaining-btn" class="mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg"
                    data-i18n-key="button.close" aria-label="‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠">
                ‡∏õ‡∏¥‡∏î
            </button>
        </div>
    </div>

    <!-- (v24) Load JavaScript Modules -->
    <script type="module" src="main.js"></script>

</body>
</html>